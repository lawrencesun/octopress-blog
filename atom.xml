<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Lawrence Sun]]></title>
  <link href="http://voice.lawrencesun.info/atom.xml" rel="self"/>
  <link href="http://voice.lawrencesun.info/"/>
  <updated>2014-03-22T14:58:45+08:00</updated>
  <id>http://voice.lawrencesun.info/</id>
  <author>
    <name><![CDATA[Lawrence Sun]]></name>
    <email><![CDATA[yuliang1987@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[闲谈比特币]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/03/22/my-view-on-bitcoin/"/>
    <updated>2014-03-22T10:48:31+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/03/22/my-view-on-bitcoin</id>
    <content type="html"><![CDATA[<p>一谈到比特币，似乎每个人都有自己的理解，有人认为是未来的货币，有人认为是又一个庞氏骗局。2013年对于比特币来说，是疯狂的一年，几十倍的增长，吸引了无数目光，甚至“中国大妈”也参与到其中。然而2014年以来，比特币风波不断，“门头沟”的倒闭，各路谣言的肆虐，近乎腰斩的价格，又使得不少人血本无归。这一切的背后，到底是一场怎样的游戏？是人性的扭曲还是道德的沦丧？敬请收看本期特别节目…</p>

<p>哎，怎么像是走进科学…</p>

<!-- more -->


<p><strong>接触比特币</strong></p>

<p>我大致是在2011年左右接触到比特币，当时已经是GPU时代，看到一些人在用电脑“挖矿”，觉得很有意思。当时并没有仔细研究比特币的原理，只是听说这个东西能赚钱，下载了客户端后加入了“矿池”。后来发现基本挖不出来什么，于是乎就放弃了。</p>

<p>2013年初，当时比特币腰斩到60多美元一个，李笑来发文章力挺。再后来，比特币就像脱缰的野马，一骑绝尘。</p>

<p>直到今年春节，参加了一个技术分享，才开始研究比特币，包括“中本聪”的论文和wiki。说实话，到现在，还没有搞得特别明白，但是被比特币背后所展示的技术深深吸引。</p>

<p>特点：</p>

<ul>
<li>去中心化: 发行和追踪都没有中央机构。</li>
<li>公开透明: 账本为全网共有。</li>
<li>交易安全: 数字签名，没有双重支付问题，全网认证，匿名。</li>
<li>储存安全: 可以&#8221;冷藏&#8221;只有你知道的密匙。</li>
</ul>


<p><img src="https://lh5.googleusercontent.com/-B9DCl06j--Y/Uy0cbaQ-dvI/AAAAAAAAAm8/eFox4v9LrOk/w400/h300" alt="img" /></p>

<p><sub> 壹比特杂志上关于比特币是如何交易的 <a href="http://img0.ph.126.net/x-_ST2r783x6tLbWe_q9vQ==/2971249854257795997.png">查看大图</a><sub></p>

<p><strong>比特币的发展</strong></p>

<p>相比传统的支付手段，用比特币支付可以节省手续费，没有地域限制。目前比特币的生态系统已初具规模，无论在线还是移动都可以使用钱包、银行、交易所、小额支付，而支持比特币支付的网站和商家也日益增多。</p>

<p>同时随着监管的加强和无良交易所的退出，非投机用户的增加，比特币的发展会逐步成熟稳定。</p>

<p><strong>比特币的投资</strong></p>

<p>历史上，比特币暴涨暴跌过多次，这也提供了不少投机的机会，间接促进了比特币的发展。但是对于大部分人来说，投机的风险非常高。一方面目前大多数在线交易所和钱包同时存在跑路和被黑客攻击的风险，另一方面由于无法监管、交易不可逆，很容易造成财产损失。同时比特币的涨跌不易预测，传统金融股市的一套几乎不管用。</p>

<p>所以对于一般人来讲，炒币盯盘不可取。要么别碰，要么就买币保有。</p>

<p><strong>比特币的未来</strong></p>

<p>也许会在未来成为一种主流的货币，也许会被比特币2.0代替，也许会一文不值… 但是比特币的技术必将不断发展，并广泛应用于各个领域。</p>

<p><sub> ps: 本人一个币也没有… 欢迎赞助: 1PaQWw1bqcQWDokPfCSiZTwc52RmDp42Vx；另外如果想通过实际比特币操作进一步了解的，可以留下地址，随机发送0.001 ~ 0.01mBTC&hellip;<sub></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[曼游记终极篇之欧洲行 Day 3]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/03/20/travel-europe-day-3/"/>
    <updated>2014-03-20T15:32:40+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/03/20/travel-europe-day-3</id>
    <content type="html"><![CDATA[<p>昨晚没有睡好。一早出门，在火车站喝了一杯espresso，坐上普通车，也就是慢车，北上佛罗伦萨——我在意大利的第二个根据地。慢车类似我们的绿皮车，好处就是拿着欧洲青年火车通票可以直接上车。行车速度还可以，就是每站必停，一路上弘扬雷锋精神礼让他车。</p>

<p>沿途隧道很多，唤起了小时候坐火车去闽南的回忆。在三个多小时的车程里，睡了两觉，看了1/4本书。佛罗伦萨地处意大利中部，因此火车站虽然不大，但很繁忙。出站之后就看到了对面的新圣母大殿，在边上的Tourist Information拿了份地图。</p>

<!-- more -->


<p><img src="https://lh4.googleusercontent.com/-7uV_V03Tcm0/Uv9oFWwnQUI/AAAAAAAAAWQ/kiQ7CGsMB8U/w400/h300" alt="img" /></p>

<p><sub>* 欧洲青年火车通票，10天无限次，上车后自己填好等查票 </sub></p>

<p>对照着地图和邮件里的信息，好不容易才找到了预定的旅舍。这家旅舍离火车站不远，边上有两条商业街，贩卖着旅游纪念品。由于旅舍位于居民楼里，我来回走了数次才发现门牌。这幢楼的大门非常高大，应该在3米以上。</p>

<p>刚好有人开门出来，我就走进去了，结果发现进去之后还有上锁的一扇铁门。于是我就困在了大门和铁门之间&hellip;门铃也没有&hellip;终于等到一位大哥出来了，会说一点英语，告诉我电梯上到三楼右转后再走楼梯就能看到。</p>

<p>旅舍老板很客气，寒暄了几句。这家旅舍是家庭经营的，主要由他负责，还有一位看起来怪怪的老奶奶负责卫生。我的房间在二楼，盘旋式的楼梯很窄，一次只能通行一个人。房间看起来挺破旧的，锁也简单的很，不过有一个淋浴间，卫生间是楼道公用的。这里房子一般有两层窗，一层普通的，一层百叶状的。</p>

<p>整理东西时才发现，一包东西落在火车上了，包括昨天刚买的短裤和洗漱装备。感觉这样发展下去，就要写血泪史了。</p>

<p><img src="https://lh5.googleusercontent.com/-nvME_8gvw5U/Uv9qCxyKTPI/AAAAAAAAAZw/obTduaBNx9E/w300/h400" alt="img" /></p>

<p><sub>* 到处都是披萨 </sub></p>

<p>下午吃了一块小披萨准备动身去比萨了。结果又忘带了通票，好在来回20欧不到。车慢得要死，一路晚点，在恩波利停留了将近40分钟，很多人都下车换后来居上的快车了。</p>

<p><img src="https://lh4.googleusercontent.com/-irF8LGrh6o4/Uv9qGXKjRrI/AAAAAAAAAaA/Kc6EAFoVuhY/w400/h300" alt="img" /></p>

<p><sub>* 被喷成花的火车 </sub></p>

<p>比萨城并不大，也没有什么特点，母亲河还没整治后的运河干净，来往行人并不多。但是在比萨斜塔，游客络绎不绝。斜塔至今已有八九百年历史，原来是个钟楼，由于地层不均造成倾斜。斜塔边上还有一个洗礼堂和一座大教堂。在沿街的商店里，匹诺曹的身影也出现在各种纪念品中。</p>

<p><img src="https://lh4.googleusercontent.com/-CoumGLaUVN4/Uv9qDnDWV9I/AAAAAAAAAZ4/rnb-n73jfJE/w300/h400" alt="img" /></p>

<p><sub>* 比萨斜塔 </sub></p>

<p>比萨斜塔固然是一个奇特的景观，在塔下摆各种pose的人民更是不可错过的风景。我偶遇了一对英国来的老夫妻，于是就让他们帮我拍了一张<code>托塔天王</code>。</p>

<p>两个多小时就结束了比萨小镇的游览，典型的到此一游。回程选择了快车，同样的价格，车速快了太多，还能享受空调。</p>

<p>回到住地休整，发现在意大利的烈日下呆上三天，就是<code>白斩鸡</code>也会变成<code>吴山烤鸡</code>。</p>

<p><sub>20/06/2013 初稿于佛罗伦萨 03/2014 整理 </sub></p>

<p><sub>注: <a href="http://voice.lawrencesun.info/blog/categories/man-you-ji/">曼游记系列</a>: 本系列游记照片由谷哥四儿子联手谷哥相册友情提供，缺失部分关键照片，本篇尤其严重，另外必要时需科学上网，有高清无马需求的请联系我. </sub></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[曼游记终极篇之欧洲行 Day 2]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/03/03/travel-europe-day-2/"/>
    <updated>2014-03-03T18:56:48+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/03/03/travel-europe-day-2</id>
    <content type="html"><![CDATA[<p>昨天忘了喷防晒，亡羊补牢，为时还是有点晚。防晒剂似乎过期变味了。。。没办法，英国一年也没几个晴天，基本没拿出来用过。下楼找了一家路边的酒吧，点了意大利标配，一杯Latte和一个牛角包。</p>

<p>其实这里不少人是直接喝espresso的，而且就站在吧台直接一口闷，有些人会再要杯tap water漱漱口。在英国几乎天天去starbucks, costa, nero这种烂大街的店喝。此番来意大利朝圣，发现这里咖啡的味道更加醇香，不知道是正宗口味还是心理作用。和其他地方不同，这里的咖啡店大多和酒吧是一同经营的，基本没有什么连锁店。</p>

<!-- more -->


<p><img src="https://lh6.googleusercontent.com/-b43icVP4qlA/Uv9pJ3nT9iI/AAAAAAAAAYI/ybx4hFHvL8Y/w300/h400" alt="img" /></p>

<p><sub>* Café Latte &amp; Croissant </sub></p>

<p>吃完早餐坐地铁来到了斗兽场。结果不幸碰到了工会集会，暂停开放。于是先去了边上的古罗马遗迹。由于语言不通，问了好几个人，跟着背包的路人，绕了几趟冤枉路才找到了入口。</p>

<p><img src="https://lh3.googleusercontent.com/-R95o0WfPP2M/Uv9pTr3F1GI/AAAAAAAAAYQ/zAAnFLntvQ4/w300/h400" alt="img" /></p>

<p><sub>* 古罗马遗迹 </sub></p>

<p>古罗马的宏伟会场、豪华宫殿，历经千年，如今只剩下残破不堪的墙体和兀自伫立的圆柱。但不难看出，当时的罗马帝国是多么的强盛。想象一下，站在巨大的神殿指点江山，该有多神气。遗址里有一处不太显眼的地方，还有人在此献花，原来是凯撒大帝被刺身亡的地方。</p>

<p><img src="https://lh5.googleusercontent.com/-gdKlcvEbjz8/Uv9pwLph20I/AAAAAAAAAZI/wXfOFbVesnw/w400/h300" alt="img" /></p>

<p><sub>* 古罗马元老院，神殿，祭堂 </sub></p>

<p>辗转回到了斗兽场，roma pass让我免去了排长队的困扰，一下子就超越了大队人马。圆形斗兽场非常壮观，当年的疯狂盛况一定不亚于如今英超赛场。这里的景象让人想起了刺客信条，我曾在此多次阵亡。。。恐怕当年角斗士们的困兽之斗也是九死一生。路人互助拍照片的时候还碰上了搞怪的三人组，忘了来自哪国的，拍得时候笑翻了。</p>

<p><img src="https://lh3.googleusercontent.com/-tsdW-y6bLKA/Uv9pi8l0-pI/AAAAAAAAAYs/u9ora8lzyOM/w300/h400" alt="img" /></p>

<p><sub>* 古罗马斗兽场 </sub></p>

<p>古罗马的神殿祭堂，拱门石墙，尽管已是断壁残垣，但考虑到这是两千多年的历史文物，仍然令人惊叹。此时不禁联想到天朝，蛮横的城市化建设破坏了多少珍贵的文化遗产。这些都是一去不复的，可笑的是，如今又想仿旧盖新。大城市的建筑已然失去了自身特点和文化传承，这无疑是对五千年文明的毁尸灭迹。小时候那种烧煤炉、跳皮筋的生活记忆也将随着老街道、瓦片房的坍塌一并消逝。</p>

<p><img src="https://lh5.googleusercontent.com/-Pleti5oS8nI/Uv9pjBLpjkI/AAAAAAAAAYw/puUwKTlToWQ/w400/h300" alt="img" /></p>

<p><sub>* 大爱这里的番茄 </sub></p>

<p>扯远了，走累了，遂路边小憩。喝啤酒，吃沙拉，晒太阳，然后一路向北。</p>

<p>参观了位于威尼斯广场的保守宫和新宫博物馆，以及边上的战争纪念馆，无一不大气磅礴。尽管这里馆藏丰富，雕塑、油画珍宝无数，还有阿基米德撬动地球的模型，但是审美疲劳加上旅途劳顿，基本是走马观花一扫而过。</p>

<p><img src="https://lh4.googleusercontent.com/-Wn4NoNtm82w/Uv9pmgpqVeI/AAAAAAAAAY4/gJIH_HNW4qQ/w400/h300" alt="img" /></p>

<p><sub>* 威尼斯广场 </sub></p>

<p>出来继续北上，来到了罗马市内最知名的喷泉，许愿池。这里聚集了大量的游客。不少人往清澈的池水里丢钱，据说可以许下三个愿望。我也拿出一欧元，作出背身扔币的动作，请人帮我拍了一张，然后。。。把钱放回口袋。。。</p>

<p><img src="https://lh4.googleusercontent.com/-sg-_UBhgcyo/Uv9pvf-_l4I/AAAAAAAAAZE/DvvMr668Heg/w300/h400" alt="img" /></p>

<p><sub>* 许愿池，在这里&#8221;投&#8221;了一个欧元 </sub></p>

<p>顺便说一句，意大利的水很贵，尤其是景点的小商小贩们，宰你没商量。不过意大利的街道边有很多泉水，不少人都去接水喝。</p>

<p>继续在迷路中前行。没办法，这里背街小巷没有整改，乱七八糟，加上坑爹的路标，除非全程GPS，否则走冤枉路是必修课。终于走到了西班牙广场，出名的原因是罗马假日里赫本坐在这里吃冰淇淋。广场的泉水旁此时正好有一个交响乐团在演奏。</p>

<p><img src="https://lh6.googleusercontent.com/-c6P2UmehNJA/Uv9py92rLUI/AAAAAAAAAZQ/CxkavSt4AhI/w300/h400" alt="img" /></p>

<p><img src="https://lh6.googleusercontent.com/-nqvOCdzzs2w/Uv9p8Q79y6I/AAAAAAAAAZo/IQI65P0TvKs/w300/h400" alt="img" /></p>

<p><sub>* 坐在西班牙广场的阶梯，听音乐、吃冰淇淋 </sub></p>

<p>从西班牙广场到人民广场的一路上，都是名牌店。正惊讶国内扫货团怎么不见踪影，仔细一看，原来是周日休息了。突然想到某本书上调侃的，不少人周日去教堂是因为没其他地方可去。附近找了一家店吃披萨，性价比超高，9欧元，又大又脆，两个人吃都够，只是服务一般，还想强收服务费，所以破例没给小费就走了。</p>

<p><img src="https://lh3.googleusercontent.com/-4V_2mfGbQ3E/Uv9p4Q2i4HI/AAAAAAAAAZY/DrfCGG_dCSc/w400/h300" alt="img" /></p>

<p><img src="https://lh6.googleusercontent.com/-VTYTFsvltOM/Uv9p6dNxQnI/AAAAAAAAAZg/pD7pwfMQltE/w300/h400" alt="img" /></p>

<p><sub>* 意大利著名食物，披萨和冰淇淋 </sub></p>

<p>之后还去看了共和广场。回旅舍中看到不少麦当劳的标志，相距十万八千里还标记，其实都指向了火车站那家。虽说防晒霜过期，但是搽和没搽区别很大。手臂上明显的三部分，被衣袖遮住的，涂过防晒的和裸奔的。裸奔的那块晒了一天发红了。好在我在这里并不算黑，不少人都晒得很健康。
感觉意大利的美女大多没有北欧的高又白，而是肤色健康，身形消瘦，头发略黑，眼睛深陷，加上一口听不懂的外语，别有风情。</p>

<p><sub>17/06/2013 初稿于罗马 03/2014 整理 </sub></p>

<p><sub>注: <a href="http://voice.lawrencesun.info/blog/categories/man-you-ji/">曼游记系列</a>: 本系列游记照片由谷哥四儿子联手谷哥相册友情提供，缺失部分关键照片，另外必要时需科学上网，有高清无马需求的请联系我. </sub></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: Counter cache]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/03/01/rails-notes-counter-cache/"/>
    <updated>2014-03-01T10:18:40+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/03/01/rails-notes-counter-cache</id>
    <content type="html"><![CDATA[<p>By default, posts in my app are sorted by create_at time. I would like to sort them by the number of comments. In order to implement it, we will apply :counter_cache and :scope.</p>

<!-- more -->


<p>According to Active Record Association on Rails Guides, @post.comments.size requires making a call to the database to perform a COUNT(*) query. :counter_cache can be used to make finding the number of belonging objects more efficient.</p>

<p>First, run a migration to add the column called comments_count to posts.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">AddCommentsCountToPosts</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">up</span>
</span><span class='line'>    <span class="n">add_column</span> <span class="ss">:posts</span><span class="p">,</span> <span class="ss">:comments_count</span><span class="p">,</span> <span class="ss">:integer</span><span class="p">,</span> <span class="ss">:null</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>    <span class="no">Post</span><span class="o">.</span><span class="n">reset_column_information</span>
</span><span class='line'>    <span class="no">Post</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">p</span><span class="o">.</span><span class="n">update_attribute</span> <span class="ss">:comments_count</span><span class="p">,</span> <span class="nb">p</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">length</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">down</span>
</span><span class='line'>    <span class="n">remove_column</span> <span class="ss">:posts</span><span class="p">,</span> <span class="ss">:comments_count</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then add following code to <code>comment.rb</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">belongs_to</span> <span class="ss">:post</span><span class="p">,</span> <span class="n">counter_cache</span><span class="p">:</span> <span class="kp">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then we will use scopes. According to Active Record Querying, scoping allows you to specify commonly-used queries which can be referenced as method calls on the association objects or models.</p>

<p>In our case, define a scope called active on <code>post.rb</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">scope</span> <span class="ss">:active</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="s2">&quot;comments_count &gt;= ?&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then add routes to the <code>collection</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">resources</span> <span class="ss">:posts</span> <span class="k">do</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>  <span class="n">collection</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">get</span> <span class="s1">&#39;active&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>it will generate the path /posts/active with GET, route to the active action of PostsController, as well as active_posts_path route helper.</p>

<p>In PostsController, define <code>active</code> action</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">active</span>
</span><span class='line'>      <span class="vi">@posts</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">active</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="s1">&#39;created_at DESC&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:page</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>      <span class="n">render</span> <span class="ss">action</span><span class="p">:</span> <span class="s1">&#39;index&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally, use @post.comments_count and active_posts_path in views to achieve what we want at the beginning.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: Ajaxify Pagination]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/02/22/rails-notes-ajaxify-pagination/"/>
    <updated>2014-02-22T11:25:16+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/02/22/rails-notes-ajaxify-pagination</id>
    <content type="html"><![CDATA[<p>After applying <a href="http://voice.lawrencesun.info/posts/2014/02/16/rails-notes-pagination-with-kaminari/">pagination</a> in my app, I would like to ajaxify kaminari paginator. I googled and stackoverflowed this issue, and found the solution, which is quite similar to what I did in <a href="http://voice.lawrencesun.info/posts/2014/02/11/rails-notes-adding-a-like-function/">likeable</a> function.</p>

<!-- more -->


<p>First, add <code>remote: true</code> and class id to <code>index.html.erb</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">div</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;posts&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="sx">%= render &#39;shared/posts&#39;, object: @posts %&gt;</span>
</span><span class='line'><span class="sx">&lt;/div&gt;</span>
</span><span class='line'><span class="sx">&lt;div id=</span><span class="s2">&quot;paginator&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;%=</span> <span class="n">paginate</span> <span class="vi">@posts</span><span class="p">,</span> <span class="ss">remote</span><span class="p">:</span> <span class="kp">true</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Second, create a new file <code>index.js.erb</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span><span class="p">(</span><span class="s2">&quot;#posts&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="s2">&quot;&lt;%= escape_javascript render &#39;shared/posts&#39;, object: @posts %&gt;&quot;</span><span class="p">);</span>
</span><span class='line'><span class="err">$</span><span class="p">(</span><span class="s2">&quot;#paginator&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="s2">&quot;&lt;%= escape_javascript(paginate(@posts, remote: true).to_s) %&gt;&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Done.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[曼游记终极篇之欧洲行 Day 1]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/02/21/travel-europe-day-1/"/>
    <updated>2014-02-21T20:57:07+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/02/21/travel-europe-day-1</id>
    <content type="html"><![CDATA[<p>酒店叫醒和手机闹铃双炮齐响，我的欧洲之行正式开始了。胆战心惊地过了关，乘坐大巴车去登机。大巴开了很长时间，以至于边上有人说了句，Driving to Rome?</p>

<p>飞机一路南下，小憩片刻醒来，看到了疑似阿尔卑斯雪山和意大利的靴子海岸线。这里的农村和英村那种Wild的感觉不同，比较规矩，没什么绿色。到了机场，海关检查过程非常简单，就问了我居住在哪儿。还没曼城某些酒吧查证来得严。</p>

<p>出来坐火车去罗马市。正想显摆一下我的欧洲铁路通票，结果去市内直达线路是First Class。一等的座位，却是绿皮的速度，坐了半个多小时才到了罗马。我已经被车上各种看不懂的意大利文搞得有点晕，下来后好不容易找到Tourist Information，问了去旅舍的路，顺便买了Roma Pass (包含两个景点门票和三天的地铁通票)。</p>

<!-- more -->


<p>火车站很是破烂，我大天朝随便一个二三线城市的就可以完爆了。出来后更是一惊，穿梭的摩托车，乱贴的牛皮癣，拉游客的，躺地板的… 像是城乡结合部。住处离火车站不远，但是我尴尬地走进了身处同一幢楼的另一家青年旅舍…</p>

<p>把行李往地上一扔，就出门直奔梵蒂冈了。出地铁后跟着人群往前走，一段路之后便看到了梵蒂冈的高大围墙。之前看到说梵蒂冈博物馆要排很久，实际情况倒是没那么糟，预约与否也影响不大。</p>

<p>正当我要排队买票的时候，突然有个男的问我是不是要买票进去参观，我说是啊，心想是不是票贩子。结果他直接塞给我一张票，说他去不了了，也没问我要钱就转身走了。我嘴上说着谢谢，可是还没反应过来… 结果真的是有效票，考虑到昨天那个衰样，用人品守恒来解释并不为过。</p>

<p><img src="https://lh3.googleusercontent.com/-q_RrFajkmPk/Uv9oXiXxA6I/AAAAAAAAAWw/vv90NLIC7N4/w300/h400" alt="img" /></p>

<p><sub>* 梵蒂冈博物馆 </sub></p>

<p>博物馆内收藏了大量的雕塑和壁画，其中不少出自大师的手笔(说了我也不认识…)。可能是在英村看了太多的皇宫和庄园，新鲜感并不强。参观完毕后，沿着围墙来到了圣彼得大教堂。教堂前面的广场非常宏伟，四周是高大的圆柱。这里是欧洲最大的天主教堂之一，排队时间比较长。我对天主教倒是没什么好感，多次人为制造了教会至高无上的地位，假上帝之名奴役教众。当然除了这些，不能否认天主教对文化、建筑和艺术的深远影响。梵蒂冈不愧是大本营，无论是博物馆还是大教堂，无一不宏伟庄严、富丽堂皇，藏宝更是不计其数。</p>

<p><img src="https://lh6.googleusercontent.com/-u8MiE6DZ6Hk/Uv9oVm0ozSI/AAAAAAAAAWo/QqwVlfMQ2Yw/w400/h300" alt="img" /></p>

<p><img src="https://lh4.googleusercontent.com/-0qiOPWDWZPI/Uv9oZj4Og_I/AAAAAAAAAW4/d11AF79uRHk/w300/h200" alt="img" /></p>

<p><sub>* 梵蒂冈大教堂 </sub></p>

<p>沿着广场前进，路过了天使堡和罗马的母亲河。路边有很多小贩，卖各种假名牌包和旅游纪念品，然后不远处来了一队城管…</p>

<p><img src="https://lh5.googleusercontent.com/-fuj3VLfbBws/Uv9ojUWgpUI/AAAAAAAAAXE/_NT8tqT-Wvk/w400/h300" alt="img" /></p>

<p><sub>* 罗马天使堡 </sub></p>

<p>相比大教堂，我更喜欢居民小巷里的建筑。很多餐馆酒吧就开在路边，座位基本都是在户外，可能是这里常年晴朗，要是英村就不行了，还没晒几分钟就下雨了。不少人坐在那里，吃着意式美食，晒着太阳，听着艺人的手风琴，非常惬意。</p>

<p><img src="https://lh6.googleusercontent.com/-VbZlc_Q7sqc/Uv9oj7crv_I/AAAAAAAAAXM/N8Aai1GbjVM/w300/h400" alt="img" /></p>

<p><sub>* 罗马街头巷尾 </sub></p>

<p>走出小巷，来到纳沃纳广场。周围一圈房子都是巴洛克风格的，非常漂亮。广场中间有三个喷泉，海神喷泉、四河喷泉和摩尔喷泉。这里有很多民间艺人在这里展现自己。本想在边上的餐馆坐下来，可是一道主菜就要20欧，于是就先去了不远处的万神殿。这可是罗马帝国时期的建筑，室内非常宽广，四周是壁龛，由大穹顶的一个圆洞提供光源。</p>

<p><img src="https://lh5.googleusercontent.com/-YW9kdKHBjRw/Uv9okIKV7cI/AAAAAAAAAXQ/nNLrqHniD2o/w400/h300" alt="img" /></p>

<p><img src="https://lh3.googleusercontent.com/-9cPDZimvnwA/Uv9o8mddCnI/AAAAAAAAAXo/jcpcahYC0aQ/w400/h300" alt="img" /></p>

<p><sub>* 罗马纳沃纳广场 </sub></p>

<p><img src="https://lh4.googleusercontent.com/-9W3r9kCbX9k/Uv9o4LLM64I/AAAAAAAAAXg/ZuvWDmNqeCM/w400/h300" alt="img" /></p>

<p><sub>* 罗马万神殿 </sub></p>

<p>出来后在一家小店坐下，吃了意粉和沙拉，当然还少不了一杯啤酒。吃饱喝足后，夜色已然降临，坐公交车准备回旅舍。车上很挤，而我的挤车能力已经渣了。和曼城直接拿钱问司机买票不同，这个车上只有一个刷卡机，貌似是自觉刷卡，没有人查。 我不知道刷什么卡，于是疑似逃票了… 和曼城的公交一样，没有英文报站，坐到哪里全靠感觉… 这点我大杭州的公交就太有人文关怀、国际视野了，每站必停，而且不少线路是双语报站。只是老外就算想坐公交，恐怕挤上的概率也不大。</p>

<p><img src="https://lh5.googleusercontent.com/-CXFq7nhNkIs/Uv9pBjYH64I/AAAAAAAAAX8/FKpSnhkG_qk/w300/h400" alt="img" /></p>

<p><img src="https://lh4.googleusercontent.com/-VkTm9GbIAJQ/Uv9pBSA75YI/AAAAAAAAAX0/I2NwWRxCtS4/w300/h400" alt="img" /></p>

<p><sub>* 在意大利的第一餐 </sub></p>

<p>洗完澡后在附近转了一圈，发现火车站周围有不少酒吧很火爆，而且价格公道，今天为了赶路就吃了一顿饭，明天有机会在这里找一家试试。这里美式快餐店难寻，可以看出意大利人对自己的美食还是情有独钟。</p>

<p><img src="https://lh6.googleusercontent.com/-T845u2BoCL8/Uv9pCND2iLI/AAAAAAAAAYA/BdKCiTnh574/w300/h400" alt="img" /></p>

<p><sub>* 罗马夜色下的&#8221;大排档&#8221; </sub></p>

<p>吃饭时写了一点笔记，躺在旅舍完成了初稿，由于床上是一个来自英村的美女，哦，是床的上铺… 记录时有些分心。抬头一看，突然发现有张写着Wifi用户名和密码的纸条塞在上铺的床底木板中间… 今天是普度众生日吗…</p>

<p><sub>16/06/2013 罗马初稿 02/2014 整理 </sub></p>

<p><sub>注: 本系列游记照片由谷哥四儿子联手谷哥相册友情提供，缺失部分关键照片，另外必要时需科学上网，有高清无马需求的请联系我.</sub></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: Pagination with Kaminari]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/02/16/rails-notes-pagination-with-kaminari/"/>
    <updated>2014-02-16T22:13:47+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/02/16/rails-notes-pagination-with-kaminari</id>
    <content type="html"><![CDATA[<p>With hundreds and thousands of posts on website, we would like to insert some breaks. The first choice for pagination in Rails is will_paginate. However, I find a better one called <a href="https://github.com/amatsuda/kaminari">Kaminari</a>.</p>

<!-- more -->


<p><strong>Controllers and Views</strong></p>

<p>First, add &lsquo;kaminari&rsquo; to &lsquo;Gemfile&rsquo; and run <code>bundle install</code></p>

<p>Second, we apply the scope called <code>page</code> and <code>per</code> in our Controller.</p>

<p><code>@posts = Post.all.page(params[:page]).per(15)</code></p>

<p>that will show 15 posts per each page.</p>

<p>Then, we call <code>paginate</code> helper in our views.</p>

<p><code>&lt;%= paginate @posts %&gt;</code></p>

<p><strong>Configure the default value</strong></p>

<p>run <code>rails g kaminari:config</code> and change the file <code>kaminari_config.rb</code> in config/initializers</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Kaminari</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">default_per_page</span> <span class="o">=</span> <span class="mi">15</span>
</span><span class='line'>  <span class="c1"># config.max_per_page = nil</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="mi">2</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">outer_window</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>  <span class="c1"># config.left = 0</span>
</span><span class='line'>  <span class="c1"># config.right = 0</span>
</span><span class='line'>  <span class="c1"># config.page_method_name = :page</span>
</span><span class='line'>  <span class="c1"># config.param_name = :page</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>I18N and labels</strong></p>

<p>We can change the default labels in config/locales.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">en</span><span class="p">:</span>
</span><span class='line'>  <span class="ss">views</span><span class="p">:</span>
</span><span class='line'>    <span class="ss">pagination</span><span class="p">:</span>
</span><span class='line'>      <span class="ss">first</span><span class="p">:</span> <span class="s2">&quot;&amp;laquo; First&quot;</span>
</span><span class='line'>      <span class="ss">last</span><span class="p">:</span> <span class="s2">&quot;Last &amp;raquo;&quot;</span>
</span><span class='line'>      <span class="ss">previous</span><span class="p">:</span> <span class="s2">&quot;&amp;lsaquo; Prev&quot;</span>
</span><span class='line'>      <span class="k">next</span><span class="p">:</span> <span class="s2">&quot;Next &amp;rsaquo;&quot;</span>
</span><span class='line'>      <span class="ss">truncate</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Configure the default view</strong></p>

<p>run <code>rails g kaminari:views default</code> and change the files in app/views/kaminari</p>

<p>e.g. I delete the first and last label in _pagination.html.erb and change the style to bootstrap according to the theme provided by the Kaminari.</p>

<p><strong>Issue</strong></p>

<p>I followed the instruction on Railscasts and the wiki of Kaminari. But my case seemed more complicated. I set three posts per page as default for test, but found that the posts presented in a strange array.</p>

<p>PostsController:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">index</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>  <span class="vi">@posts</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:page</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>index.html.erb:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= render &#39;shared/posts&#39; , object: @posts%&gt;</span>
</span><span class='line'><span class="sx">&lt;%=</span> <span class="n">paginate</span> <span class="vi">@posts</span> <span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>_posts.html.erb:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">% object.reverse.each </span><span class="k">do</span> <span class="o">|</span><span class="n">post</span><span class="o">|</span> <span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The problem was that 3 posts each time was passed into the partial and was implemented the reverse scope. So I deleted the <code>reverse</code> scope and changed the line in the controller like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vi">@posts</span> <span class="o">=</span> <span class="vi">@posts</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="s1">&#39;created_at DESC&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:page</span><span class="o">]</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: Add Administrator]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/02/15/rails-notes-add-administrator/"/>
    <updated>2014-02-15T16:02:33+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/02/15/rails-notes-add-administrator</id>
    <content type="html"><![CDATA[<p>On the land of website/software, there is always an Administrator. The Administrator, like a king, has the right to change the rules, block the news and &lsquo;kill&rsquo; the innocent users whenever he likes.</p>

<blockquote><p>Dieu et mon droit.</p></blockquote>

<p>Today, I claimed to the throne &mdash; became an admin who had the power to delete comments and users.</p>

<!-- more -->


<p>First, <code>rails g migration add_admin_to_users</code>.</p>

<p>Second, create a table and run <code>rake db:migrate</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">AddAdminToUsers</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">change</span>
</span><span class='line'>      <span class="n">add_column</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:admin</span><span class="p">,</span> <span class="ss">:boolean</span><span class="p">,</span> <span class="ss">default</span><span class="p">:</span> <span class="kp">false</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then, define a method in ApplicationController.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">admin_user</span>
</span><span class='line'>  <span class="k">unless</span> <span class="n">current_user</span><span class="o">.</span><span class="n">admin?</span>   <span class="c1"># line_to_be_modified </span>
</span><span class='line'>    <span class="n">flash</span><span class="o">[</span><span class="ss">:error</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;Please contact admin.&quot;</span>
</span><span class='line'>    <span class="n">redirect_to</span> <span class="n">root_path</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, add <code>destroy</code> to UsersController</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="n">before_action</span> <span class="ss">:admin_user</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="ss">:destroy</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="k">def</span> <span class="nf">destroy</span>
</span><span class='line'>  <span class="vi">@user</span><span class="o">.</span><span class="n">destroy</span>
</span><span class='line'>  <span class="n">flash</span><span class="o">[</span><span class="ss">:success</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;User deleted.&quot;</span>
</span><span class='line'>  <span class="n">redirect_to</span> <span class="n">users_path</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Afterwards, add a delete link in the view.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;delete&#39;</span><span class="p">,</span> <span class="n">user_path</span><span class="p">(</span><span class="n">user</span><span class="p">),</span> <span class="nb">method</span><span class="p">:</span> <span class="s1">&#39;delete&#39;</span><span class="p">,</span> <span class="ss">data</span><span class="p">:</span> <span class="p">{</span> <span class="ss">confirm</span><span class="p">:</span> <span class="s1">&#39;You sure?&#39;</span><span class="p">}</span> <span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally, we would like to destroy the posts and comments automatically at the same time we delete the users. <code>has_many :posts, dependent: :destroy</code></p>

<hr />

<ul>
<li>Issue 1:
There would be a nil class error if there was no user signed in, <code>current_user.admin?</code> went wrong. Therefore, I added another method in ApplicationController and change the line_to_be_modified to <code>unless admin?</code></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">admin?</span>
</span><span class='line'>  <span class="n">signed_in?</span> <span class="o">&amp;&amp;</span> <span class="n">current_user</span><span class="o">.</span><span class="n">admin?</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Issue 2:
Another error occurred when I tried to add the delete link on the comments partial.</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">% if </span><span class="n">object</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">any?</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx"> &lt;% object.comments.each do |comment| %&gt;</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="sx">% if </span><span class="n">admin?</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">     &lt;%= link_to &#39;delete&#39;, post_comment_path($params), method: &#39;delete&#39;, data: { confirm: &#39;You sure?&#39;} %&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="sx">% end </span><span class="o">%&gt;</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>At first, I passed in the &lsquo;comment&rsquo; as $params, and it showed that  the post.id and :id were nil. So I changed the $params to &lsquo;comment.post.id, comment.id&rsquo; and it went well.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[曼游记终极篇之欧洲行 Day 0]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/02/14/travel-europe-day-0/"/>
    <updated>2014-02-14T22:02:25+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/02/14/travel-europe-day-0</id>
    <content type="html"><![CDATA[<p>拖了大半年，终于决定开始动笔。让我如此肆无忌惮的原因是当时在旅途之中，用Evernote记录了一些笔记。可是再拖下去，恐怕这些碎片将无法勾勒出那次奇妙的旅行。</p>

<p>曼游记里有太多值得回忆的瞬间，其中最High的应该就是2013年暑假历时半个月的欧洲自由行了。这是曼游记第一次也是最后一次踏出小不列颠，向欧洲大陆进发。</p>

<p>欧洲申根签证的过程颇具戏剧性，可以参考之前的<a href="http://lawrencesun.info/blog/?p=890">一篇</a>，这里不做累述。</p>

<p>我的<code>诺曼底登陆</code>选在了罗马，但是出师不利。一晚兴奋得没有睡，然后背着行囊，在酒鬼和流浪汉的上班时间，独行夜路，来到火车站。不料火车晚点了半个多小时。赶到机场后，手贱又买了本书，&#8217;An idiot abroad 2&#8217;, 这直接导致我的kindle在后续旅途中沉在包底独自悲伤。</p>

<p>当然更加悲伤的是我，真的成了idiot，&#8217;An idiot failed to board 1&#8217;: 我在准备登机的时候被拦下，原因是作为非欧盟区的居民，登机牌必须要有旅行文件的审核章，这是需要在安检之前完成的。因为之前选择了网上登机，而且没有看清文件的要求，只得眼睁睁地看着飞机起飞，然后被机场人员&#8217;押送&#8217;至英村边境口…</p>

<!-- more -->


<p>边境官员姗姗来迟，还一本正经地问了一堆问题。于是我完成了史上最迅速的出入境。机场人员倒是很热心，安慰我一番后提供了第二天航班的信息。我用电量不足的手机定了另一个航空公司的班次（我的钱包啊…），好在抵达时间比较早，落地机场也离罗马比较近。</p>

<p><img src="https://lh3.googleusercontent.com/-nLsQSHOKnZs/Uv9oKWyOMaI/AAAAAAAAAWg/du6stzgwvqw/w300/h400" alt="img" /></p>

<p><sub>* 凌晨在火车站焦急等待晚点的火车</sub></p>

<p>实在不想在凌晨重走夜路，想想既然是度假，那就花点血本吧，一咬牙在机场的四星级酒店订了一晚，真是出师未捷先卖血。</p>

<p><img src="https://lh5.googleusercontent.com/-8QLS7f3NbG0/Uv9oFenAqXI/AAAAAAAAAmY/Lu7zbx8Se2U/w400/h300" alt="img" /></p>

<p><sub>* 辛苦大半年换来的英镑变成了欧元，数量多了点，略感欣慰…</sub></p>

<p>放下包裹，顺道去了下附近的Regus，用之前一天刚拿到的金卡在里面吃了点免费的点心茶水，玩了下iMac，让服务人员打印了新的登机牌。发邮件给罗马的青年旅舍，动情地描述了我的悲惨经历，客服MM十分感动，然后…帮我保留了后面两天的预定，并说如果我的床位卖出去了就不收第一晚的钱了。</p>

<p>由于机场附近实在没啥好玩的，又乘火车回市里溜达了一圈，买了三文治和饮料作晚餐，然后回酒店补觉。</p>

<p><img src="https://lh6.googleusercontent.com/-zmOg3ZHclzk/Uv9oFV1tp3I/AAAAAAAAAmc/UFOT99xF6Mc/w300/h400" alt="img" /></p>

<p><sub>* 签证时提交的最初计划，结果第一天来了个本地机场一日游…</sub></p>

<p><sub>注: 本系列游记照片由谷哥四儿子联手谷哥相册友情提供，缺失部分关键照片，另外必要时需科学上网，有高清无马需求的请联系我.</sub></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: Markdown Support]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/02/14/rails-notes-markdown-support/"/>
    <updated>2014-02-14T12:40:02+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/02/14/rails-notes-markdown-support</id>
    <content type="html"><![CDATA[<p>The default output of the content in my app is directly shown as HTML. The problem is even I entered several paragraphs, it will be shown in one. On the other hand, I intend to add markdown support in the beginning. Thanks Google and Github, I found a gem called <a href="https://github.com/vmg/redcarpet">Redcarpet</a>.</p>

<p>First I found a screencast in <a href="1">Railscasts</a>. Unfortunately, this solution was introduced 2 years ago. However, I found an up-to-date one by SimplizIT below the video. Here it is.</p>

<!-- more -->


<ul>
<li><p>Install it by adding <code>gem 'redcarpet'</code> to Gemfile, and run <code>bundle install</code>.</p></li>
<li><p>Then add the following code to <code>application_helper.rb</code></p></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">markdown</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span class='line'>  <span class="n">renderOptions</span> <span class="o">=</span> <span class="p">{</span><span class="n">hard_wrap</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="n">filter_html</span><span class="p">:</span> <span class="kp">true</span><span class="p">}</span>
</span><span class='line'>  <span class="n">markdownOptions</span> <span class="o">=</span> <span class="p">{</span><span class="ss">autolink</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="n">fenced_code_blocks</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="n">no_intra_emphasis</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">strikethrough</span><span class="p">:</span> <span class="kp">true</span><span class="p">}</span>
</span><span class='line'>  <span class="n">markdown</span> <span class="o">=</span> <span class="ss">Redcarpet</span><span class="p">:</span><span class="ss">:Markdown</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">Redcarpet</span><span class="p">:</span><span class="ss">:Render</span><span class="o">::</span><span class="no">HTML</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">renderOptions</span><span class="p">),</span> <span class="n">markdownOptions</span><span class="p">)</span>
</span><span class='line'>  <span class="n">markdown</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">html_safe</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><sub>here, we can customise the markdown extension and html output by changing the renderOptions and markdownOptions. The full option shows <a href="1">here</a>.</sub></p>

<ul>
<li>Apply &lsquo;markdown&rsquo; function in the view template.</li>
</ul>


<p><code>&lt;%= markdown(@post.text) %&gt;</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: Adding a 'Like' Function]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/02/11/rails-notes-adding-a-like-function/"/>
    <updated>2014-02-11T21:16:52+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/02/11/rails-notes-adding-a-like-function</id>
    <content type="html"><![CDATA[<p>Instead of text comments, we can easily state our opinion on the article by clicking a &lsquo;Like&rsquo; button or a &lsquo;Vote&rsquo; arrow. It is not uncommon that this function plays a role of recommendation. Last week, I added a similar function called &lsquo;Likeable&rsquo; to my blog-like app. Here is the key notes.</p>

<!-- more -->


<p><strong>Migration and Models</strong></p>

<p>First of all, we <code>rails g migration create_likes</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">CreateLikes</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">up</span>
</span><span class='line'>    <span class="n">create_table</span> <span class="ss">:likes</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">boolean</span> <span class="ss">:like</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">references</span> <span class="ss">:likeable</span><span class="p">,</span> <span class="ss">polymorphic</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">integer</span> <span class="ss">:user_id</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">down</span>
</span><span class='line'>      <span class="n">drop_table</span> <span class="ss">:likes</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here, like boolean will show the choice of like(true) or unlike(false), :user_id will show who made the choice.</p>

<p><code>t.references :likeable, polymorphic: true</code> will generate two columns: <em>likeable_id</em> and <em>likeable_type</em> (e.g. Post or Comment).</p>

<p>With <em>Polymorphic</em> association, a model can belong to more than one other model, on a single association <a href="http://guides.rubyonrails.org/association_basics.html#polymorphic-associations">[1]</a>. In our case, like model can belong to post model or comment model.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Like</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:user</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:likeable</span><span class="p">,</span> <span class="ss">polymorphic</span><span class="p">:</span> <span class="kp">true</span><span class="o">.</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:likes</span><span class="p">,</span> <span class="n">as</span> <span class="ss">:likeable</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Comment</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:likes</span><span class="p">,</span> <span class="n">as</span> <span class="ss">:likeable</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Routes</strong></p>

<p>We would like to use a member routes here.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">resources</span> <span class="ss">:posts</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">member</span> <span class="k">do</span>
</span><span class='line'>          <span class="n">post</span> <span class="s1">&#39;like&#39;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="n">resources</span> <span class="ss">:comments</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">member</span> <span class="k">do</span>
</span><span class='line'>          <span class="n">post</span> <span class="s1">&#39;like&#39;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>It will recognise &lsquo;/post/post_id/like&rsquo; and &lsquo;/post/post_id/comment/id/like&rsquo; with POST, route to the action of PostsController and CommentsController, create the like_post_path and like_post_comment_path helpers.</p>

<p><strong>Views</strong></p>

<p>&lsquo;app/views/posts/show.html.erb&rsquo;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;pull-right&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="sx">%= link_to like_post_path(@post, like: true), method: &#39;post&#39; do %&gt;</span>
</span><span class='line'><span class="sx">  &lt;i class=</span><span class="s2">&quot;icon-thumbs-up&quot;</span><span class="o">&gt;&lt;</span><span class="sr">/i&gt;</span>
</span><span class='line'><span class="sr"> &lt;%= @post.likes.size %&gt;likes %&gt;</span>
</span><span class='line'><span class="sr"> &lt;% end %&gt;</span>
</span><span class='line'><span class="sr">&lt;/s</span><span class="n">pan</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we specify the method POST instead of the default a_tag method GET, by adding <code>method: 'post'</code>. This will add &lsquo;data_method=&ldquo;post&rdquo;&rsquo; to link tag, which will revoke a javascript in rails that convert the link tag to a form and submit it. We also pass in a params &lsquo;like&rsquo; to be true, which means it will count as a &lsquo;Like&rsquo;.</p>

<p>Now we need some actions.</p>

<p><strong>Action</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">PostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="n">before_action</span> <span class="ss">:find_post</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span><span class="o">[</span><span class="err">…</span><span class="p">,</span> <span class="ss">:like</span><span class="o">]</span>
</span><span class='line'>  <span class="n">before_action</span> <span class="ss">:require_user</span><span class="p">,</span> <span class="ss">except</span><span class="p">:</span><span class="o">[</span><span class="err">…</span><span class="o">]</span>
</span><span class='line'>  <span class="err">…</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">like</span>
</span><span class='line'>      <span class="no">Like</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">likeable</span><span class="p">:</span> <span class="vi">@post</span><span class="p">,</span> <span class="ss">user</span><span class="p">:</span> <span class="n">current_user</span><span class="p">,</span> <span class="ss">like</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:like</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>      <span class="n">flash</span><span class="o">[</span><span class="ss">:success</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;Like Counted!&quot;</span>
</span><span class='line'>      <span class="n">redirect_to</span> <span class="ss">:back</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here, we will pass params of @post to likeable_id and likeable_type, current_user &rsquo;s id and set &lsquo;true&rsquo; on like boolean.</p>

<p><strong>Ajax</strong></p>

<p>Every time we hit the &lsquo;Thumbs-up&rsquo; button, it will hit the datebase and rebuild the whole page. It&rsquo;s quite expensive. So we will use another rails magic here.</p>

<p>Simply add <code>remote: true</code>: &lsquo;&lt;%= link_to like_post_path(@post, like: true), method: &#8216;post&rsquo;, remote: true do %>&lsquo;. It will become a ajax request when we hit the &#8216;Thumbs-up&rsquo;.</p>

<p>In the meantime, we add response to this request in controller, revise our show.html.erb and add a <code>like.js.erb</code> view template file in app/views/posts, respectively.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">like</span>
</span><span class='line'>      <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>  <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">format</span><span class="o">.</span><span class="n">html</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">flash</span><span class="o">[</span><span class="ss">:success</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;Like Counted!&quot;</span>
</span><span class='line'>      <span class="n">redirect_to</span> <span class="ss">:back</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  
</span><span class='line'>  <span class="nb">format</span><span class="o">.</span><span class="n">js</span>
</span><span class='line'>  <span class="k">end</span>          
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">span</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;post_&lt;%= @post.id %&gt;_likes&quot;</span><span class="o">&gt;&lt;%=</span> <span class="vi">@post</span><span class="o">.</span><span class="n">likes</span><span class="o">.</span><span class="n">size</span> <span class="sx">%&gt;likes&lt;/span&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span><span class="p">(</span><span class="s2">&quot;#post_&lt;%= @post.id %&gt;_likes&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="s2">&quot;&lt;%= @post.likes.size %&gt;likes&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Expansion</strong></p>

<p>We can also add a &lsquo;Unlike&rsquo; function with a &lsquo;Thumbs-down&rsquo; button.
Instead of <code>like: true</code> params, we set it to false. In order to show the total likes, we add a method called <code>total_likes</code> in post.rb.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">total_likes</span>
</span><span class='line'>  <span class="nb">self</span><span class="o">.</span><span class="n">likes</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">like</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="nb">self</span><span class="o">.</span><span class="n">likes</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">like</span> <span class="ss">:false</span><span class="p">)</span><span class="o">.</span><span class="n">size</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: Adding categories]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/02/11/rails-notes-adding-categories/"/>
    <updated>2014-02-11T20:23:51+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/02/11/rails-notes-adding-categories</id>
    <content type="html"><![CDATA[<p>In the third note, a brief description about adding categories in a blog-like app will be presented. It is a <a href="http://guides.rubyonrails.org/association_basics.html">M-M relationship</a>. We will  apply <code>has_many :through</code> association.</p>

<!-- more -->


<p><strong>Migration</strong>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">CreatePostCategories</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">up</span>
</span><span class='line'>    <span class="n">create_table</span> <span class="ss">:post_categories</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">integer</span> <span class="ss">:post_id</span><span class="p">,</span> <span class="ss">:category_id</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">down</span>
</span><span class='line'>      <span class="n">drop_table</span> <span class="ss">:post_categories</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>PostCategories will have two foreign keys: :post_id and :category_id</p>

<p><strong>Models</strong>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">PostCategory</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:post</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:category</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Category</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:post_categories</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:posts</span><span class="p">,</span> <span class="ss">through</span><span class="p">:</span> <span class="ss">:post_categories</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:post_categories</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:categories</span><span class="p">,</span> <span class="ss">through</span><span class="p">:</span> <span class="ss">:post_categories</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Controller and routes</strong></p>

<p>similar to other resources.</p>

<p><strong>Views</strong></p>

<p>&lsquo;shared/_posts.html.erb&rsquo;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">% object.reverse.each </span><span class="k">do</span> <span class="o">|</span><span class="n">post</span><span class="o">|</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx"> &lt;p&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;badge pull-right&quot;</span><span class="o">&gt;&lt;</span><span class="sx">%= post.comments.count %&gt;&lt;/span&gt;</span>
</span><span class='line'><span class="sx">     &lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">post</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">post_path</span><span class="p">(</span><span class="n">post</span><span class="p">)</span> <span class="sx">%&gt;&lt;br&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="sx">% post.categories.each </span><span class="k">do</span> <span class="o">|</span><span class="n">category</span><span class="o">|</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">     &lt;%= link_to category.name, category_path(category), class: &quot;label&quot; %&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="sx">% end %&gt;</span>
</span><span class='line'><span class="sx">   &lt;span class=&quot;timestamp&quot;&gt;</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="n">small</span><span class="o">&gt;</span><span class="n">posted</span> <span class="n">by</span> <span class="o">&lt;</span><span class="sx">% unless </span><span class="n">post</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">blank?</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">             &lt;%= link_to post.user.username, user_path(post.user) %&gt;</span>
</span><span class='line'>              <span class="o">&lt;</span><span class="sx">% end %&gt;</span>
</span><span class='line'><span class="sx">             &lt;%= time_ago_in_words(post.created_at)%&gt;</span> <span class="n">ago</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="sr">/small&gt;</span>
</span><span class='line'><span class="sr">     &lt;/s</span><span class="n">pan</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="n">hr</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'><span class="sr">&lt;% end %&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>&lsquo;app/views/categories/show.html.erb&rsquo;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="o">&lt;%=</span> <span class="n">render</span> <span class="s1">&#39;shared/posts&#39;</span><span class="p">,</span> <span class="ss">object</span><span class="p">:</span> <span class="vi">@category</span><span class="o">.</span><span class="n">posts</span> <span class="o">%&gt;</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>Add categories selection in _form partial</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s1">&#39;control-group&#39;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="sx">%= f.label &quot;选择节点&quot; %&gt;</span>
</span><span class='line'><span class="sx">  &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">select</span> <span class="ss">:category_ids</span><span class="p">,</span> <span class="no">Category</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">collect</span><span class="p">{</span><span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="o">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="o">]</span><span class="p">},</span> <span class="p">{},</span> <span class="p">{</span><span class="ss">multiple</span><span class="p">:</span> <span class="kp">false</span><span class="p">}</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Add get_categories method in ApplicationController to show categories in header.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">get_categories</span>
</span><span class='line'>  <span class="vi">@categories</span> <span class="o">=</span> <span class="no">Category</span><span class="o">.</span><span class="n">all</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">before_action</span> <span class="ss">:get_categories</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="sx">% @categories.each </span><span class="k">do</span> <span class="o">|</span><span class="n">cat</span><span class="o">|</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">&lt;li&gt;</span><span class="o">&lt;%=</span> <span class="n">link_to</span> <span class="n">cat</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">category_path</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span> <span class="sx">%&gt;&lt;/li&gt;</span>  
</span><span class='line'><span class="o">&lt;</span><span class="sx">% end </span><span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes 2]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/02/11/rails-notes-2/"/>
    <updated>2014-02-11T13:28:40+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/02/11/rails-notes-2</id>
    <content type="html"><![CDATA[<p>Last week, I built a blog prototype based on the twitter-like app in Rails Tutorial. Here is the 2nd note.</p>

<!-- more -->


<p><strong>Email validation</strong></p>

<p>Create a database index on the email column, and require that the index be unique.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">AddIndexToUsersEmail</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">change</span>
</span><span class='line'>    <span class="n">add_index</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">unique</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Add validation &lsquo;app/models/user.rb&rsquo;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">before_save</span> <span class="p">{</span> <span class="nb">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">downcase</span> <span class="p">}</span>
</span><span class='line'><span class="n">validates</span> <span class="ss">:username</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">uniqueness</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span>   <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">15</span> <span class="p">}</span>
</span><span class='line'><span class="no">VALID_EMAIL_REGEX</span> <span class="o">=</span> <span class="sr">/\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i</span>
</span><span class='line'><span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="p">{</span> <span class="ss">with</span><span class="p">:</span> <span class="no">VALID_EMAIL_REGEX</span> <span class="p">},</span>
</span><span class='line'>                                      <span class="ss">uniqueness</span><span class="p">:</span> <span class="p">{</span> <span class="n">case_sensitive</span><span class="p">:</span> <span class="kp">false</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>User authentication</strong></p>

<p>Apply a gem called <code>bcrypt-ruby</code>. Presence validations for the password and its confirmation are automatically added by <code>has_secure_password</code>. Call method <code>authenticate</code> to confirm and   get user.</p>

<p>Generate migration and <code>add_column :users, :password_digest, :string</code> to the table.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">rails</span> <span class="n">g</span> <span class="n">migration</span> <span class="n">add_password_digest_to_users</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Sign in user</strong></p>

<p>create a non-model backed controller <code>sessions</code>. A session is a semi-permanent connection between two computers, such as a client computer running a web browser and a server running Rails. Sessions resource will use a cookie, which is a small piece of text placed on the user’s browser.</p>

<p>non-model backed form for sign-in, using form_tag
alternatively, using form_for(:session, url: sessions_path)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= form_tag &#39;/signin&#39;, method: &#39;post&#39; do %&gt;</span>
</span><span class='line'><span class="sx"> &lt;%=</span> <span class="n">label_tag</span> <span class="ss">:username</span><span class="p">,</span> <span class="s2">&quot;用户名&quot;</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx"> &lt;%= text_field_tag :username %&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">br</span><span class="o">/&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="sx">%= label_tag :password, &quot;密码&quot; %&gt;</span>
</span><span class='line'><span class="sx">     &lt;%=</span> <span class="n">password_field_tag</span> <span class="ss">:password</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx"> &lt;br/&gt;</span>
</span><span class='line'>  <span class="o">&lt;%=</span> <span class="n">submit_tag</span> <span class="s2">&quot;登录&quot;</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;btn btn-primary&quot;</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">&lt;% end %&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>signin page above for <em>new</em> sessions, signing in will <em>create</em> a session, and signing out will <em>destroy</em> it</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">create</span>
</span><span class='line'>  <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by_username</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:username</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">user</span> <span class="o">&amp;&amp;</span> <span class="n">user</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:session</span><span class="o">][</span><span class="ss">:password</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>    <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">destroy</span>
</span><span class='line'>  <span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span> <span class="o">=</span> <span class="kp">nil</span>
</span><span class='line'>      <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>routes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">get</span>   <span class="s1">&#39;/signup&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;users#new&#39;</span>
</span><span class='line'><span class="n">get</span>        <span class="s1">&#39;/signin&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;sessions#new&#39;</span>
</span><span class='line'><span class="n">post</span>   <span class="s1">&#39;/signin&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;sessions#create&#39;</span>
</span><span class='line'><span class="n">get</span> <span class="s1">&#39;/signout&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;sessions#destroy&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Current_user</strong></p>

<p>define current_user in ApplicationController and add <code>helper_method :current_user, :sign_in?, …</code> to make it available to view templates. Alternatively, we can add methods in ApplicationHelper, and add<code>include SessionsHelper</code> in ApplicationController to make it available in controller.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">current_user</span>
</span><span class='line'>  <span class="vi">@current_user</span> <span class="o">||=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span><span class="p">)</span> <span class="k">if</span> <span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">signed_in?</span>
</span><span class='line'>  <span class="o">!!</span><span class="n">current_user</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">require_user</span>
</span><span class='line'>  <span class="k">unless</span> <span class="n">signed_in?</span>
</span><span class='line'>      <span class="n">flash</span><span class="o">[</span><span class="ss">:error</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;请登录.&quot;</span>
</span><span class='line'>      <span class="n">redirect_to</span> <span class="s1">&#39;/signin&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>&ldquo;||=&rdquo; assigning to a variable if it’s nil but otherwise leaving it alone. <em>memorization</em>: calls the find_by method the first time current_user is called, but on subsequent invocations returns @current_user without hitting the database.</p>

<p>sign in user upon sign up:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">if</span> <span class="vi">@user</span><span class="o">.</span><span class="n">save</span>
</span><span class='line'>  <span class="n">session</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">id</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>add_user_id_to_post</code> and assign user_id to new post</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">create</span>
</span><span class='line'>  <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">post_params</span><span class="p">)</span>
</span><span class='line'>  <span class="vi">@post</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">current_user</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Update user</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">update</span>
</span><span class='line'>  <span class="k">if</span> <span class="vi">@user</span><span class="o">.</span><span class="n">update_attributes</span><span class="p">(</span><span class="n">user_params</span><span class="p">)</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="vi">@user</span><span class="o">.</span><span class="n">new_record?</span> <span class="p">?</span> <span class="s2">&quot;注册&quot;</span> <span class="p">:</span> <span class="s2">&quot;更新&quot;</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;btn btn-primary&quot;</span><span class="p">)</span> <span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Add gravatar</strong></p>

<p>add in &lsquo;app/helper/user_helper.rb&rsquo; and call &lt;%= gravatar_for @user %></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">UsersHelper</span>
</span><span class='line'>  <span class="c1"># Returns the Gravatar (http://gravatar.com/) for the given user.</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">gravatar_for</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</span><span class='line'>    <span class="n">gravatar_id</span> <span class="o">=</span> <span class="ss">Digest</span><span class="p">:</span><span class="ss">:MD5</span><span class="o">::</span><span class="n">hexdigest</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">downcase</span><span class="p">)</span>
</span><span class='line'>    <span class="n">gravatar_url</span> <span class="o">=</span> <span class="s2">&quot;https://secure.gravatar.com/avatar/</span><span class="si">#{</span><span class="n">gravatar_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="n">image_tag</span><span class="p">(</span><span class="n">gravatar_url</span><span class="p">,</span> <span class="ss">alt</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;gravatar&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>add some styles</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="c">/* gravatar */</span>
</span><span class='line'><span class="nc">.gravatar-sm</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">margin-right</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">height</span><span class="o">:</span><span class="m">48px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">width</span><span class="o">:</span><span class="m">48px</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.gravatar-normal</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">height</span><span class="o">:</span><span class="m">64px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">width</span><span class="o">:</span><span class="m">64px</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Require the same user</strong></p>

<p>&lsquo;app/controllers/application_controller.rb&rsquo;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">correct_user?</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</span><span class='line'>  <span class="n">user</span> <span class="o">==</span> <span class="n">current_user</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>&lsquo;app/controllers/users_controller.rb&rsquo;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">before_action</span> <span class="ss">:correct_user</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span><span class="o">[</span><span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">correct_user</span>
</span><span class='line'>  <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="n">redirect_to</span> <span class="n">root_path</span> <span class="k">unless</span> <span class="n">correct_user?</span><span class="p">(</span><span class="vi">@user</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Change date format</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">ApplicationHelper</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">display_date</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
</span><span class='line'>      <span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%d/%m/%Y&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Others</strong></p>

<p>apart from @import bootstrap in app/assets/stylesheets/custom.css.scss
//= require bootstrap in app/assets/javascripts/application.js</p>

<p>flash.now #disappear as soon as there is an additional request.</p>

<p>issue:
when I submit blank comment, it leads to error. this is because I run the _comments.html.erb before render the error message.</p>

<p>solution:
add &lt;% unless comment.body.blank? %> &hellip;. &lt;% end %> in _comments partial.</p>

<p>Strong parameters:
The reason is that initializing the entire params hash is extremely dangerous—it arranges to pass to User.new all data submitted by a user. In particular, suppose that, in addition to the current attributes, the User model included an admin attribute used to identify administrative users of the site. The way to set such an attribute to true is to pass the value admin=’1’ as part of params[:user], a task that is easy to accomplish using a command-line HTTP client such as curl. The result would be that, by passing in the entire params hash to User.new, we would allow any user of the site to gain administrative access by including admin=’1’ in the web request.</p>

<p>&lt;%= render &lsquo;shared/posts&rsquo; , objects: @posts%> to reduce duplication</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes 1]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/01/27/rails-note-1/"/>
    <updated>2014-01-27T09:32:52+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/01/27/rails-note-1</id>
    <content type="html"><![CDATA[<p>After reading <a href="http://ruby.railstutorial.org"><em>Ruby on Rails Tutorial</em></a> &mdash;without a sound approach to the testing part, I am still confused. Before that I read the first chapter of <a href="http://guides.rubyonrails.org"><em>Rails Guides</em></a>, watched some courses about HTML and CSS on <a href="http://zfer.us/9yIBW"><em>Code School</em></a>. So it&rsquo;s better than the first time when I gived up halfway.</p>

<p>I decided to start a project similar to the sample_app for practice. It will be a blog-like web app, focusing on the startup news and stories in Chinese.</p>

<p>I will take some notes here throughout the whole progress.</p>

<!-- more -->


<ul>
<li><strong>Migrations</strong></li>
</ul>


<p>run <code>rails generate migration CreatePosts title:string text:text</code> to create a blank migration</p>

<p>create tables and run <code>rake db:migrate</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">CreatePosts</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">up</span>
</span><span class='line'>      <span class="n">create_table</span> <span class="ss">:posts</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>          <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:title</span>
</span><span class='line'>          <span class="n">t</span><span class="o">.</span><span class="n">text</span> <span class="ss">:text</span>
</span><span class='line'>          <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">down</span>
</span><span class='line'>      <span class="n">drop_table</span> <span class="ss">:posts</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>naming: <code>PostCategory.tableize</code></p>

<ul>
<li><strong>Models</strong></li>
</ul>


<p>create &lsquo;post.rb&rsquo; under /app/models, some valiations and 1-M relationship.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:comments</span>
</span><span class='line'>  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span>
</span><span class='line'>                                      <span class="ss">uniqueness</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span>
</span><span class='line'>                                      <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">minimum</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
</span><span class='line'>  <span class="n">validates</span> <span class="ss">:text</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>create &lsquo;category.rb&rsquo; and &lsquo;post_categories.rb&rsquo; to establish a M-M relationship</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Category</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:post_categories</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:posts</span><span class="p">,</span> <span class="ss">through</span><span class="p">:</span> <span class="ss">:post_categories</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">uniqueness</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:post_categories</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:categories</span><span class="p">,</span> <span class="ss">through</span><span class="p">:</span> <span class="ss">:post_categories</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">PostCategory</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:post</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:category</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>run <code>rails console</code> to check</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">first</span>
</span><span class='line'><span class="n">post</span><span class="o">.</span><span class="n">categories</span>
</span><span class='line'><span class="n">cat</span> <span class="o">=</span> <span class="no">Category</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;news&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">post</span><span class="o">.</span><span class="n">categories</span> <span class="o">&lt;&lt;</span> <span class="n">cat</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>Routes</strong></li>
</ul>


<p>nested routes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">resources</span> <span class="ss">:posts</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">resources</span> <span class="ss">:comments</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>run <code>rake routes</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>         <span class="no">Prefix</span> <span class="no">Verb</span>             <span class="no">URI</span> <span class="no">Pattern</span>                             <span class="no">Controller</span><span class="c1">#Action</span>
</span><span class='line'><span class="n">post_comments</span> <span class="no">GET</span>    <span class="sr">/posts/</span><span class="ss">:post_id</span><span class="o">/</span><span class="n">comments</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>          <span class="n">comments</span><span class="c1">#index</span>
</span><span class='line'>              <span class="no">POST</span>   <span class="sr">/posts/</span><span class="ss">:post_id</span><span class="o">/</span><span class="n">comments</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>          <span class="n">comments</span><span class="c1">#create</span>
</span><span class='line'> <span class="n">new_post_comment</span> <span class="no">GET</span>    <span class="sr">/posts/</span><span class="ss">:post_id</span><span class="o">/</span><span class="n">comments</span><span class="o">/</span><span class="kp">new</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>      <span class="n">comments</span><span class="c1">#new</span>
</span><span class='line'><span class="n">edit_post_comment</span> <span class="no">GET</span>    <span class="sr">/posts/</span><span class="ss">:post_id</span><span class="o">/</span><span class="n">comments</span><span class="o">/</span><span class="ss">:id</span><span class="o">/</span><span class="n">edit</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span> <span class="n">comments</span><span class="c1">#edit</span>
</span><span class='line'> <span class="n">post_comment</span> <span class="no">GET</span>    <span class="sr">/posts/</span><span class="ss">:post_id</span><span class="o">/</span><span class="n">comments</span><span class="o">/</span><span class="ss">:id</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>      <span class="n">comments</span><span class="c1">#show</span>
</span><span class='line'>              <span class="no">PATCH</span>  <span class="sr">/posts/</span><span class="ss">:post_id</span><span class="o">/</span><span class="n">comments</span><span class="o">/</span><span class="ss">:id</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>      <span class="n">comments</span><span class="c1">#update</span>
</span><span class='line'>              <span class="no">PUT</span>    <span class="sr">/posts/</span><span class="ss">:post_id</span><span class="o">/</span><span class="n">comments</span><span class="o">/</span><span class="ss">:id</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>      <span class="n">comments</span><span class="c1">#update</span>
</span><span class='line'>              <span class="no">DELETE</span> <span class="sr">/posts/</span><span class="ss">:post_id</span><span class="o">/</span><span class="n">comments</span><span class="o">/</span><span class="ss">:id</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>      <span class="n">comments</span><span class="c1">#destroy</span>
</span><span class='line'>        <span class="n">posts</span> <span class="no">GET</span>    <span class="sr">/posts(.:format)                            posts#index</span>
</span><span class='line'><span class="sr">              POST   /</span><span class="n">posts</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>                            <span class="n">posts</span><span class="c1">#create</span>
</span><span class='line'>     <span class="n">new_post</span> <span class="no">GET</span>    <span class="sr">/posts/ne</span><span class="n">w</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>                        <span class="n">posts</span><span class="c1">#new</span>
</span><span class='line'>    <span class="n">edit_post</span> <span class="no">GET</span>    <span class="sr">/posts/</span><span class="ss">:id</span><span class="o">/</span><span class="n">edit</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>                   <span class="n">posts</span><span class="c1">#edit</span>
</span><span class='line'>         <span class="n">post</span> <span class="no">GET</span>    <span class="sr">/posts/</span><span class="ss">:id</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>                        <span class="n">posts</span><span class="c1">#show</span>
</span><span class='line'>              <span class="no">PATCH</span>  <span class="sr">/posts/</span><span class="ss">:id</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>                        <span class="n">posts</span><span class="c1">#update</span>
</span><span class='line'>              <span class="no">PUT</span>    <span class="sr">/posts/</span><span class="ss">:id</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>                        <span class="n">posts</span><span class="c1">#update</span>
</span><span class='line'>              <span class="no">DELETE</span> <span class="sr">/posts/</span><span class="ss">:id</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>                        <span class="n">posts</span><span class="c1">#destroy</span>
</span></code></pre></td></tr></table></div></figure>


<p>Example link to usage</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= link_to &#39;All posts&#39;, posts_path %&gt;</span>
</span><span class='line'><span class="sx">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;New post&#39;</span><span class="p">,</span> <span class="n">new_post_path</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">&lt;%= link_to &#39;Edit post&#39;, edit_post_path(@post) %&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="sx">%= link_to &#39;Show post&#39;, post_path(@post)%&gt; # or @post</span>
</span><span class='line'><span class="sx">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Delete post&#39;</span><span class="p">,</span> <span class="vi">@post</span><span class="p">,</span> <span class="nb">method</span><span class="p">:</span> <span class="ss">:delete</span><span class="p">,</span> <span class="ss">data</span><span class="p">:</span> <span class="p">{</span> <span class="ss">confirm</span><span class="p">:</span> <span class="s1">&#39;Sure&#39;</span><span class="sc">?}</span> <span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>Controller</strong></li>
</ul>


<p>create &lsquo;posts_controller.rb&rsquo; under /app/controllers</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">PostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="n">before_action</span> <span class="ss">:find_post</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span><span class="o">[</span><span class="ss">:show</span><span class="p">,</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="p">,</span> <span class="ss">:destroy</span><span class="o">]</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">def</span> <span class="nf">index</span>
</span><span class='line'>      <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">all</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">show</span>
</span><span class='line'>      <span class="vi">@comment</span> <span class="o">=</span> <span class="no">Comment</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">new</span>
</span><span class='line'>      <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">create</span>
</span><span class='line'>      <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">post_params</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="vi">@post</span><span class="o">.</span><span class="n">save</span>
</span><span class='line'>          <span class="n">flash</span><span class="o">[</span><span class="ss">:success</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;发布成功&quot;</span>
</span><span class='line'>          <span class="n">redirect_to</span> <span class="vi">@post</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>          <span class="n">render</span> <span class="s1">&#39;new&#39;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">edit</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">update</span>
</span><span class='line'>      <span class="k">if</span> <span class="vi">@post</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:post</span><span class="o">].</span><span class="n">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:text</span><span class="p">))</span>
</span><span class='line'>          <span class="n">flash</span><span class="o">[</span><span class="ss">:success</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;更新成功&quot;</span>
</span><span class='line'>          <span class="n">redirect_to</span> <span class="vi">@post</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>          <span class="n">render</span> <span class="s1">&#39;edit&#39;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">destroy</span>
</span><span class='line'>      <span class="vi">@post</span><span class="o">.</span><span class="n">destroy</span>
</span><span class='line'>      <span class="n">redirect_to</span> <span class="vi">@post</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>      <span class="k">def</span> <span class="nf">find_post</span>
</span><span class='line'>          <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">post_params</span>
</span><span class='line'>          <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:post</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:text</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>Views</strong></li>
</ul>


<p>View Partials
create &lsquo;_form.html.erb&rsquo; under /app/views/posts</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># model backed form</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;well&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="sx">%= form_for @post do |f| %&gt;</span>
</span><span class='line'><span class="sx">     &lt;%=</span> <span class="n">render</span> <span class="s1">&#39;shared/error&#39;</span><span class="p">,</span> <span class="ss">object</span><span class="p">:</span> <span class="vi">@post</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">     </span>
</span><span class='line'><span class="sx">     &lt;div class=&quot;control-group&quot;&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="sx">%= f.label &quot;标题&quot; %&gt;</span>
</span><span class='line'><span class="sx">     &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;input-block-level&quot;</span> <span class="sx">%&gt; #full-width</span>
</span><span class='line'><span class="sx">     &lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;control-group&quot;</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="sx">%= f.label &quot;内容&quot; %&gt;</span>
</span><span class='line'><span class="sx">     &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_area</span> <span class="ss">:text</span><span class="p">,</span> <span class="ss">rows</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;input-block-level&quot;</span> <span class="sx">%&gt; </span>
</span><span class='line'><span class="sx">     &lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="o">&lt;</span><span class="sx">%= f.submit(@post.new_record? ? &quot;发布&quot; : &quot;更新&quot;, class: &quot;btn btn-primary&quot;) %&gt;</span>
</span><span class='line'><span class="sx"> &lt;% end %&gt;</span>
</span><span class='line'><span class="sx"> &lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;取消&#39;</span><span class="p">,</span> <span class="n">posts_path</span><span class="p">(</span><span class="vi">@post</span><span class="p">)</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>&lsquo;show.html.erb&rsquo; under /app/views/posts</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;span9&quot;</span><span class="o">&gt;</span>
</span><span class='line'>          <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'>          <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;well&quot;</span><span class="o">&gt;</span>
</span><span class='line'>              <span class="o">&lt;</span><span class="sx">% if </span><span class="vi">@post</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">any?</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">                 &lt;% @post.comments.each do |c| %&gt;</span>
</span><span class='line'>                      <span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;&lt;</span><span class="sx">%= c.body %&gt;&lt;/p&gt;</span>
</span><span class='line'><span class="sx">                 &lt;% end %&gt;</span>
</span><span class='line'><span class="sx">             &lt;% end %&gt;</span>
</span><span class='line'><span class="sx">             &lt;hr&gt;</span>
</span><span class='line'><span class="sx">             &lt;%=</span> <span class="n">form_for</span> <span class="o">[</span><span class="vi">@post</span><span class="p">,</span> <span class="vi">@comment</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">                 &lt;%= render &#39;shared/error&#39;, object: @comment %&gt;</span>
</span><span class='line'>                  <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;control-group&quot;</span><span class="o">&gt;</span>
</span><span class='line'>                      <span class="o">&lt;</span><span class="sx">%= f.text_area :body, rows: 5, class: &quot;input-block-level&quot; %&gt;</span>
</span><span class='line'><span class="sx">                 &lt;/div&gt;</span>
</span><span class='line'><span class="sx">                 &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s1">&#39;发表评论&#39;</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;btn btn-primary&quot;</span><span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">             &lt;% end %&gt;</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="sr">/div&gt;</span>
</span><span class='line'><span class="sr">     &lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;span3&quot;</span><span class="o">&gt;</span>
</span><span class='line'>          <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="sr">/div&gt;</span>
</span><span class='line'><span class="sr"> &lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>non-model backed form:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= form_tag :title %&gt;</span>
</span><span class='line'><span class="sx"> &lt;%=</span> <span class="n">lable_tag</span> <span class="ss">:title</span><span class="sx">%&gt;</span>
</span><span class='line'><span class="sx"> &lt;%= text_field_tag :title%&gt;</span>
</span><span class='line'>  <span class="p">,,,</span>
</span><span class='line'>  <span class="o">&lt;%=</span><span class="n">submit_tag</span> <span class="s1">&#39;create post&#39;</span><span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">&lt;%end %&gt;</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[曼游记之最后一案]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/01/15/the-adventure-of-the-last-problem/"/>
    <updated>2014-01-15T19:30:07+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/01/15/the-adventure-of-the-last-problem</id>
    <content type="html"><![CDATA[<p><em>曼游记</em> 历经三年，现在终于接近尾声。可惜我没有什么文笔，把这些旅行写得如此平淡，往往三言两语就想了事，许多有趣独特的经历便就此埋没。等我教育下一代的时候，应该无法像托尔金那样创作一个霍比特人，大概只能拿出手机，发个链接，&#8217;An unexpected journey, see details <a href="http://voice.lawrencesun.info/blog/categories/travel/">here</a>.&lsquo;… 若是反响不佳，就说是链接被黑了…</p>

<p>此番出行决定得比较突然，没做什么准备，前一天晚上订了房间车票，拿起一个单肩包就上路了。照例还是一大早从曼彻斯特出发。火车历时近四个小时，抵达了卡迪夫。因为天气好，加上周六车次相比周日稍微多一点，我便决定立即转车去看海。前往斯旺西的火车只有一节… 在车上小憩片刻，一个小时后便到了，途中还看到了斯旺西的主场。</p>

<!-- more -->


<p>走出火车站，什么标记或者地图指示都没，打开水果地图结果连汽车站都搜不到。还是要靠我大谷歌啊，结果我靠，让我在同一个地方绕了两圈。终于找到汽车站了，和一帮老头老太们一起坐车前往Rhossili Bay。公车在狭小的道路上奔驰，路过各种农场，山丘和富人区，来到了威尔士最著名的海滩之一。</p>

<p><img src="https://lh4.googleusercontent.com/-GrFwhaVeS70/UtZ50MzRRqI/AAAAAAAAALI/w99NamGfqD4/w400/h300" title="Rhossili Bay" alt="img" /></p>

<p>今年去了不少海滩，所以就没有下到沙滩，而是沿着山崖上的石子路漫步。这里和北爱尔兰的巨人之路有点相似，山崖一边是宁静的农场和村庄，一边是辽阔的大海。此时正值下午，夕阳西下，月亮也在另一头隐现，美如画卷。像法国蔚蓝海岸那样的，更适合晒晒日光浴，喝喝啤酒，看看美女。而眼前的这个宁静却壮丽的海岸，则更适合漫步其间，慢慢品味。</p>

<p><img src="https://lh4.googleusercontent.com/-DzrLD8RJiLY/UtZ6JI2l4hI/AAAAAAAAALs/FM3qD0IOhW4/w400/h300" title="Sunset" alt="img" /></p>

<p>静静地站在海边看了日落后，匆匆赶上了回斯旺西的公车。由于此时已经入夜，顾不上晚饭就直接回到了卡迪夫。拖着略显疲惫的身躯来到了之前预订的B&amp;B. 房间比我想像的要大不少，保留着些许维多利亚时期风格的家具和装饰。洗完澡躺床上看了电视上放的上个世纪的007，里面还有我大天朝。</p>

<p>早上9点多爬起来，吃了早餐后便退房出门。穿过公园，步行至卡迪夫城堡。说是城堡，主要还是参观城堡前主人的House。虽然这个府邸并不是很大，但是装饰和布局的细节之处还是有些与众不同。比如在塔楼有专门的男士间用来抽烟，房顶和四周的彩窗分别有季节，礼拜和一天的时间更替。顶层开放式阁楼有小型的喷泉，四周是希伯来语，显示出主人的博学多识，据说他认识21种语言，会说其中的10多个。值得一提的是，会客厅在一八八几年就采用了热水循环的中央供暖并且沿用至今，这里还是全英第三家通电的家庭。</p>

<p><img src="https://lh5.googleusercontent.com/-dWOMF4T3Fqc/UtZ4Z8aZV9I/AAAAAAAAAKo/I-GkZKDz8FM/w400/h300" title="Cardiff Castle" alt="img" /></p>

<p>住所旁有一个残破的城堡，站在顶端可以远眺全城，包括不远处的千禧年橄榄球场。城堡四周的城墙在二战期间被改造成防空洞。如同英国大多数城堡一样，衰落的贵族无法承担卡迪夫城堡高额的税费和保养费，选择交归国有。</p>

<p>在商业步行街喝完咖啡，选定了下一个目的地，位于Cardiff Bay 的Doctor Who 体验馆。这个系列的电视剧在英村热播了五十年，而且还在继续制作。BBC Wales 总部也在附近，现在热播的Sherlock也是这个部门制作的。体验包括半个小时左右的互动和展览。出来在附近逛了一圈，比较现代，和曼城的Salford Quay 很像。</p>

<p><img src="https://lh3.googleusercontent.com/-kCzkc403A8Y/UtZ8jbQhpJI/AAAAAAAAAL8/yHVTdcwqiFk/w400/h300" title="Cardiff Bay" alt="img" /></p>

<p>由于天黑得早，没什么地方可去，逛了下商店，就在火车站简单吃点候车。拿铁咖啡还没我做的好…
南威尔士两日之旅就此结束。</p>

<p><sub>2014.01.12 写于卡迪夫中央火车站&amp;回曼彻斯特火车</sub></p>

<p><sub>P.S. <code>曼游记</code>并未结束，因为去年欧洲之旅的账还没还清。<a href="http://lawrencesun.info/blog/?tag=%E6%9B%BC%E6%B8%B8%E8%AE%B0">Previous Review</a> </sub></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[My Git Cheet Sheet]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/01/09/my-git-cheet-sheet/"/>
    <updated>2014-01-09T05:08:18+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/01/09/my-git-cheet-sheet</id>
    <content type="html"><![CDATA[<p>When I saw the Error on my rails sample_app and couldn&rsquo;t find the solution the other day, I wanted to abort the changes and intended to go back to the last commit. I searched on <em>stackoverflow</em> and followed the instruction, ran something like</p>

<pre><code>git reset --Hard 
</code></pre>

<p>Then&hellip; I messed up the files and commits, unsurprisingly.</p>

<p>So I decided to learn some basic command of <strong>Git</strong> apart from</p>

<pre><code>git add .
git commit -m "I need a cupa"
git push
</code></pre>

<p>After watching and practing Git command from <strong>Git Real</strong> on <a href="http://zfer.us/9yIBW">Code School</a>, I generated a basic <em>cheat sheet</em> for myself. Here it is.</p>

<!-- more -->


<ul>
<li><strong>Create</strong></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="c1"># Start a new repo</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">init</span>
</span><span class='line'> <span class="c1"># Clone existing repo</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="nb">clone</span> <span class="ss">ssh</span><span class="p">:</span><span class="sr">//use</span><span class="n">r</span><span class="vi">@domain</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">rego</span><span class="o">.</span><span class="n">git</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>Local Change</strong></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="c1"># Check what&#39;s changed</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">status</span>
</span><span class='line'> <span class="c1"># Add all current changes to the next commit (staging area)</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">add</span> <span class="o">.</span>
</span><span class='line'> <span class="c1"># Add some files</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">add</span> <span class="o">&lt;</span><span class="n">filename</span><span class="o">&gt;</span>
</span><span class='line'> <span class="c1"># Add files in /doc directory</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">add</span> <span class="n">doc</span><span class="o">/</span>
</span><span class='line'> <span class="c1"># Add all txt files</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">add</span> <span class="o">*.</span><span class="n">txt</span>
</span><span class='line'> <span class="c1"># Commit previously staged changes</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;Desperately need coffee&quot;</span>
</span><span class='line'> <span class="c1"># Commit all changes from tracked(not new) files  </span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;Coffee...&quot;</span>
</span><span class='line'> <span class="c1"># Change the last commit</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">commit</span> <span class="o">--</span><span class="n">amend</span>
</span><span class='line'> <span class="c1"># Show difference</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">diff</span>
</span><span class='line'> <span class="c1"># Show staged difference</span>
</span><span class='line'> <span class="c1"># git diff --staged</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>Remote</strong></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="c1"># Add a remote</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">remote</span> <span class="n">add</span> <span class="o">&lt;</span><span class="n">remote</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span>
</span><span class='line'> <span class="c1"># Delete a remote</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">remote</span> <span class="o">-</span><span class="n">mv</span> <span class="o">&lt;</span><span class="n">remote</span><span class="o">&gt;</span>
</span><span class='line'> <span class="c1"># List all remote repos</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">remote</span> <span class="o">-</span><span class="n">v</span>
</span><span class='line'> <span class="c1"># Push local branch to remote repo, -u to set default </span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">push</span> <span class="o">-</span><span class="n">u</span> <span class="o">&lt;</span><span class="n">remote</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">branch</span><span class="o">&gt;</span>
</span><span class='line'> <span class="c1"># Pull changes down from the remote. Including fetch(sync) and merge. </span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">pull</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>History</strong></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="c1"># Show all commits</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">log</span>
</span><span class='line'> <span class="c1"># Show commits with graph</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">log</span> <span class="o">--</span><span class="n">online</span> <span class="o">--</span><span class="n">graph</span>
</span><span class='line'> <span class="c1"># Show who chaged what </span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">blame</span> <span class="o">&lt;</span><span class="n">filename</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>Undo</strong></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="c1"># Discard all the changes since last commit</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">checkout</span> <span class="o">--</span> <span class="o">&lt;</span><span class="n">filename</span><span class="o">&gt;</span>
</span><span class='line'> <span class="c1"># Undo last commit and put changes into staging</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">reset</span> <span class="o">--</span><span class="n">soft</span> <span class="no">HEAD</span><span class="o">^</span>
</span><span class='line'> <span class="c1"># Undo last 2 commits and all changes</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">reset</span> <span class="o">--</span><span class="n">hard</span> <span class="no">HEAD</span><span class="o">^^</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>Tags and Branches</strong></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="c1"># Mark current commit with a tag</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">tag</span> <span class="o">&lt;</span><span class="nb">name</span><span class="o">&gt;</span>
</span><span class='line'> <span class="c1"># List existing branches</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">branch</span>
</span><span class='line'> <span class="c1"># Create a new branch</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">branch</span> <span class="o">&lt;</span><span class="n">new_branch</span><span class="o">&gt;</span>
</span><span class='line'> <span class="c1"># Create a new branch and switch to it</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">checkout</span> <span class="o">-</span><span class="n">b</span> <span class="o">&lt;</span><span class="n">new_branch</span><span class="o">&gt;</span>
</span><span class='line'> <span class="c1"># Switch HEAD branch</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">checkout</span> <span class="o">&lt;</span><span class="n">branch</span><span class="o">&gt;</span>
</span><span class='line'> <span class="c1"># Check remote branches</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">branch</span> <span class="o">-</span><span class="n">r</span>
</span><span class='line'> <span class="c1"># Delete a local branch</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">branch</span> <span class="o">-</span><span class="n">d</span> <span class="o">&lt;</span><span class="n">branch</span><span class="o">&gt;</span>
</span><span class='line'> <span class="c1"># Delete a remote &lt;branch&gt;</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">push</span> <span class="n">origin</span> <span class="o">&lt;</span><span class="n">branch</span><span class="o">&gt;</span>
</span><span class='line'> <span class="c1"># Clean up deleted remote branches</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">remote</span> <span class="n">prune</span> <span class="n">origin</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>Merge and Rebase</strong></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="c1"># Merge &lt;branch&gt; into current HEAD</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">merge</span> <span class="o">&lt;</span><span class="n">branch</span><span class="o">&gt;</span>
</span><span class='line'> <span class="c1"># Fetch(sync) remote but don&#39;t merge</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">fetch</span>
</span><span class='line'> <span class="c1"># Rebase current HEAD onto &lt;branch&gt;</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">rebase</span> <span class="o">&lt;</span><span class="n">branch</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>Config</strong></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="c1"># Global user name and email</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">config</span> <span class="o">--</span><span class="n">global</span> <span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="s2">&quot;name&quot;</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">config</span> <span class="o">--</span><span class="n">global</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="s2">&quot;email&quot;</span>
</span><span class='line'> <span class="c1"># Alias</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">config</span> <span class="k">alias</span><span class="o">.</span><span class="n">&lt;</span><span class="nb">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">command</span><span class="o">&gt;</span>
</span><span class='line'> <span class="c1"># Colour UI</span>
</span><span class='line'> <span class="err">$</span> <span class="n">git</span> <span class="n">config</span> <span class="o">--</span><span class="n">global</span> <span class="n">color</span><span class="o">.</span><span class="n">ui</span> <span class="kp">true</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Add About Page]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/01/09/add-about-page/"/>
    <updated>2014-01-09T04:47:46+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/01/09/add-about-page</id>
    <content type="html"><![CDATA[<p>Three steps:</p>

<ul>
<li>Run
<code>
rake new_page[about]
</code></li>
<li>Add following code to &ldquo;/source/_includes/custom/navigation.html file&rdquo;</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> &lt;li&gt;&lt;a href="http://voice.lawrencesun.info/about"&gt;About&lt;/a&gt;&lt;/li&gt;</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Edit &ldquo;/about/index.markdown&rdquo; file if you want.</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Add Weibo Support to Octopress Blog]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/01/09/add-weibo-support-to-octopress-blog/"/>
    <updated>2014-01-09T03:39:38+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/01/09/add-weibo-support-to-octopress-blog</id>
    <content type="html"><![CDATA[<p>Since I will go back China very soon, I think adding a <em>Weibo</em> link on the sidebar might be a good move. To be honest, I am not too keen on Weibo. The reason? Information overload.</p>

<ul>
<li>First, add following code to &ldquo;/source/_includes/header.html&rdquo;</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{ % if site.weibo_user % }
</span><span class='line'>  &lt;a class="weibo" href="http://www.weibo.com/ylsun" title="Weibo"&gt;Weibo&lt;/a&gt;
</span><span class='line'>{ % endif % }</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Second, add following code to &ldquo;/sass/parts/_header.scss&rdquo;</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="o">&amp;</span><span class="nc">.weibo</span><span class="p">{</span>
</span><span class='line'>  <span class="k">background</span><span class="o">:</span> <span class="n">image</span><span class="o">-</span><span class="sx">url(&#39;social/weibo.png&#39;)</span> <span class="k">center</span> <span class="k">no-repeat</span> <span class="m">#e32529</span><span class="p">;</span>
</span><span class='line'>  <span class="k">border</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="m">#e32529</span><span class="p">;</span>
</span><span class='line'>  <span class="o">&amp;:</span><span class="n">hover</span><span class="err">{</span>
</span><span class='line'>      <span class="k">border</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="n">darken</span><span class="p">(</span><span class="m">#e32529</span><span class="o">,</span> <span class="m">10</span><span class="o">%</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="err">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Then, add the <a href="https://github.com/lawrencesun/lawrencesun.github.io/tree/source/source/images/social">“weibo.png”</a> to “/source/images/social” dirctory.</li>
<li>Finally, add following code to &ldquo;_config.yml&rdquo;</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="err">#</span> <span class="nt">Weibo</span>
</span><span class='line'><span class="nt">weibo_user</span><span class="o">:</span> <span class="nt">ylsun</span> <span class="err">#</span> <span class="err">微博数字</span> <span class="nt">ID</span> <span class="err">或域名</span> <span class="nt">ID</span>
</span><span class='line'><span class="nt">weibo_share</span><span class="o">:</span> <span class="nt">true</span>
</span></code></pre></td></tr></table></div></figure>


<p><sub>Thanks for sharing <a href="http://www.imallen.com/blog/2013/05/12/add-support-for-weibo-and-dribbble-to-greyshade.html">Allen</a> </sub></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Fitbit Flex Review]]></title>
    <link href="http://voice.lawrencesun.info/posts/2013/12/31/fitbit-flex-review/"/>
    <updated>2013-12-31T07:54:52+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2013/12/31/fitbit-flex-review</id>
    <content type="html"><![CDATA[<p>I bought myself <a href="http://www.fitbit.com/uk"><em>Fitbit Flex</em></a> as a Christmas gift. It was on the top of my wishing list. I was planning to wait <em>Fitbit Force</em> which might be released in the next few months. However, after reading the reviews on Amazon US, I decided to buy <em>Flex</em> instead.</p>

<p>I have used it for nearly a week. Really enjoyed it so far.</p>

<p><img src="https://lh4.googleusercontent.com/-VtniTUVFNMA/UsIWsq2Bq5I/AAAAAAAAAI0/36cxzvZAYLE/w250/h200"></p>

<p><strong>Motivation</strong></p>

<p>I walked more than usual this week. I went to City Centre on foot twice in order to achieve everyday goal set on this tiny device.</p>

<p><strong>Battery</strong></p>

<p>I haven&rsquo;t charged it for almost one week. Impressed.</p>

<p><strong>Steps Count</strong></p>

<p>Unlike the traditional step counter, <em>Flex</em> is with you all the time. You can also track the progress by simply tap it twice.</p>

<p><strong>Sleep Tracking</strong></p>

<p>Another feature I liked is sleep tracking. Tap it rapidly to step into sleep model. It will record the time of restless and awake, as well as the sleeping hour.</p>

<p><img src="https://lh4.googleusercontent.com/iO0bpbGT6CFjslpMTKCE8GrU5NsbBXQI9gd8Bo-WvrY=w170-h225-no"> <img src="https://lh3.googleusercontent.com/-T2gqv0pND1g/UsIWunWl3LI/AAAAAAAAAJE/ojbTvVVeQRM/w170/h225"></p>

<p><strong>Alarm</strong></p>

<p>It will vibrates at the time you set on the iPhone.</p>

<p><strong>Sync</strong></p>

<p>Sync smoothly with my iPhone through Bluetooth. So I am able to see the realtime data of steps, distance, calories burned, active minutes etc.</p>

<p><strong>Water Proof</strong></p>

<p>You can used it in the shower or in the rain in theory. I have never tried this though.</p>

<p><strong>Third Party App</strong></p>

<p>Several fitness apps support it.</p>

<p><strong>Downsides</strong></p>

<ul>
<li><p>Have to log food eaten by myself. So I just ignore this.</p></li>
<li><p>Not be able to track other activities like cycling.</p></li>
<li><p>Will get some <em>&lsquo;bonus&rsquo;</em> steps since it&rsquo;s wrist-based.</p></li>
<li><p>No altimeter.</p></li>
</ul>


<p><em>Overall</em>, I highly recommend it.</p>

<p><sub><a href="http://lawrencesun.info/blog/?cat=71">Previous Gadgets Reviews</a> </sub></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Cracker Jokes]]></title>
    <link href="http://voice.lawrencesun.info/posts/2013/12/25/cracker-jokes/"/>
    <updated>2013-12-25T13:25:07+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2013/12/25/cracker-jokes</id>
    <content type="html"><![CDATA[<p>I spent few hours on building <a href="http://crackerjokes.herokuapp.com/"><strong>Cracker Jokes</strong></a> &mdash; A Web Application based on <em>Ruby</em> and <em>Sinatra</em>.</p>

<p>I have little knowledge of Christmas. Sleeping and eating instant noodles was the theme of last few Christmas. This year, however, I am invited to a Christmas party. Apart from chosing the gifts, I also got to know some more about Christmas tradition.</p>

<p>Craker Jokes is one of them. I have seen it few times on UK films and also inside Tescos. So I came up with the idea &mdash; backing up some <em>cracker jokes</em> for the party.</p>

<p>I decide to use Ruby and Sinatra to realize it. Since I built a similar web app last summer, I set up this app quickly.</p>

<p>The feature is quite simple, pop up a joke and click to see the next. <a href="http://crackerjokes.herokuapp.com/">Click here and have fun!</a> Suggestions are always <a href="https://github.com/lawrencesun/crackerjokes"><em>welcome</em></a>.</p>

<p><em>Merry Christmas and Happy New Year</em></p>
]]></content>
  </entry>
  
</feed>
