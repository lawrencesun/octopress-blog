<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Lawrence Sun]]></title>
  <link href="http://voice.lawrencesun.info/atom.xml" rel="self"/>
  <link href="http://voice.lawrencesun.info/"/>
  <updated>2016-02-13T19:54:49+08:00</updated>
  <id>http://voice.lawrencesun.info/</id>
  <author>
    <name><![CDATA[Lawrence Sun]]></name>
    <email><![CDATA[yuliang1987@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Flask应用SAE部署]]></title>
    <link href="http://voice.lawrencesun.info/posts/2016/02/13/flask-app-deploy/"/>
    <updated>2016-02-13T12:53:04+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2016/02/13/flask-app-deploy</id>
    <content type="html"><![CDATA[<p>如何Build一个Flask应用可以参考Flask<a href="flask.pocoo.org">官方文档</a>，The Flask Mega-Turorial和Flask Web Development一书。值得一提的是，许多教程使用的第三方库都是比较早的版本，有一些用法会稍有不同，大多数问题都是因为版本不同造成的。</p>

<p>最终按照上述的几个资源，搭建了一个基本满足需求的<a href="meddata.applinzi.com">Web应用</a>，因为时间不多，对验证和国际化用了简单粗暴的方法。</p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/meddata.png?imageView2/2/w/400/h/300/q/85|watermark/2/text/TGF3cmVuY2UgU3Vu/font/YXJpYWw=/fontsize/200/fill/I0VGRUZFRg==/dissolve/56/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p>SAE是支持扩展第三方库的，但同时预先也安装了不少，因此需要配置与本地测试相同的环境，包括安装扩展库和指定版本。SAE的python文档都有一些具体的说明，但是排版比较散乱。</p>

<p><strong>打包本地环境</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Venv/lib/python2.7/site-packages
</span><span class='line'>zip -r site-packages.zip .</span></code></pre></td></tr></table></div></figure>


<p>将压缩包拷贝到项目目录下</p>

<p><strong>配置第三方目标</strong></p>

<p>即<code>config.yaml</code>文件，具体可参考SAE官方文档或我应用中提供的GitHub链接。</p>

<p><strong>配置index.wsgi</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import os
</span><span class='line'>import sys
</span><span class='line'>
</span><span class='line'>root = os.path.dirname(__file__)
</span><span class='line'>
</span><span class='line'># sys.path.insert(0, os.path.join(root, 'site-packages'))
</span><span class='line'>sys.path.insert(0, os.path.join(root, 'site-packages.zip'))
</span><span class='line'>
</span><span class='line'>import sae
</span><span class='line'>from myapp import app, db
</span><span class='line'>db.create_all()
</span><span class='line'>application = sae.create_wsgi_app(app)</span></code></pre></td></tr></table></div></figure>


<p><strong>使用Git上传SAE</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>~/myproject/app$ git inti
</span><span class='line'>~/myproject/app$ git add .
</span><span class='line'>~/myproject/app$ git commit -m "message"
</span><span class='line'>~/myproject/app$ git remote add sae https://git.sinacloud.com/AppName
</span><span class='line'>~/myproject/app$ git push sae master:1</span></code></pre></td></tr></table></div></figure>


<p><strong>本地和SAE数据库切换</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>try:
</span><span class='line'>  import sae.const
</span><span class='line'>  db = sae.const.MYSQL_DB
</span><span class='line'>  user = sae.const.MYSQL_USER
</span><span class='line'>  pw = sae.const.MYSQL_PASS
</span><span class='line'>  host = sae.const.MYSQL_HOST
</span><span class='line'>  port = int(sae.const.MYSQL_PORT)
</span><span class='line'>except ImportError:
</span><span class='line'>  pass</span></code></pre></td></tr></table></div></figure>


<p><strong>可能出现的问题</strong></p>

<ul>
<li>“OperationalError: (1045, &lsquo;access deny&rsquo;)”</li>
</ul>


<p>solution: 需要在SAE初始化MySQL数据库。</p>

<ul>
<li>“this is MySQLdb version (1, 2, 5, &lsquo;final&rsquo;, 1), but _mysql is version (1, 2, 3, &lsquo;final&rsquo;, 0)”</li>
</ul>


<p>solution: SAE上的版本低，删除site-packages下的mysqldb和mysql-python</p>

<ul>
<li>“OperationalError: (OperationalError) (2006, &lsquo;MySQL server has gone away&rsquo;)”</li>
</ul>


<p>solution: 因为sqlalchemy引起，在每次<code>session.commit()</code>之后加上<code>session.close()</code>，关闭当前session，将mysql连接还给连接池；并
在config.py里加上<code>SQLALCHEMY_POOL_RECYCLE = 10</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Flask应用环境搭建]]></title>
    <link href="http://voice.lawrencesun.info/posts/2016/02/13/flask-app-environments/"/>
    <updated>2016-02-13T12:52:51+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2016/02/13/flask-app-environments</id>
    <content type="html"><![CDATA[<p>去年奶奶和我说，每天用手机自带的记事本来记录某一时刻的血压、心率，在排版
查找和分析时比较麻烦，问我能不能做一个专门的APP来记录。这事一直拖到过年，因为年夜饭、拜年、同学会这些事，时间打得比较散，比较适合做这个。</p>

<p>因为功能需求不多，所以考虑部署在几近免费的<a href="http://t.cn/R48mxld">新浪云</a>。SAE支持PHP, Python和JAVA，考虑到以后可能会用Python，于是毅然放弃了世界上最好的语言。</p>

<p>Python的Web框架很多，最终选择了据说是比较轻的Flask。乍一看，也是和Rails类似的MVP结构，但是社区活跃度和支持度显然不是很高，遇到坑的时候往往需要花上不少时间去搜索。</p>

<p>本机环境选择了Ubuntu，自带python 2.7, 需要配置MySQL.</p>

<!-- more -->


<ul>
<li>为了使用easy_install, 安装python setuptools, 一组Python的工具包</li>
</ul>


<p><code>$ wget https://bootstrap.pypa.io/ez_setup.py -O - | sudo python</code></p>

<ul>
<li>安装virtualenv</li>
</ul>


<p><code>$ sudo easy_install virtualenv</code></p>

<ul>
<li>创建一个项目并启用用virtualenv创建一个新的环境</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir myproject
</span><span class='line'>$ cd myproject
</span><span class='line'>~/myproject$ virtualenv venv
</span><span class='line'>~/myproject$ . venv/bin/activate</span></code></pre></td></tr></table></div></figure>


<ul>
<li>安装Flask</li>
</ul>


<p><code>~/myproject$ pip install Flask</code></p>

<ul>
<li>在venv环境下安装flask-sqlalchemy</li>
</ul>


<p><code>pip install flask-sqlalchemy</code></p>

<ul>
<li>创建Flask应用</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>~/myproject$ mkdir app
</span><span class='line'>~/myproject$ mkdir app/static
</span><span class='line'>~/myproject$ mkdir app/templates
</span><span class='line'>~/myproject$ cd app</span></code></pre></td></tr></table></div></figure>


<ul>
<li>在app创建<code>config.yaml</code>, <code>index.wsgi</code>, <code>myapp.py</code>等</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>~/myproject/app$ touch config.yaml
</span><span class='line'>~/myproject/app$ subl config.yaml</span></code></pre></td></tr></table></div></figure>


<ul>
<li>MySQL安装配置，可以参考<a href="http://shmilyaw-hotmail-com.iteye.com/blog/1689160">这篇</a></li>
</ul>


<p>先确认是否安装MySQL</p>

<p><code>$ mysql --version</code></p>

<p>可能会遇到的问题：</p>

<p><code>pin install mysql-python</code> 出现 <code>mysql_config not found</code></p>

<p>solution: <code>sudo apt-get install libmysqlclient-dev</code></p>

<p>出现<code>command 'x86_64-linux-gnu-gcc' failed with exit status 1</code></p>

<p>solution: <code>sudo apt-get install python-dev</code></p>

<ul>
<li><p>python在使用，经常会出现indentation的问题，如果使用Sublime Text的话可以参考<a href="http://stackoverflow.com/questions/14773271/how-to-fix-convert-space-indentation-in-sublime-text">这篇</a></p></li>
<li><p>测试</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>from flask import Flask, g, request
</span><span class='line'>
</span><span class='line'>app = Flask(__name__)
</span><span class='line'>app.debug = True
</span><span class='line'>
</span><span class='line'>@app.route('/')
</span><span class='line'>def hello():
</span><span class='line'>    return "Hello, world! - Flask"
</span><span class='line'>
</span><span class='line'>if __name__ == '__main__':
</span><span class='line'>    app.run()</span></code></pre></td></tr></table></div></figure>


<p><code>~/myproject/app$ python myapp.py</code></p>

<p>打开127.0.0.1:5000，出现&#8221;Hello, world! &ndash; Flask&#8221;</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Surface 3 评测]]></title>
    <link href="http://voice.lawrencesun.info/posts/2016/01/01/surface-3-review/"/>
    <updated>2016-01-01T13:28:52+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2016/01/01/surface-3-review</id>
    <content type="html"><![CDATA[<p>微软这两年逐渐摆脱了水果的压制，在系统、软件和硬件上(除手机)走上了正轨。尽管Surface第一代饱受嘲笑，但是如今苏菲系列日渐得宠。大家逐渐厌烦了iPad的大屏视频娱乐，开始考虑移动生产力的因素了。</p>

<p>iPad Pro开始配键盘和笔了，但同尺寸的Mac似乎更符合移动办公的需求。而当年被嘲笑的苏菲，却成了如今的仿效对象。</p>

<p>其实说生产力，有点言过其实。在这方面，平板是无论如何也拼不过PC的，无非是多任务切换和文档处理。苏菲在这方面有天然的优势，Office系列，和PC一样的桌面环境。</p>

<p>原来的小黑实在是太重了，但是今年加了固态盘和内存之后，又焕发新生，似乎仍堪大用，同时小Air已经沦为写博客的二奶机。一路更新至今的iPad 2已经步入暮年，能看视频已然欣慰。之前一直关注着iPad Air，但是老爸买的一台Surface Pro进入了我的观察视野。当时并没有留意，但是当发现它自带的PDF阅读功能以及强大的OneNote时，还是为之倾倒。</p>

<!-- more -->


<p>那为什么买了Surface 3，而不是Surface Pro呢? 因为已经有小黑做主力机了，Pro的强大性能有点重复，而小3也更符合移动便携的要求&hellip; 嗯，其实是没钱&hellip;</p>

<p>总之，整套小3来到了我的碗里。</p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/surface-think.jpg?imageView2/2/w/400/h/300/q/85|watermark/2/text/TGF3cmVuY2UgU3Vu/font/YXJpYWw=/fontsize/200/fill/I0VGRUZFRg==/dissolve/56/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/surface-mac.jpg?imageView2/2/w/400/h/300/q/85|watermark/2/text/TGF3cmVuY2UgU3Vu/font/YXJpYWw=/fontsize/200/fill/I0VGRUZFRg==/dissolve/56/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/surface-side.jpg?imageView2/2/w/300/h/400/q/85|watermark/2/text/TGF3cmVuY2UgU3Vu/font/YXJpYWw=/fontsize/200/fill/I0VGRUZFRg==/dissolve/56/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p>先说缺点：</p>

<ul>
<li>充电龟速。Micro USB的接头做得很山寨，好处是似乎可以用充电宝。</li>
<li>触控不灵。不像iPad丝般顺滑。</li>
<li>续航一般。和Mac 和 iPad比似乎差一截，但是考虑到多任务操作和Win环境，五六个小时的表现也不能算差。</li>
<li>不是SSD。虽然一般是文档处理，但是不上SSD还是说不过去。</li>
</ul>


<p>配件：</p>

<ul>
<li><p>键盘。同时也是Cover。虽然和Mac的键盘比还差一点，但是手感还是相当不错的，短时间输入没问题。</p></li>
<li><p>笔。好用，好用，好用。</p></li>
<li><p>支持扩展卡。</p></li>
<li><p>价格。键盘和笔加起来原价接近1000，很黑，但物有所值。</p></li>
</ul>


<p>优点：</p>

<p>Drawboard + OneNote + FreePaint三大神器</p>

<p>Drawboard：可以在PDF上写写画画，功能丰富，和读纸质文献时的感觉一样。</p>

<p>FreePaint：没事就可以展现一下自己的艺术修养&hellip;</p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/surface-paint.jpg?imageView2/2/w/300/h/400/q/85|watermark/2/text/TGF3cmVuY2UgU3Vu/font/YXJpYWw=/fontsize/200/fill/I0VGRUZFRg==/dissolve/56/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p>OneNote：以前用Evernote为主，但是更偏重于收集。OneNote的整理功能似乎更胜一筹，同时还有墨迹公式、图片识别、截图插入、录音录像的强大功能。</p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/surface-formula.jpg?imageView2/2/w/400/h/300/q/85|watermark/2/text/TGF3cmVuY2UgU3Vu/font/YXJpYWw=/fontsize/200/fill/I0VGRUZFRg==/dissolve/56/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/surface-ppt.jpg?imageView2/2/w/400/h/300/q/85|watermark/2/text/TGF3cmVuY2UgU3Vu/font/YXJpYWw=/fontsize/200/fill/I0VGRUZFRg==/dissolve/56/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p>Office： 送了一年的365，提供最新版下载更新，PPT做Presentation会很方便。</p>

<p>Update: 刚夸了巨硬大法，就被打脸了。发现屏幕触控有些问题，客服和支持都无法解决，所幸Reddit看到一个神回复，解决了问题。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[创业创新]]></title>
    <link href="http://voice.lawrencesun.info/posts/2016/01/01/innovation/"/>
    <updated>2016-01-01T13:26:38+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2016/01/01/innovation</id>
    <content type="html"><![CDATA[<p>“大众创业、万众创新”在2015年经历了高潮，也经历了所谓资本的寒冬。创业潮并不会因此退去，在2016年，很有可能会以一种新的形式展开。</p>

<p>个人认为，以App、朋友圈为主的创业项目将进入寒冬，而以新技术、新材料为主导的创新创业会逐渐成为主导。现在市场并不缺钱，而是缺少能够改变世界、改变规则的项目。未来5到10年，是我国转型升级的重要时期，也是创新创业出成果的阶段。</p>

<p>从目前学校和Z府的动向来看，高新技术人才带动的项目会更受青睐。更多的创新会基于解决产业、技术和服务的现有问题上。</p>

<p>2016年的目标，学习，思考，积累。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[机器学习]]></title>
    <link href="http://voice.lawrencesun.info/posts/2016/01/01/machine/"/>
    <updated>2016-01-01T13:12:35+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2016/01/01/machine</id>
    <content type="html"><![CDATA[<p>今年重返校园，开始了一段新的旅程。第一学期需要上一些课程，其中就包括“马克思主义与当代”这个名字诡异的课。和预想的不太一样，这门课并不是传统填鸭式的教学，把从小灌输到大的内容再炒一遍。而是通过对案例进行学习、分析，进而辩论、讲解。在这个过程中，发现自己的Critical Thinking能力非常欠缺。</p>

<p>从小都是灌输式的被动学习，拿到资料、看到观点之后，轻而易举就接受了，并没有对细节进行思考。以前学过的知识，很多现在都想不起来了，因为当时就是被动输入，理解、思考和回顾几乎没有。所以我的独立思考能力一直不是很强。在阅读论文之后，很难提出问题，或者说不能Ask the Right Question，找不到问题也就无从下手，不知道从何创新。</p>

<p>“独立思考，只不过是从别人那里知道一个结论的时候，自己动脑重新推演一遍，看看得出结论的过程有没有漏洞，有没有不合理的地方，衡量一下结论到底有多少道理的过程。”（《把时间当作朋友》）</p>

<p>怎么提高Critical Thinking的能力呢？我觉得一个是要学习和积累，另一个是要不断地训练。如同现在的人工智能，通过大数据的训练才能得到一个有效的网络。以前说，没有独立思考，就变成了机器，但是现在不思考、不训练的话，可能还不如机器呢。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[八月: 青海湖(下)]]></title>
    <link href="http://voice.lawrencesun.info/posts/2015/10/07/tour-of-qinghai-2/"/>
    <updated>2015-10-07T10:26:54+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2015/10/07/tour-of-qinghai-2</id>
    <content type="html"><![CDATA[<p>这个十一假期就在刷朋友圈的世界旅行摄影大赛中结束了。此外还参加了一场婚宴，有空会写写当伴郎是什么样的体验。青海湖的下篇一直没动笔，因为当时一路风光无限，而信号有限，撸串欢乐，而流量悲伤，在Evernote上所记甚少。上篇基本是cmd+c加上cmd+v，这篇只能按图索骥，于文字苍白处上图。</p>

<!-- more -->


<p>书接<a href="http://voice.lawrencesun.info/posts/2015/09/03/tour-of-qinghai/">上回</a>。</p>

<p><strong>Day 3</strong>:</p>

<p>早上起床，房东叔叔正好要去体育馆打羽毛球，就一起出门了。临走前，说，该找个女盆友了，下次一起来&hellip;</p>

<p>和小伙伴们胜利会师，惊奇地发现，都是同龄人，还有三个射手座。司机小马哥是当地人，自带啤酒肚，朋友圈却像个文艺青年。我们在他车载那几张“咚咚咚”节奏的音乐中出发了。</p>

<p>首站是塔尔寺，游客如织，基本是排队进殿，走马观花走了一圈。</p>

<p>出离塔尔寺，风景渐好，牛羊成群，细水长流，在绵延起伏的高原山丘中一路盘旋来到了海拔4188米的拉鸡山。我觉得如果鸡被拉上来的话，估计也会高原反应。</p>

<p>车向西行，路上有很多老奶奶向来车招手卖酸奶，还有一些牧民正在晒牛粪、搭帐篷。途经的村落土墙土瓦，有些破乱不堪，但是学校却建得像模像样，多少也代表着下一代的希望。</p>

<p>午饭吃了炒面片，这里烧水很慢，而且盐分十足。</p>

<p>离青海湖渐近，逐渐看到各种旅行方式，开车的，骑摩托的，骑车的，骑马的，徒步的。沿途显得富裕起来，不少地方还在大兴土木，也许若干年后这里会变成原始风光不再的度假圣地。当地牧民画地为牢，围栏收钱。</p>

<p>青海湖的轮廓渐渐显现，像大海一般，广阔无边。</p>

<p>到达黑马河时，已经是饥肠辘辘，在镇上点了几盘菜立刻就被瓜分干净。这里的特色坑锅肉并没觉得好吃，羊肉也很贵没有点。晚上看日落，住帐篷，上旱厕，烤篝火，在层层被毯中进入梦乡。</p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/JA201510071637430026-00-000000.jpg?imageView2/2/q/85|watermark/2/text/TGF3cmVuY2UgU3Vu/font/YXJpYWw=/fontsize/300/fill/IzAwMDAwMA==/dissolve/70/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p><strong>Day 4</strong>:</p>

<p>昨晚睡得不好，被毯裹住太热，甚至流了点鼻血，而拿掉毯子又太冷，始终找不到冷热的平衡点，加上时而呼啸而过的汽车声，只能断断续续小睡。大概6点不到就套上冲锋衣出来看日出了，可惜天气不是很好，云层太多，只能看一副抽象画。</p>

<p>两位小伙伴高原反应比较明显，小马哥给买了葡萄糖，但是今天仍在高原上行车。途中大概在3800米的地方休息，小马哥带我们穿越栏杆，到草地上拍照，跳得很high，只是姿势太丑。</p>

<p>继续向西，蹭了一段高速，逃了门票&hellip;来到了茶卡盐湖。8月中的茶卡盐湖已不再是晶莹剔透，沿岸盐层已经被踩烂，加上阴云密布的天气，和之前照片上看到的美景大相径庭。沿着老铁路前行，两边都是摆拍的游客，此时狂风大作，穿着冲锋衣依然冻成狗，打在身上的不知是盐粒还是冰雹，随时会被吹走的感觉。</p>

<p>继续前行，路过尕海，主基调从绿色变成了黄色，沙漠开始占据了窗外的风景。沿途看到了青藏铁路和布满光伏设备的德令哈，最终抵达大柴旦。</p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/JA201510071642520098-00-000000.jpg?imageView2/2/q/85|watermark/2/text/TGF3cmVuY2UgU3Vu/font/YXJpYWw=/fontsize/300/fill/IzAwMDAwMA==/dissolve/70/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p><strong>Day 5</strong>:</p>

<p>昨晚又陷入了盖被子热，不盖又冷的窘境，干燥的天气也让人舌干唇燥，好处是洗的衣服两小时就干了。</p>

<p>今天基本是在戈壁滩中穿越，途中见到了一群野骆驼漫步在公路中间，其中一只有点秃，可能是做IT的。</p>

<p>从青海进入甘肃境内，紧接着就是将近二十公里的连续下坡路段，尽头是一个边防站，强制停车休息半小时。</p>

<p>中饭在阿克塞自治县吃白面加炒菜，和前几天吃的相比实在太赞。饭后继续前行在沙漠中，一路颠簸，来到了玉门关。当年的重要关隘如今只剩下一个小城墙的遗迹。</p>

<p>离开玉门关，在路上现摘了几串葡萄吃。晚上在敦煌的沙漠里度过，沙滩越野车坐得很爽，可惜路程时间太短，而之后的滑沙看似美好，实则耗费无数体力——首先提着木板爬上陡峭的沙坡就很吃力，基本是一步一坑，阻力巨大，往下滑时，几乎是双手并用像划桨一般才能下来。相比塑料的滑板要好很多。此时日落西山，第一次看到沙漠的晚霞。</p>

<p>这个俱乐部提供了烧烤，可是种类匮乏，啤酒也略假，一旁的K歌设备则被一群熊孩子霸占了。临近午夜，开始在沙漠中搭起了帐篷，比想象中容易一些。抬头仰望，星空璀璨，拿出自黑杆来固定手机拍了几张——杆子因此进沙一蹶不振。</p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/JA201510071648190021-00-000000.jpg?imageView2/2/q/85|watermark/2/text/TGF3cmVuY2UgU3Vu/font/YXJpYWw=/fontsize/300/fill/IzAwMDAwMA==/dissolve/70/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/JA201510071651430076-00-000000.jpg?imageView2/2/q/85|watermark/2/text/TGF3cmVuY2UgU3Vu/font/YXJpYWw=/fontsize/300/fill/IzAwMDAwMA==/dissolve/70/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p><strong>Day 6</strong>:</p>

<p>昨晚穿着冲锋衣，裹着睡袋，相比前几天的冷热失调，这晚倒是很稳定，就是冷。尽管垫了防潮垫，仍然感觉阴，另外没有枕头，无论怎么翻身都不舒服。</p>

<p>一早就冻醒，发现帐篷角上有一个洞，相当透气&hellip; 爬上沙丘看日出，虽然前山略有遮挡，但还是看到了整个过程。吃完早饭来到了莫高窟游客中心，取票时看到不少人都不知道要预约。连续看了两部电影，包括360度环幕，效果逼真，有身临其境之感。</p>

<p>坐大巴来到莫高窟，北区相对原始但不开放。在南区看了大约10个窟左右，体现了丝绸之路的繁华，以及时代变迁对宗教、服饰、文化的影响，特别是西域佛教从传入 融合，到相互影响的变化。通过这些塑像也能看出各朝代不同的设计和工艺。</p>

<p>最后参观的是17号窟，里面记载着中国不少科学与文化资料的经书早已被盗。展览馆里陈列着各种被盗至世界各地的珍贵文物复制品，本国瑰宝竟被多次偷盗，令人感慨不已。</p>

<p>中午来到敦煌市内吃当地特色驴肉黄面，并没觉得特别好吃。之前因为晚上住宿问题折腾半天，大家和司机小马哥之间有点不快，此时渐渐缓解，后续旅程也没受到影响，关系日渐融洽，当然这是后话。</p>

<p>之前一天在沙漠被晒得够黑，有点招架不住这强烈的紫外线，只好也买了魔术头巾，把自己从上到下都包裹住。</p>

<p>下午去了鸣沙山，在城市里有这么大一个沙山还是满奇特的，坐骆驼上了山顶，然后一路到月牙泉。骆驼在沙漠中行走的非常稳健，当然偶尔也漠视交规，违章超车。骑骆驼还是挺有趣的体验，当然坐了一个小时后又晒又累，由此也深感丝绸之路的艰辛。</p>

<p>晚上在敦煌夜市撸串，意外发现同行的@Mindy是曼大同届校友，世界真奇妙。</p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/JA201510071655530026-00-000000.jpg?imageView2/2/q/85|watermark/2/text/TGF3cmVuY2UgU3Vu/font/YXJpYWw=/fontsize/300/fill/IzAwMDAwMA==/dissolve/70/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p><strong>Day 7</strong>:</p>

<p>离开敦煌前往张掖，途经瓜州。来瓜州当然要买瓜了。路边有一个8号瓜棚，生意兴隆，后来才发现，老板娘很会拉拢司机，在微信群里撒娇卖萌，加上产品质量确实不错，口碑就做出来了。</p>

<p>中午时分，在农家餐馆大吃一顿后来到嘉峪关。这里修建了很多新墙，虽然完整度高了，但显然没有那些老墙更有历史的感觉。城楼相对完整，整个关隘转下来给人的感觉就是，如果没有内应，根本攻不下来。站在城楼上，还能远眺雪山。</p>

<p>驶离嘉峪关，前往张掖观看丹霞地貌。此时已经接近日落，于是我们选择了最后两个观景点。这种色彩缤纷的地貌确实不曾见过，特别是在余晖的照耀下，显得格外迷人。只是观景台挤满了游客，特别是在第四个点，几乎都是架着长枪短炮准备拍摄日落美景的人们。</p>

<p>晚上是之前我们几个人自己预定的酒店，设施齐全，对比之前的露宿显得格外舒适。在前台的推荐下，来到酒店旁的一家KTV吃自助K歌到凌晨。</p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/JA201510071700120089-00-000000.jpg?imageView2/2/q/85|watermark/2/text/TGF3cmVuY2UgU3Vu/font/YXJpYWw=/fontsize/300/fill/IzAwMDAwMA==/dissolve/70/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p><strong>Day 8</strong>:</p>

<p>早上去司机推荐的店吃早点，牛肉小饭，有点类似猫耳朵或者面疙瘩，味道还是挺不错的。</p>

<p>然后依着祁连山脉从甘肃开回青海，戈壁滩和青山碧水只有一墙之隔。一路上牛羊成群，还经常横穿马路。司机小马哥技术超群，在盘山公路上过关斩将。</p>

<p>经过门源，可惜前一阵子的一场雨，将这里不少花海摧毁，我还幸运地踩到了牛粪。</p>

<p>下午回到了西宁，在水井巷和莫家街吃了酿皮，羊肉串和酸奶，感觉肚子一下承受不来。今天七夕，又恰逢队友@Sofia生日，在小马哥的安排下去了酒吧。小马哥还送了蛋糕，被大家玩坏了，每个人脸上都是奶油。</p>

<p>酒吧出来，一行五人来到一家足浴中心。生平第一次去做大保健，略紧张，按摩 、修脚、足浴、开背，最后来了个刮痧。当晚就在那里入睡了。</p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/JA201510071703000021-00-000000.jpg?imageView2/2/q/85|watermark/2/text/TGF3cmVuY2UgU3Vu/font/YXJpYWw=/fontsize/300/fill/IzAwMDAwMA==/dissolve/70/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p><strong>Day 9</strong>:</p>

<p>一觉睡到9点，这几天积累下来的弦松了下来，感觉又困又累。</p>

<p>小马哥带我们去采购了好几斤羊肉，还有羊排，各种蔬菜、饼，才160多块钱，性价比超高。驱车到郊外，依山傍水搞起了烧烤，第一次做起了串串的活，没想到小马哥的烧烤技术一流，面片汤做的也是一绝。</p>

<p>烧烤回来大家就要解散了，独自取完第二天的车票，联系房东前往宾馆，略有伤感。晚饭出去溜了一圈，全是牛肉面，看着就不想吃，最后无奈进了兰州著名连锁马子禄，结果吃了几口就吃不下去了。</p>

<p>宾馆是家庭式的，房间还挺宽敞的，带阳台。房东很热情，说就像在家住一样。 洗涑完毕，碰到一家子来骑行的，小孩12、3岁，结果男的肺水肿住了院。他们也是住黑马河帐篷，然后连续三天碰到冰雹，有点不适以为是感冒的症状，晚上暖暖身子就过去了，当天还骑了100公里，结果更加严重了。</p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/JA201510071705100088-00-000000.jpg?imageView2/2/q/85|watermark/2/text/TGF3cmVuY2UgU3Vu/font/YXJpYWw=/fontsize/300/fill/IzAwMDAwMA==/dissolve/70/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p><strong>Day 10</strong>:</p>

<p>今天离开小伙伴独自旅行了，一早便离开宾馆来到长途车站。</p>

<p>安检员还没开始上班，像样的检查也没有，直接就上车。司机让放好行李去检票，但检票员不知道去哪里了，开车前15分钟才姗姗来迟。</p>

<p>车上不少新疆人，好多戴着佛珠，还念着经文。</p>

<p>途径各种小县，拦路上车的不少。路过黄南，水还不是很黄。 道路两旁防护带不少画像，山崖上也有不少藏族壁画。沿途可以看见高速高铁道路在建造。</p>

<p>途中休息司机招呼大家路边解手&hellip; 继续前行，可谓山路十八弯，路旁的小村落都是泥墙为主，看到有两个老外骑行，真是不易。</p>

<p>在瓜什则乡休息，车上几个大哥说买个酸奶，于是买了当地的牦牛酸奶。边上的大哥说比西宁的纯，感觉比在西宁吃的厚实，偏酸，另一个大哥买了不知道是什么饼，分给大家吃。</p>

<p>上路后又见草原，据说最好的季节是7月底8月初。此时收到欢迎来到九色甘南的短信，接着是很长一段还在建设中的土路，一直颠簸到夏河县。</p>

<p>县城不少道路和楼房还在建设中，但可以看出这里经济不错。此时雨过天晴，下车后先买了第二天下午回兰州的车票。</p>

<p>准备打车去桑科乡，司机接客停车时还刮擦了，没打表一口价到了住地。传说中的北京热情老板娘不在，也没有看到其他住客，一个男的走出来，说了几句，给了个房间。放下东西后前往桑科草原，两旁都是圈地搞农家乐，因为在青海看多了，加上这里的草原已经日渐枯黄，所以没什么感觉。</p>

<p>没什么事可干，于是就上马，给我牵马的是一个藏族15岁少年，后来由他来驾马 带着我小跑了一圈。</p>

<p>回到住地，在边上简单吃了碗面，老板娘普通话说得不是很流利，她说我一个人来怕吗，我说不。然而回到旅舍，空旷的走廊只有我一人时，多少还是有些忐忑。</p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/JA201510071708180002-00-000000.jpg?imageView2/2/q/85|watermark/2/text/TGF3cmVuY2UgU3Vu/font/YXJpYWw=/fontsize/300/fill/IzAwMDAwMA==/dissolve/70/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p><strong>Day 11</strong>:</p>

<p>一早从桑科乡出发，没有公交车也没有出租车，只好徒步前往10公里外的拉卜楞寺。</p>

<p>一路上偶尔有摩托车和汽车呼啸而过，突然一辆车在我边上停下，问我去哪儿， 然后就让我上车了。开车的是格桑大哥，西藏人，边上还有一个同伴，他们去某一个寺庙（没听清）见大法师。途中聊天，原来他在杭州古玩城开店，此外还在北京上海有分店。</p>

<p>不一会就来到了拉卜楞寺，和格桑大哥道谢告别。这时寺庙外面游客还不多，但已经有不少藏族人在虔诚转起了7公里的经筒，甚至三叩九拜。</p>

<p>因为背包拖箱不方便，就来到寺庙附近的红石青旅把拉杆箱暂放。 老板和服务员都是藏族人，当得知我的求助后，很友好的让我把包放在前台了。</p>

<p>一早碰上好人，让我得以心怀美好，参观拉卜楞寺。</p>

<p>拉卜楞寺有着300余年历史，是藏传佛教最高学府，占地1200多亩。设有包括医学院在内的六大学院，目前活佛转世到一位13岁的僧人。据指引参观的大师介绍，这里一年会两个博士后推荐，主要考察德行和学识。</p>

<p>参观了能容纳3800的大殿，僧人每天早中午两堂课活佛讲坛。</p>

<p>藏传佛教很多建筑是红色和黄色的，它们被认为是最低等低调的颜色。殿里摆放着酥油茶还有精美的酥油花。</p>

<p>比起塔尔寺，这里的氛围好很多，但我仍觉得众多参观的游客会打扰修行。</p>

<p>出来后大众点评搜了了两家店，先去了一家西式简餐，吃了奶酪三文治垫饥。 然后去青旅拿了包，在附近的雪人宫吃了藏式午餐，包括藏饭、油麦菜，还有奶茶。 老板夫妻服务很好，有个可爱的女儿，后来得知老板还是华东师范87级的。</p>

<p>饭后准备回兰州，夏河车站的安检形同虚设，直接可以从边上出口大门进入。不过司机和检票员还不错，开车前到处找两个没来的旅客。</p>

<p>回到兰州正值晚高峰，公交车坐了接近一个小时才到市区。住在一家位于写字楼的青年旅社，装修的很有特色，老板还养了一只猫。因为这些天一直没有时间去邮局，只好委托老板寄明信片。可是不知什么原因，截止到现在，只有两个朋友收到了&hellip;老板很年轻，以前是做电气方面的，后来觉得没意思就出来开青旅了。实在不想吃牛肉面了，在附近的广场找到KFC吃了一顿。</p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/JA201510071711460071-00-000000.jpg?imageView2/2/q/85|watermark/2/text/TGF3cmVuY2UgU3Vu/font/YXJpYWw=/fontsize/300/fill/IzAwMDAwMA==/dissolve/70/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p><strong>Day 12</strong>:</p>

<p>因为同房间有一个深夜打电话的奇葩人物，一夜没怎么睡好，好在行程即将结束。一早起来就坐大巴到兰州的中川机场，按照惯例晚点起飞，于下午回到了大杭州。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LaTex环境配置: Sublime Text + TeXLive + Sumatra PDF]]></title>
    <link href="http://voice.lawrencesun.info/posts/2015/09/16/latex-and-sublime-text/"/>
    <updated>2015-09-16T19:51:48+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2015/09/16/latex-and-sublime-text</id>
    <content type="html"><![CDATA[<p>前一阵子看到LaTex生成的PDF，感觉排版和公式特别酷炫。当然相较Word来说，无论是环境配置还是代码输入都比较复杂，但如果学会使用的话，绝对是写论文的利器。</p>

<p>在知乎大神的推荐下，选择了比较熟悉的Sublime Text 3，配以TeXLive和Sumatra PDF，作为我在Win10系统下的LaTex环境配置。在设置ST的LaTexTools时出现不少问题，几番搜索终于配置成功。</p>

<!-- more -->


<p><strong>TeXLive</strong></p>

<p>直接官网下载，安装。考虑到国内镜像文件下载速度不稳定，推荐下载iso。</p>

<p><strong>Sumatra PDF</strong></p>

<p>轻巧的PDF阅读器，也是官网下载，安装。</p>

<p><strong>LaTexTools</strong></p>

<p>是Sublime Text的一个插件。</p>

<ol>
<li><p>如果之前安装过Package Control可以跳到下一步。Ctrl+Shift+P打开命令输入行，输入install，选择Package Control: Install Package，回车安装。也可以去ST官网下载该文件直接安装。</p></li>
<li><p>输入install package，选择LaTexTools进行安装。</p></li>
</ol>


<p><strong>配置以及双向搜索</strong></p>

<p>输入Ctrl+Shift+P，运行Reconfigure and migrate settings。</p>

<p>打开Preferences > Browse Packages&hellip; 选择User文件夹中的LaTexTools.sublime-settings</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>"Windows": {
</span><span class='line'>      //这里修改成texlive的路径
</span><span class='line'>      "texpath": "C:\\texlive\\2015\\bin\\win32;$PATH",
</span><span class='line'>      //这里修改成texlive
</span><span class='line'>      "distro": "texlive",
</span><span class='line'>      //这里修改成SumatraPDF.exe所在路径，留空的话需要将Sumatra所在路径添加到系统环境变量中去
</span><span class='line'>      "sumatra": "C:\\...路径...\\SumatraPDF.exe"
</span><span class='line'>},</span></code></pre></td></tr></table></div></figure>


<p>这里就连接了TexLive和SumatraPDF，编译完成后会自动打开SumatraPDF。</p>

<p>打开SumatraPDF > 设置 > 设置反向搜索命令行</p>

<p>修改成Sublime Text的路径, &ldquo;C:\ &hellip;路径&hellip;\sublime_text.exe&rdquo; &ldquo;%f:%l&rdquo;</p>

<p>新建一个tex文件，保存后Ctrl+B进行编译，如果没有错误，就会打开SumatraPDF，同时在PDF文档中双击某一处时，就会返回tex文件中相互对应的位置。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[八月: 青海湖(上)]]></title>
    <link href="http://voice.lawrencesun.info/posts/2015/09/03/tour-of-qinghai/"/>
    <updated>2015-09-03T22:44:24+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2015/09/03/tour-of-qinghai</id>
    <content type="html"><![CDATA[<p>作为一个拖延症弃疗者，能在<code>高原黑</code>尚未褪去之际，写下这篇游记，实属不易。要知道，前年的<a href="http://voice.lawrencesun.info/blog/categories/man-you-ji/">曼游记</a>之欧洲行至今仍处于烂尾楼的状态&hellip;</p>

<p>考虑到篇幅，本游记分为上下两篇——这是国际惯例。如今大片通常都分上下部，或者三部曲，更有甚者，一二三四五六七，补上前传搞穿越，卖个情怀再致敬&hellip;</p>

<p>此番青海湖大环线之旅是一年多来难得的中长线，同时也是我第一次踏上大西北的土地。</p>

<p>这次旅行的收获，除了高原黑，还有一群从素未平生到一起看风景的小伙伴们(@洛朵朵, @初冬, @Mindy, @Sophia)。关于过往旅行的回忆，纵使最旖旎的风景也已经模糊不清，反倒是遇到的人和经历的事仍印刻在脑海里。</p>

<p>时间: 12/08/2015 &ndash; 24/08/2015</p>

<p>路线: 看图就不用说话</p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/qinghaihu.png?imageView2/2/w/300/h/400/q/85|watermark/2/text/TGF3cmVuY2UgU3Vu/font/YXJpYWw=/fontsize/200/fill/I0VGRUZFRg==/dissolve/56/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<!-- more -->


<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/aroundtheworld3.png?imageView2/2/w/300/h/400/q/85|watermark/2/text/TGF3cmVuY2UgU3Vu/font/YXJpYWw=/fontsize/200/fill/I0VGRUZFRg==/dissolve/56/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p>P.S. 写了个<a href="http://lawrencesun.info/travel/">小网页</a>凑合着用，作为旅行足迹的记录，以后有空再完善。</p>

<p><strong>Days before D-Day</strong>:</p>

<p>因为青海湖需要包车/自驾，一进入8月便开始尝试组队。过去几年习惯了一个人的旅行，背上包就走，而此次如何寻找小伙伴成了出行的羁绊。在蚂蜂窝上发帖后一直无人问津，结果这一耗就是好几天。</p>

<p>只好破釜沉舟，先定了前往兰州的火车票，实在不行就去当地拼。订好票不久，决定在豆瓣上碰碰运气。结果马上有了回应，第二天一早微信聊了几分钟，无论是时间还是小伙伴都很合适，立即决定加入，<code>大青海</code>5人组正式成立。</p>

<p>接下来就是各种预订了，省略一万字。</p>

<p><strong>Day 0</strong>:</p>

<p>开往兰州的绿皮车一路向西北前行，列车广播里放着周杰伦的简单爱——当年的流行歌曲成了怀旧经典。略显嘈杂的车厢里，返乡人谈论着家乡久违的面食，00后们进行着“你是GAY吗”“我需要思考一下人生”的对话，小P孩们则在这个移动宿舍里大闹天宫。</p>

<p>天色渐暗，老坛酸菜泡面的味道四溢——这是本次列车上提供的唯一口味。来回几趟也没减价的盒饭也渐渐成了众多人的选择。</p>

<p>只要是从家出发，老妈都要把我的行李巡视检查一番，恨不得把包都塞满，把家都装进。</p>

<p>火车上的手机信号时好时坏，翻了几页‘白夜行’，也就到了黑夜熄灯的时间。</p>

<p><strong>Day 1</strong>:</p>

<p>一早起来已身在陕西，而从这里开始，列车穿梭过四十余个隧道，一路黄土黄水相伴。列车在离兰州站仅几公里处临时停车将近一个小时，这打乱了之前在兰州吃中饭的计划。历程2400公里，晚点进站后，坐公交车来到酒店入住。</p>

<p>洗完澡出来已是下午3点，决定直奔黄河。途中看到某个火车售票处排着长队，机智地拿出手机查票，前往西宁的票源果然紧张，果断抢入一张。</p>

<p>兰州的交通相比大杭州略显混乱，人行道也没有礼让之举，天桥倒是不少。首先来到中山桥，始建于1907年，有黄河第一桥之称。河对岸是白塔山，时间关系就没有去，而是沿河而上。</p>

<p>在河边见到了羊皮筏子，远观吹起像猪，近摸则弹性十足。穿上救生衣便上筏体验了一下黄河上古老的运输方式。黄河水此时虽然流速不快，但也暗潮涌动，仅凭一筏一浆就能横渡过岸，足见掌舵师傅的力量与经验。</p>

<p>乘快艇逆流而上返回，继续沿河而行，见到了传说中的黄河母亲像。</p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/day1lanzhou.jpg?imageView2/2/q/85|watermark/2/text/TGF3cmVuY2UgU3Vu/font/YXJpYWw=/fontsize/300/fill/IzAwMDAwMA==/dissolve/70/gravity/SouthEast/dx/10/dy/10" alt="img3" /></p>

<p>坐公车返回中山桥附近开始觅食。首先来到了大众街，路两边店铺林立，然而很多拉面店下午两点前就已关门。走街串巷，先是去杜记甜食店吃了甜醅和灰豆子，都是以前没有见过的东西。然后吃了马三洋芋片，感觉豆皮更好吃，但是都好辣。好不容易找到一家没有关门的牛肉面馆，吃上一碗，撑得不行。</p>

<p>回酒店途中，又发现了正宁街小吃一条街，人气爆棚，看来兰州的吃货不少。看着各种小吃，然心有余而力不足。因为舌尖上的中国，有好几家在做老马家牛奶鸡蛋醪糟，也不知孰真孰假，就选了队伍最长的买了一杯。</p>

<p>兰州还有一个有意思的地方，在这里几乎看不到硬币，无论是一元还是五角，找回来的都是纸币。</p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/day1lanzhou2.jpg?imageView2/2/q/85|watermark/2/text/TGF3cmVuY2UgU3Vu/font/YXJpYWw=/fontsize/300/fill/IzAwMDAwMA==/dissolve/70/gravity/SouthEast/dx/10/dy/10" alt="img4" /></p>

<p><strong>Day 2</strong>:</p>

<p>在酒店洗澡吃完早饭便打车前往兰州高铁站。一路车速缓缓，因为地铁正在施工。近年来很多城市都陆续上马轨道交通项目，兰州作为西北重镇自然也不例外。</p>

<p>兰州西站仍在建设当中，主要车次是前往西宁和新疆的。敦煌之星动车几乎是一直在隧道中前行，播音则有中英和某种语言，车上还有防爆检查。</p>

<p>西宁站出来，坐公交车去Airbnb预订的家庭住宿，公交车还是那种发动机在前面的老式车。第一印象西宁比兰州热闹和繁华。住宿是在老小区里，位置极佳。打电话联系房东，然后爬楼梯到5楼，房东一家子都在，女儿在北京工作休假回来。他们正好吃完午饭，给我盛了一碗粥，配了小菜，还有昨天刚从市场买来的藏族饼。之后房东阿姨正好出去办事，把我带到了不远处的莫家街。</p>

<p>在德禄酸奶店吃酸奶，口感有点像豆腐脑。吃的时候碰到一个从北京骑车到拉萨再到青海湖的大神，历时一个半月，走318国道线，其中西藏19天，随到随住藏民家，一路上碰到泥石流 ，死人，狼群，拦路抢劫，狗咬人&hellip;等各种事件。他说之前是跑马拉松的，然后觉得二三十公里没意思，于是开始了骑行，沿途拍了2000多张照片，觉得很好，边骑边看，想停就停。</p>

<p>之后前往酒店去会和北京来的兄妹@洛朵朵和@初冬，在大厅没对暗号就觉得一对来者是他们，Bingo。接着一起逛了民主街和水井巷，这里以巷为市场，贩卖着大同小异的西北风味和民俗特产。西宁的道路两旁都有围栏，用鲜花点缀。公厕大多收费，小而脏(注: 这是在没有去青海湖和戈壁滩之前下的结论&hellip;）</p>

<p>在莫家街的马忠食府吃了面片和凉皮，然后独自逛到了东关清真寺。今天正好是穆斯林做礼拜，去的时候还有不少人跪在那里祷告。出来走到马步芳公馆，不巧早已关门。门口还碰到一个穿着僧袍的过来要和我握手，说了一大堆，意思是要钱，我假装没听懂就走开了。</p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/day2xining.jpg?imageView2/2/q/85|watermark/2/text/TGF3cmVuY2UgU3Vu/font/YXJpYWw=/fontsize/300/fill/IzAwMDAwMA==/dissolve/70/gravity/SouthEast/dx/10/dy/10" alt="img5" /></p>

<p>走回住的地方，8点多,天色依然亮堂，和房东阿姨聊天，关于旅行经历，关于做Airbnb的经验，然后一起吃了白兰瓜。得知我深得广大蚊子喜爱之后，阿姨给我拿来了电蚊香。</p>

<p>睡在客厅的单人床上，无比期待即将启程的大青海之旅。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[外网如何访问内部WordPress网站]]></title>
    <link href="http://voice.lawrencesun.info/posts/2015/06/21/wordpress-relative-urls/"/>
    <updated>2015-06-21T10:08:42+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2015/06/21/wordpress-relative-urls</id>
    <content type="html"><![CDATA[<p>之前在内部服务器搭建了一个WordPress网站，测试时使用的时Localhost，在内网上线时，将主机地址改为服务器的ip地址，即10.xxx.xxx.xxx。显然这种情况下，外网是不能访问的。</p>

<p>WordPress默认使用的是绝对路径，也就是说文章和图片的地址都是10.xxx.xxx.xxx/&hellip;。除此之外，js和css的路径也是绝对的。这样即使外网通过外网ip访问到了网站，内容和样式都是无法加载的。</p>

<!-- more -->


<p>首先想到的一个方法就是在WP后台或者数据库中将SiteURL改为外网的ip地址。但是这种方法相对暴力，也不利于扩展多域名/ip的指向。</p>

<p>在网上搜到了一个方法，具体如下:</p>

<p>在<code>wp-config.php</code>文件中加入以下两行代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>define('WP_SITEURL', 'http://' . $_SERVER['HTTP_HOST']);
</span><span class='line'>define('WP_HOME', 'http://' . $_SERVER['HTTP_HOST']);</span></code></pre></td></tr></table></div></figure>


<p>这样无论你是从内网还是外网访问，主机和链接地址都是随之动态改变的。</p>

<p>至于文章中的图片和链接，还需要改成相对路径，如/?p=xxx和/wp-uploads/&hellip;等。</p>

<p>最后一步，也是网上很多经验贴没有说明的，就是清除缓存。我按照上述步骤完成之后，多次测试都没有成功，外网访问时有些地址还是显示内网ip。删去了<code>wp-config.php</code>中的<code>define( 'WP_CACHE', true );</code>就好了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[从Wordress迁移文章到Octopress]]></title>
    <link href="http://voice.lawrencesun.info/posts/2015/06/14/migrate-posts-from-wordpress-to-octopress/"/>
    <updated>2015-06-14T17:17:43+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2015/06/14/migrate-posts-from-wordpress-to-octopress</id>
    <content type="html"><![CDATA[<p>奸商<em>Godaddy</em>发邮件说不再提供免费主机(当年买域名时所赠)并要求尽早迁移，使得我不得不打开沉睡已久的老博客，将之前的博客也搬家到Octopress。</p>

<p>搬家自古以来就是件头疼的事情，当年把人人网上近百篇日志，以纯手工的方式，复制黏贴到WordPress上的悲惨经历仍历历在目。</p>

<p>好在从WordPress迁移到Octopress的工作已经有无数前辈进行了摸索，并制造了自动化工具。</p>

<!-- more -->


<p>首先进入WP后台对内容进行导出，下载生成的xml文件，命名为&#8221;wordpress.xml&#8221;并放在Octopress的根目录下面。</p>

<p>接下来下载<a href="https://gist.github.com/1394128">这个程式</a>并放到新建的utils目录下。</p>

<p>先运行<code>gem install hpricot</code>，然后运行 <code>ruby -r "./utils/wordpressdotcom.rb" -e "Jekyll::WordpressDotCom.process"</code>。</p>

<p>命令窗口提示import了169篇文章，这些文章可以在source/_posts目录里看到。</p>

<p>如果你在WordPress里用的是和我一样的?P一类的路径，或者说别名和标题一样也是中文，那么很不幸，需要将别名改成英文。当然也有现成的转化工具可以用来实现，但我最终还是手动翻译了。</p>

<p>后续还有不少格式、图片链接的问题(懒得处理了&hellip;)，但是基本内容已经搬运成功了。</p>

<p><sub>参考: <a href="http://blog.yorkxin.org/posts/2011/11/26/import-from-wpcom-to-octopress/">Octopress搬家记</a>，<a href="http://blog.dayanjia.com/2012/04/migration-to-octopress-from-wordpress/">从Wordpress迁移到Octopress</a></sub></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[当我再谈跑步时]]></title>
    <link href="http://voice.lawrencesun.info/posts/2015/05/24/when-i-talk-about-running/"/>
    <updated>2015-05-24T10:49:37+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2015/05/24/when-i-talk-about-running</id>
    <content type="html"><![CDATA[<p>去年，<a href="https://knewone.com/things/wei-le-weloop-fei-zhi-neng-ruan-jian-yun-dong-yao-bao/reviews/5455b11331302d04e1540200">当我谈跑步时</a>，我只是谈谈而已。</p>

<p>我并没有因坐拥<a href="https://knewone.com/things/picooc-s1-zhi-neng-ti-zhi-jian-kang-cheng/reviews/5459dbc131302d64756d0000">四大名器</a>而弃键盘从戎，而是仰望天空，思考了诸如为什么要跑步，什么时候跑步，如何优雅地跑步等哲学问题…</p>

<p>当楼下的野猫再次发情的时候，我想，It&rsquo;s now or never… 放进背景音乐也许不错…</p>

<p>为了不让所有的slim裤子撑成regular，我决定再次迈出第一步 &mdash;&mdash;</p>

<!-- more -->


<p>买装备。于是，蓝牙心率带/小米手环/某宝爆款蓝牙耳机和原有的四大名器合体成为我的跑步七魂器。</p>

<p>经过一段时间的测试，小米手环成功让<a href="http://voice.lawrencesun.info/posts/2013/12/31/fitbit-flex-review/">Fitbit Flex</a>安心退休。</p>

<p>作为百元档次的手环，小米的续航、活动/睡眠自动识别都略有惊喜，同步略一般，可以连接微信运动参与好友PK。</p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/IMG_20150509_180459.jpg?imageView2/2/w/300/h/400/q/75|watermark/2/text/TGF3cmVuY2VTdW4=/font/YXJpYWw=/fontsize/300/fill/I0VGRUZFRg==/dissolve/56/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p>这里顺便要说一句，Fitbit作为一个老同志，服役一年半仍能胜任工作，质量、同步、续航和社区都做得不错。</p>

<p>光走路是不够的，而唯一让我能燃起跑步欲望的大概就是数据了吧。当然这其中不包括体脂数据，因为各项评分都达标&hellip;</p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/Screenshot_2015-05-07-21-33-33.jpeg?imageView2/2/w/300/h/400/q/75|watermark/2/text/TGF3cmVuY2VTdW4=/font/YXJpYWw=/fontsize/300/fill/I0VGRUZFRg==/dissolve/56/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p>跑步时，心率是反映强度的重要指标，可以指导速度控制在(60%~80%) *（220-年龄）的有氧区间内。最初考虑的是GPS心率多功能表，但是价格小贵，作为初学者我还是选择了迪卡侬蓝牙心率带，通过手机来接收和同步数据。</p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/IMG_20150524_120626.jpg?imageView2/2/w/400/h/300/q/75|watermark/2/text/TGF3cmVuY2VTdW4=/font/YXJpYWw=/fontsize/300/fill/I0VGRUZFRg==/dissolve/56/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p>试用了几款运动APP，咕咚运动的社区做得不错，可惜不支持第三方的心率带。Runtastic界面做得不错，但是同步有点问题，训练方案另需付费。最终选择了miCoach来记录心率和轨迹，同时miCoach还提供了很棒的训练方案，可以根据实时心率数据来语音指导速度和时间。</p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/IMG_20150524_120444.jpg?imageView2/2/w/300/h/400/q/75|watermark/2/text/TGF3cmVuY2VTdW4=/font/YXJpYWw=/fontsize/300/fill/I0VGRUZFRg==/dissolve/56/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/Screenshot_2015-05-20-20-29-40.jpeg?imageView2/2/w/300/h/400/q/75|watermark/2/text/TGF3cmVuY2VTdW4=/font/YXJpYWw=/fontsize/300/fill/I0VGRUZFRg==/dissolve/56/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p>由于严格控制心率，刚开始时速度很慢，不断被包括大妈大伯在内的其他人超过&hellip; 当然大多数跑不了几圈。</p>

<p>跑了几次，觉得体力渐渐恢复了，接下来的一段时间，还要配合力量训练才行，争取今年能跑一个半马。</p>

<p>文章写到最后一段，通常要表明主旨，升华主题: 我在跑步，约吗&hellip;</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[WordPress迁移至Windows主机]]></title>
    <link href="http://voice.lawrencesun.info/posts/2015/05/03/wordpress-migration-to-windows-server/"/>
    <updated>2015-05-03T10:56:59+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2015/05/03/wordpress-migration-to-windows-server</id>
    <content type="html"><![CDATA[<p>去年底接了一个建立网站的小项目，考虑到该网站偏向于新闻发布，对其他功能要求不高，所以使用WordPress搭建是一个比较便捷的方式。</p>

<p>本机测试是在<em>Ubuntu</em>的虚拟机环境下，但是网站最终需要搭建在<em>Windows Server 2012 R2</em>的虚拟主机上。</p>

<blockquote><p>Windows Server 环境配置</p></blockquote>

<!-- more -->


<p>WordPress需要PHP/MySQL等环境，当然可以自己选择相应版本安装，但是很容易出错。我使用的是Web Platform Installer的傻瓜式安装。</p>

<p>打开Web PI，搜索WordPress并点击安装。在安装MySQL时需要设置root的密码，这里需要记一下，后面有用。Web PI随后会自行下载和安装所需要的环境。然后就是站点配置，包括物理地址、主机和ip地址等。</p>

<p>接下来就是常见的WP安装步骤。</p>

<blockquote><p>WordPress 数据迁移</p></blockquote>

<p>通过phpMyAdmin导出旧的数据库, 将wp-content文件夹拷贝上传至新主机并在新主机上导入新的数据库。修改<code>wp-config.php</code>中DB_NAME, DB_USER, DB_PASSWORD, DB_HOST，更新为新主机的记录。</p>

<blockquote><p>安全性</p></blockquote>

<p>主要是定期数据备份，选择相对强的密码，以及ip限制。</p>

<p>在IIS的界面里有限制访问的功能，最好是对wp-admin文件夹设置一个仅限内网ip访问的权限控制。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: Authorization using Pundit]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/12/13/rails-notes-authorization-using-pundit/"/>
    <updated>2014-12-13T09:39:39+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/12/13/rails-notes-authorization-using-pundit</id>
    <content type="html"><![CDATA[<p>Authentitcation identifies a user, and authorization controls what a user can do. The most famous gem used for authorization in rails is <a href="railscasts.com/episodes/192-authorization-with-cancan">CanCan</a>, which is developed by Ryan Bates. However, this gem was no longer maintained. <a href="https://github.com/CanCanCommunity/cancancan">CanCanCan</a> and <a href="https://github.com/elabs/pundit">Pundit</a> are alternative gems we could use. Here I choosed Pundit.</p>

<p>First, implement user roles. Define roles in User Model by using enum and add a new column to user table.</p>

<!-- more -->


<p><code>enum role: [:guest, :vip, :admin]</code></p>

<p><code>rails g migration AddRoleToUsers role:integer</code></p>

<p>Set the default user as guest. We could assign roles like user1.admin! and question the roles like user1.admin?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">AddRoleToUsers</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">up</span>
</span><span class='line'>      <span class="n">add_column</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:role</span><span class="p">,</span> <span class="ss">:integer</span><span class="p">,</span> <span class="ss">default</span><span class="p">:</span> <span class="mi">0</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">down</span>
</span><span class='line'>      <span class="n">remove_column</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:role</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, <code>gem "pundit"</code> into Gemfile and run bundle install.</p>

<p>Run <code>rails g pundit:install</code> to generate a default policy in app/policies/application_policy.rb</p>

<p>Then create own policy, for example, a Post Policy.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">PostPolicy</span> <span class="o">&lt;</span> <span class="no">ApplicationPolicy</span>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:current_user</span><span class="p">,</span> <span class="ss">:post</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">current_user</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@current_user</span> <span class="o">=</span> <span class="n">current_user</span>
</span><span class='line'>    <span class="vi">@post</span> <span class="o">=</span> <span class="n">post</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">update?</span>
</span><span class='line'>    <span class="vi">@current_user</span><span class="o">.</span><span class="n">admin?</span> <span class="ow">or</span> <span class="vi">@post</span><span class="o">.</span><span class="n">user</span> <span class="o">==</span> <span class="vi">@current_user</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">destroy?</span>
</span><span class='line'>      <span class="vi">@current_user</span><span class="o">.</span><span class="n">admin?</span> <span class="ow">or</span> <span class="vi">@post</span><span class="o">.</span><span class="n">user</span> <span class="o">==</span> <span class="vi">@current_user</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>So if current user is not the author of this post or admin, then he is not allowed to update or destroy the post.</p>

<p>After that, add <code>autorize @post</code> to update and destroy action in Post Controller.</p>

<p>In Post show page, if current user do not have the permission, he will not see the edit and delete button.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">% if </span><span class="n">policy</span><span class="p">(</span><span class="vi">@post</span><span class="p">)</span><span class="o">.</span><span class="n">update?</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx"> ...</span>
</span><span class='line'><span class="sx">&lt;% end %&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally, add following code to Application Controller, so that we include Pundit and show the customized alert.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="kp">include</span> <span class="no">Pundit</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="n">rescue_from</span> <span class="ss">Pundit</span><span class="p">:</span><span class="ss">:NotAuthorizedError</span><span class="p">,</span> <span class="ss">with</span><span class="p">:</span> <span class="ss">:user_not_authorized</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">user_not_authorized</span>
</span><span class='line'>    <span class="n">redirect_to</span> <span class="ss">:back</span><span class="p">,</span> <span class="ss">:alert</span> <span class="o">=&gt;</span> <span class="s2">&quot;You don&#39;t have permission to those resources.&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>UPDATE:</p>

<p>Sometimes current_user are not defined, for example a guest user who is not signed in. Then the above authorization may raise a <code>undefined method 'admin?' for nil:NilClass</code> problem, which I met. The solution would be changing <code>current_user.admin?</code> to <code>current_user.try(:admin?)</code>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: Deeply Nested Resources]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/11/29/rails-notes-deeply-nested-resources/"/>
    <updated>2014-11-29T21:29:26+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/11/29/rails-notes-deeply-nested-resources</id>
    <content type="html"><![CDATA[<p>Nested resources are commonly used in rails app. For example,</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>resources :books do
</span><span class='line'>  resources :posts do
</span><span class='line'>      resources :comments
</span><span class='line'>  end
</span><span class='line'>  resources :comments
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>However, when it&rsquo;s deeply-nested, the URL will looks like this as a monster, <code>/books/:id/posts/:id/comments</code>. And it will cause some difficulties when trying to create/edit comments.</p>

<!-- more -->


<p>For example, <code>book_post_comment_path(@book, @post, @comment)</code> looks complicated and non reusable.</p>

<p>It&rsquo;s also hard to handle different params in comments controller.</p>

<p>So I tried to refactor the code today.</p>

<p>First I changed the routes.rb:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">resources</span> <span class="ss">:books</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">resources</span> <span class="ss">:posts</span>
</span><span class='line'>  <span class="n">resources</span> <span class="ss">:comments</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">resources</span> <span class="ss">:posts</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">resources</span> <span class="ss">:comments</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will generate the routes like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">books</span><span class="o">/</span><span class="ss">:id</span><span class="o">/</span><span class="n">posts</span>
</span><span class='line'><span class="n">books</span><span class="o">/</span><span class="ss">:id</span><span class="o">/</span><span class="n">comments</span>
</span><span class='line'><span class="n">posts</span><span class="o">/</span><span class="ss">:id</span>
</span><span class='line'><span class="n">posts</span><span class="o">/</span><span class="ss">:id</span><span class="o">/</span><span class="n">comments</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this way, the comments action can be used in the same way whatever the @commentable is.</p>

<p>The posts controller will not need @postable id except new/create action. If you want to create a new post on books show page like me, you still have to pass books_id to @postable.</p>

<p>And for me, after creating the new post, it will redirect_to @post rather than [@postable, @post]. So when creating new comment for post, it happens on posts/:id page. I also added a link back to this post&rsquo;s parent using @post.postable .</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: Polymorphic Path]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/11/29/rails-notes-polymorphic-path/"/>
    <updated>2014-11-29T21:26:30+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/11/29/rails-notes-polymorphic-path</id>
    <content type="html"><![CDATA[<p>In my rails app, movie/book and post are in the <em>polymorphic</em> relationship. In <code>posts/show.html.erb</code>, I tried to add &lsquo;Edit&rsquo; and &lsquo;Delete&rsquo; function. The problem was how to write related path.</p>

<p>At first, I used <em>if&hellip;else</em> condition to judge @postable_type. When it equals to &lsquo;Book&rsquo;, then showed <code>edit_book_post_path(@post.postable_id, @post)</code> and <code>book_path(@post.postable_id)</code>, and if it equals to &lsquo;Movie&rsquo;, then showed the related movie path.</p>

<p>It worked fine, but a little bit complicated. The same problem when I render the comments partial, I had to use two different files to handle edit/delete comment path.</p>

<p>Then I found polymorphic_path method on RailsGuides and some articles on the Web.</p>

<!-- more -->


<p>Briefly speaking, the final code I use like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">link_to</span> <span class="s1">&#39;Edit&#39;</span><span class="p">,</span> <span class="n">edit_polymorphic_path</span><span class="p">(</span><span class="o">[</span><span class="vi">@postable</span><span class="p">,</span> <span class="vi">@post</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'><span class="n">link_to</span> <span class="s1">&#39;Delete&#39;</span><span class="p">,</span> <span class="n">polymorphic_path</span><span class="p">(</span><span class="o">[</span><span class="vi">@postable</span><span class="p">,</span> <span class="vi">@post</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'><span class="n">link_to</span> <span class="s1">&#39;New Post&#39;</span><span class="p">,</span> <span class="n">new_polymorphic_path</span><span class="p">(</span><span class="o">[</span><span class="vi">@postable</span><span class="p">,</span> <span class="vi">@post</span><span class="o">]</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, I can abandon the if&hellip;else condition and use the same template whatever the @postable is.</p>

<p>I also refactor the controller like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">create</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>  <span class="k">if</span> <span class="vi">@post</span><span class="o">.</span><span class="n">save</span>
</span><span class='line'>      <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>  <span class="n">redirect_to</span> <span class="o">[</span><span class="vi">@postable</span><span class="p">,</span> <span class="vi">@post</span><span class="o">]</span>
</span><span class='line'>      <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Doing this way, it&rsquo;s simple and clear.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[华为路由器开启Web登陆]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/11/29/huawei-router-init/"/>
    <updated>2014-11-29T20:04:14+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/11/29/huawei-router-init</id>
    <content type="html"><![CDATA[<p>对于一台新的路由器来说，默认ip地址一般式是（192.168.1.1)。可以用一台PC连接路由器的任意lan口，并将PC的本地ip地址设为(192.168.1.x)(x一般取0~15，不为1)，掩码(255.255.255.0)，网关(192.168.1.1)。</p>

<p>但是昨天试图通过Web端来配置华为AR1220-S路由器的时候，一直无法连接。</p>

<p>在华为技术支持和网络资源的帮助下，发现原因可能是原厂默认下无法实现Web登陆。</p>

<p>最终是通过Console接口初始了路由器的ip并打开了Web登陆的功能。</p>

<p>具体步骤如下:</p>

<!-- more -->


<p>1.Console线连接后，使用xp下的超级终端新建一个连接，进入console端界面。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;Huawei&gt;system-view  //进入系统视图
</span><span class='line'>[Huawei]interface gigabitethernet 0/0/0  //进入接口视图
</span><span class='line'>[Huawei-GigabitEthernet0/0/0]ip address 192.168.1.1 24 //在该接口配置管理ip地址
</span><span class='line'>[Huawei-GigabitEthernet0/0/0]display ip interface brief  //查看配置情况
</span><span class='line'>[Huawei-GigabitEthernet0/0/0]aaa  //进入AAA视图
</span><span class='line'>[Huawei-aaa]local-user _user-name_ password cipher _password_
</span><span class='line'>                      local-user _user-name_ privilege level _level_
</span><span class='line'>                      local-user _user-name_ service-type http
</span><span class='line'>                      // 配置用户名、密码、权限以及访问类型</span></code></pre></td></tr></table></div></figure>


<p>2.执行quit, 返回系统视图。</p>

<p>3.此时PC端连接gigabitethernet0/0/0接口，确认可以ping通路由ip。</p>

<p>4.会发现还是不能登陆Web端，因此需要在Console端输入http server enable</p>

<p>通过以上步骤，就可以进入Web端界面并根据需求对路由器进行配置了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: At or Reply to Someone]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/11/09/rails-notes-at-someone/"/>
    <updated>2014-11-09T08:52:19+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/11/09/rails-notes-at-someone</id>
    <content type="html"><![CDATA[<p><strong>1. At</strong></p>

<p>The &lsquo;@&rsquo; function is used widely on web apps.</p>

<p>Here I use a jquery plugin called <a href="https://github.com/ichord/At.js">atwho</a>. First download jquery.atwho.js, jquery.caret.js, jquery.atwho.css. Then add these files to app/assets.</p>

<p>Add <code>//= require jquery.atwho</code> to app/assets/javascripts/application.js and add <code>*= require jquery.atwho</code> to app/assets/stylesheets/application.css.scss.</p>

<!-- more -->


<p>Then use it to at users when replying a comment. Following <a href="http://happycasts.net/episodes/76">happycasts</a>, bind the textarea like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$(function(){
</span><span class='line'>  var commenter = [];
</span><span class='line'>  var commenter_exist= [];
</span><span class='line'>  $('.comment-user').each(function() {
</span><span class='line'>      if($.inArray($(this).text(), commenter_exist) &lt; 0){
</span><span class='line'>      commenter.push($(this).text());
</span><span class='line'>      commenter_exist.push($(this).text());
</span><span class='line'>    }
</span><span class='line'>  });
</span><span class='line'>  $('textarea').atwho({at:"@", 'data':commenter});
</span><span class='line'>});</span></code></pre></td></tr></table></div></figure>


<p>One problem I found was this atwho funciont didn&rsquo;t work until refreshed this page. When I deleted turoblink, it worked fine. So Finally I solved it by using a gem called <a href="https://github.com/kossnocorp/jquery.turbolinks">jquery.turbolinks</a>.</p>

<p><strong>2. Reply</strong></p>

<p>Sometimes we would like to reply to other&rsquo;s comment. When we click reply button, we want to &lsquo;@&rsquo; this comment&rsquo;s author.</p>

<p>Thanks to <a href="https://github.com/chloerei/campo">Campo</a> app, I added reply function to my own rails app.</p>

<p>Add following parts to comments view.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;a class="btn", data-reply-to="@&lt;%= comment.user.name %&gt; " &gt;
</span><span class='line'>  &lt;i class="fa fa-reply"&gt;&lt;/i&gt;
</span><span class='line'>&lt;/a&gt;</span></code></pre></td></tr></table></div></figure>


<p>Then include a coffee javascript file. Remember to set corrosponding class/id in the html file.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$(document).on 'click', '.comments [data-reply-to]', -&gt;
</span><span class='line'>  textarea = $('#new_comment textarea')
</span><span class='line'>  textarea.focus()
</span><span class='line'>  textarea.val(textarea.val() + $(this).data('reply-to'))</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: Link to Commentable]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/11/08/rails-notes-link-to-commentable/"/>
    <updated>2014-11-08T17:19:09+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/11/08/rails-notes-link-to-commentable</id>
    <content type="html"><![CDATA[<p>Few days ago I created a polymorphic comment model based on <a href="http://railscasts.com/episodes/154-polymorphic-association">Railscasts</a>.</p>

<p>Today I wanted to show the lastest comments on homepage and link each comment body to their &lsquo;parents&rsquo; like a book or a movie.</p>

<p>The link path was a bit tricky and finally I figured it out.</p>

<p>What you need here is this particular comment&rsquo;s commentable type like &lsquo;book&rsquo; or &lsquo;movie&rsquo;, as well as the commentable id, so it will leads you to the show page and the url should like &lsquo;book/id&rsquo;.</p>

<!-- more -->


<p>The view page could look like this.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;%=</span> <span class="n">link_to</span> <span class="n">markdown</span><span class="p">(</span><span class="vi">@comment</span><span class="o">.</span><span class="n">body</span><span class="p">),</span> <span class="o">[</span><span class="vi">@comment</span><span class="o">.</span><span class="n">commentable</span><span class="p">,</span> <span class="vi">@comment</span><span class="o">]</span> <span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Then it will pass commentable type and id, looking for comment/show action.</p>

<p>So add show action in comments_controller like this</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">show</span>
</span><span class='line'>  <span class="n">redirect_to</span> <span class="vi">@commentable</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will direct to the page that I want.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Use Android Toggle Button]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/11/08/how-to-use-android-toggle-button/"/>
    <updated>2014-11-08T14:57:11+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/11/08/how-to-use-android-toggle-button</id>
    <content type="html"><![CDATA[<p>I am taking an online android course on Coursera. The first assignment is to build a app which could properly present text and image.</p>

<p>Apart from what I learned from the first three lectures, I also tried to add something interesting. I wanted to show two photos in the same place and allowed users to switching between them. So I chosed Toggle Button.</p>

<p>However, I was not quite followed the instructions on Android Developer Online <a href="http://developer.android.com/guide/topics/ui/controls/togglebutton.html)">Doc</a>. Besides, some problems like &lsquo;variables are not resolved&rsquo; occurred.</p>

<p>After searching for the solution on <a href="http://stackoverflow.com/questions/18335239/android-toggle-button-custom-look">Stackoverflow</a> and finding <a href="http://liangruijun.blog.51cto.com/3061169/655014">example</a> apps, I finally managed to achieve what I want.</p>

<!-- more -->


<p>First a toggle button in layout.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;</span><span class="n">ToggleButton</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">id</span><span class="o">=</span><span class="s">&quot;@+id/toggleButton1&quot;</span>
</span><span class='line'>  <span class="o">...</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">textOn</span><span class="o">=</span><span class="s">&quot;&quot;</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">textOff</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="o">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Add ToggleButton function in MainActivity.java.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">android.widget.CompoundButton</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.widget.CompoundButton.OnCheckedChangeListener</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.widget.LinearLayout</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.widget.ImageView</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.widget.ToggleButton</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">ActionBarActivity</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">ImageView</span> <span class="n">imageView</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">ToggleButton</span> <span class="n">toggleButton</span><span class="o">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>      <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
</span><span class='line'>      <span class="n">imageView</span> <span class="o">=</span> <span class="o">(</span><span class="n">ImageView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">imageView1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">toggleButton</span> <span class="o">=</span> <span class="o">(</span><span class="n">ToggleButton</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">toggleButton1</span><span class="o">);</span>
</span><span class='line'>        <span class="n">toggleButton</span><span class="o">.</span><span class="na">setOnCheckedChangeListener</span><span class="o">(</span><span class="k">new</span> <span class="n">OnCheckedChangeListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCheckedChanged</span><span class="o">(</span><span class="n">CompoundButton</span> <span class="n">buttonView</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">isChecked</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">toggleButton</span><span class="o">.</span><span class="na">setChecked</span><span class="o">(</span><span class="n">isChecked</span><span class="o">);</span>
</span><span class='line'>                <span class="n">imageView</span><span class="o">.</span><span class="na">setImageResource</span><span class="o">(</span><span class="n">isChecked</span><span class="o">?</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">hznight</span><span class="o">:</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">hzday</span><span class="o">);</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>        <span class="o">});</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Generate a new file called &lsquo;ic_toggle&rsquo; in drawable folder and customize toggle button in layout.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;selector</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;item</span> <span class="na">android:drawable=</span><span class="s">&quot;@drawable/night&quot;</span> <span class="na">android:state_checked=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;item</span> <span class="na">android:drawable=</span><span class="s">&quot;@drawable/day&quot;</span> <span class="na">android:state_checked=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/selector&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;ToggleButton</span>
</span><span class='line'>  <span class="err">...</span>
</span><span class='line'>  <span class="na">android:background=</span><span class="s">&quot;@drawable/ic_toggle&quot;</span>
</span><span class='line'>  <span class="na">android:textOn=</span><span class="s">&quot;&quot;</span>
</span><span class='line'>  <span class="na">android:textOff=</span><span class="s">&quot;&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: 利用七牛云储存Paperclip图片]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/11/02/railsnotes-storage-paperclip-images/"/>
    <updated>2014-11-02T20:37:35+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/11/02/railsnotes-storage-paperclip-images</id>
    <content type="html"><![CDATA[<p>之前使用<a href="http://voice.lawrencesun.info/posts/2014/09/21/rails-notes-upload-avatar-using-paperclip/">Paperclip来实现Rails应用上传图片的功能</a>, 但是在部署到Heroku时会有无法储存的问题, 每次push都会删除之前上传的图片。</p>

<p>这是因为Heroku不支持动态上传文件, 很多人碰到这种情况, Stackoverflow上推荐的解决方案是使用Amazon S3, 但是这个服务需要信用卡注册, 另外只能免费使用一年。</p>

<p>这无疑会提高试错和测试阶段的成本。经过另一番搜索, 发现<a href="https://portal.qiniu.com/signup?code=3lnzd178edmqa">七牛云</a>储存可以用来实现图片的储存和调用。</p>

<!-- more -->


<p>首先需要调用<a href="https://github.com/lidaobing/paperclip-qiniu">paperclip-qiniu</a>的gem, 并对之前使用paperclip的相关文件进行修改。</p>

<p>修改paperclip的初始化内容, <code>config/initializers/paperclip.rb</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Paperclip</span><span class="p">:</span><span class="ss">:Attachment</span><span class="o">.</span><span class="n">default_options</span><span class="o">[</span><span class="ss">:storage</span><span class="o">]</span> <span class="o">=</span> <span class="ss">:qiniu</span>
</span><span class='line'><span class="ss">Paperclip</span><span class="p">:</span><span class="ss">:Attachment</span><span class="o">.</span><span class="n">default_options</span><span class="o">[</span><span class="ss">:qiniu_credentials</span><span class="o">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="ss">:access_key</span> <span class="o">=&gt;</span> <span class="s1">&#39;youraccesskey&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:secret_key</span> <span class="o">=&gt;</span> <span class="s1">&#39;yoursecretkey&#39;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="ss">Paperclip</span><span class="p">:</span><span class="ss">:Attachment</span><span class="o">.</span><span class="n">default_options</span><span class="o">[</span><span class="ss">:bucket</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;topics-1024&#39;</span>
</span><span class='line'><span class="ss">Paperclip</span><span class="p">:</span><span class="ss">:Attachment</span><span class="o">.</span><span class="n">default_options</span><span class="o">[</span><span class="ss">:use_timestamp</span><span class="o">]</span> <span class="o">=</span> <span class="kp">false</span>
</span><span class='line'><span class="ss">Paperclip</span><span class="p">:</span><span class="ss">:Attachment</span><span class="o">.</span><span class="n">default_options</span><span class="o">[</span><span class="ss">:qiniu_host</span><span class="o">]</span> <span class="o">=</span>
</span><span class='line'>  <span class="s1">&#39;http://yourhostname.qiniudn.com&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>这里access_key, secret_key, qiniu_host分别是七牛云储存的相关信息。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">has_attached_file</span> <span class="ss">:photo</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:default_url</span> <span class="o">=&gt;</span> <span class="s1">&#39;http://xxx.com/bookmissing.jpg&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s2">&quot;:class/:attachment/:id/:basename.:extension&quot;</span>
</span><span class='line'><span class="n">validates_attachment_content_type</span> <span class="ss">:photo</span><span class="p">,</span> <span class="ss">:content_type</span> <span class="o">=&gt;</span> <span class="sr">/\Aimage\/.*\Z/</span>
</span></code></pre></td></tr></table></div></figure>


<p>其中default_url是默认图片, 可以事先上传至七牛。</p>

<p>path是图片储存和调用的地址, 可以根据需要来更改。例如:</p>

<p><code>http://yourhost-qiniudn.com/books/photos/1/name.jpg</code></p>

<p>接下来需要在view中调用:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= qiniu_image_tag @movie.photo.url, :thumbnail =</span><span class="o">&gt;</span> <span class="s1">&#39;212x316!&#39;</span><span class="p">,</span> <span class="ss">:quality</span> <span class="o">=&gt;</span> <span class="mi">80</span> <span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>这里可以自定义一些选项, 比如thumbnail, gravity, crop, quality等, 具体可以参考七牛云的<a href="http://docs.qiniutek.com/v3/api/foimg/#imageView">高级图像处理接口</a>文档。</p>

<p>至此，实现了paperclip上传图片的存储和调用。</p>
]]></content>
  </entry>
  
</feed>
