<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Lawrence Sun]]></title>
  <link href="http://voice.lawrencesun.info/atom.xml" rel="self"/>
  <link href="http://voice.lawrencesun.info/"/>
  <updated>2014-11-08T17:34:22+08:00</updated>
  <id>http://voice.lawrencesun.info/</id>
  <author>
    <name><![CDATA[Lawrence Sun]]></name>
    <email><![CDATA[yuliang1987@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Rails Notes: Link to Commentable]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/11/08/rails-notes-link-to-commentable/"/>
    <updated>2014-11-08T17:19:09+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/11/08/rails-notes-link-to-commentable</id>
    <content type="html"><![CDATA[<p>Few days ago I created a polymorphic comment model based on <a href="http://railscasts.com/episodes/154-polymorphic-association">Railscasts</a>.</p>

<p>Today I wanted to show the lastest comments on homepage and link each comment body to their &lsquo;parents&rsquo; like a book or a movie.</p>

<p>The link path was a bit tricky and finally I figured it out.</p>

<p>What you need here is this particular comment&rsquo;s commentable type like &lsquo;book&rsquo; or &lsquo;movie&rsquo;, as well as the commentable id, so it will leads you to the show page and the url should like &lsquo;book/id&rsquo;.</p>

<!-- more -->


<p>The view page could look like this.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;%=</span> <span class="n">link_to</span> <span class="n">markdown</span><span class="p">(</span><span class="vi">@comment</span><span class="o">.</span><span class="n">body</span><span class="p">),</span> <span class="o">[</span><span class="vi">@comment</span><span class="o">.</span><span class="n">commentable</span><span class="p">,</span> <span class="vi">@comment</span><span class="o">]</span> <span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Then it will pass commentable type and id, looking for comment/show action.</p>

<p>So add show action in comments_controller like this</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">show</span>
</span><span class='line'>  <span class="n">redirect_to</span> <span class="vi">@commentable</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will direct to the page that I want.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Use Android Toggle Button]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/11/08/how-to-use-android-toggle-button/"/>
    <updated>2014-11-08T14:57:11+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/11/08/how-to-use-android-toggle-button</id>
    <content type="html"><![CDATA[<p>I am taking an online android course on Coursera. The first assignment is to build a app which could properly present text and image.</p>

<p>Apart from what I learned from the first three lectures, I also tried to add something interesting. I wanted to show two photos in the same place and allowed users to switching between them. So I chosed Toggle Button.</p>

<p>However, I was not quite followed the instructions on Android Developer Online <a href="http://developer.android.com/guide/topics/ui/controls/togglebutton.html)">Doc</a>. Besides, some problems like &lsquo;variables are not resolved&rsquo; occurred.</p>

<p>After searching for the solution on <a href="http://stackoverflow.com/questions/18335239/android-toggle-button-custom-look">Stackoverflow</a> and finding <a href="http://liangruijun.blog.51cto.com/3061169/655014">example</a> apps, I finally managed to achieve what I want.</p>

<!-- more -->


<p>First a toggle button in layout.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;</span><span class="n">ToggleButton</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">id</span><span class="o">=</span><span class="s">&quot;@+id/toggleButton1&quot;</span>
</span><span class='line'>  <span class="o">...</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">textOn</span><span class="o">=</span><span class="s">&quot;&quot;</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">textOff</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="o">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Add ToggleButton function in MainActivity.java.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">android.widget.CompoundButton</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.widget.CompoundButton.OnCheckedChangeListener</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.widget.LinearLayout</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.widget.ImageView</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.widget.ToggleButton</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">ActionBarActivity</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">ImageView</span> <span class="n">imageView</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">ToggleButton</span> <span class="n">toggleButton</span><span class="o">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>      <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
</span><span class='line'>      <span class="n">imageView</span> <span class="o">=</span> <span class="o">(</span><span class="n">ImageView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">imageView1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">toggleButton</span> <span class="o">=</span> <span class="o">(</span><span class="n">ToggleButton</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">toggleButton1</span><span class="o">);</span>
</span><span class='line'>        <span class="n">toggleButton</span><span class="o">.</span><span class="na">setOnCheckedChangeListener</span><span class="o">(</span><span class="k">new</span> <span class="n">OnCheckedChangeListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCheckedChanged</span><span class="o">(</span><span class="n">CompoundButton</span> <span class="n">buttonView</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">isChecked</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">toggleButton</span><span class="o">.</span><span class="na">setChecked</span><span class="o">(</span><span class="n">isChecked</span><span class="o">);</span>
</span><span class='line'>                <span class="n">imageView</span><span class="o">.</span><span class="na">setImageResource</span><span class="o">(</span><span class="n">isChecked</span><span class="o">?</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">hznight</span><span class="o">:</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">hzday</span><span class="o">);</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>        <span class="o">});</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Generate a new file called &lsquo;ic_toggle&rsquo; in drawable folder and customize toggle button in layout.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;selector</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;item</span> <span class="na">android:drawable=</span><span class="s">&quot;@drawable/night&quot;</span> <span class="na">android:state_checked=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;item</span> <span class="na">android:drawable=</span><span class="s">&quot;@drawable/day&quot;</span> <span class="na">android:state_checked=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/selector&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;ToggleButton</span>
</span><span class='line'>  <span class="err">...</span>
</span><span class='line'>  <span class="na">android:background=</span><span class="s">&quot;@drawable/ic_toggle&quot;</span>
</span><span class='line'>  <span class="na">android:textOn=</span><span class="s">&quot;&quot;</span>
</span><span class='line'>  <span class="na">android:textOff=</span><span class="s">&quot;&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: 利用七牛云储存Paperclip图片]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/11/02/railsnotes-storage-paperclip-images/"/>
    <updated>2014-11-02T20:37:35+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/11/02/railsnotes-storage-paperclip-images</id>
    <content type="html"><![CDATA[<p>之前使用<a href="http://voice.lawrencesun.info/posts/2014/09/21/rails-notes-upload-avatar-using-paperclip/">Paperclip来实现Rails应用上传图片的功能</a>, 但是在部署到Heroku时会有无法储存的问题, 每次push都会删除之前上传的图片。</p>

<p>这是因为Heroku不支持动态上传文件, 很多人碰到这种情况, Stackoverflow上推荐的解决方案是使用Amazon S3, 但是这个服务需要信用卡注册, 另外只能免费使用一年。</p>

<p>这无疑会提高试错和测试阶段的成本。经过另一番搜索, 发现<a href="https://portal.qiniu.com/signup?code=3lnzd178edmqa">七牛云</a>储存可以用来实现图片的储存和调用。</p>

<!-- more -->


<p>首先需要调用<a href="https://github.com/lidaobing/paperclip-qiniu">paperclip-qiniu</a>的gem, 并对之前使用paperclip的相关文件进行修改。</p>

<p>修改paperclip的初始化内容, <code>config/initializers/paperclip.rb</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Paperclip</span><span class="p">:</span><span class="ss">:Attachment</span><span class="o">.</span><span class="n">default_options</span><span class="o">[</span><span class="ss">:storage</span><span class="o">]</span> <span class="o">=</span> <span class="ss">:qiniu</span>
</span><span class='line'><span class="ss">Paperclip</span><span class="p">:</span><span class="ss">:Attachment</span><span class="o">.</span><span class="n">default_options</span><span class="o">[</span><span class="ss">:qiniu_credentials</span><span class="o">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="ss">:access_key</span> <span class="o">=&gt;</span> <span class="s1">&#39;youraccesskey&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:secret_key</span> <span class="o">=&gt;</span> <span class="s1">&#39;yoursecretkey&#39;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="ss">Paperclip</span><span class="p">:</span><span class="ss">:Attachment</span><span class="o">.</span><span class="n">default_options</span><span class="o">[</span><span class="ss">:bucket</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;topics-1024&#39;</span>
</span><span class='line'><span class="ss">Paperclip</span><span class="p">:</span><span class="ss">:Attachment</span><span class="o">.</span><span class="n">default_options</span><span class="o">[</span><span class="ss">:use_timestamp</span><span class="o">]</span> <span class="o">=</span> <span class="kp">false</span>
</span><span class='line'><span class="ss">Paperclip</span><span class="p">:</span><span class="ss">:Attachment</span><span class="o">.</span><span class="n">default_options</span><span class="o">[</span><span class="ss">:qiniu_host</span><span class="o">]</span> <span class="o">=</span>
</span><span class='line'>  <span class="s1">&#39;http://yourhostname.qiniudn.com&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>这里access_key, secret_key, qiniu_host分别是七牛云储存的相关信息。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">has_attached_file</span> <span class="ss">:photo</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:default_url</span> <span class="o">=&gt;</span> <span class="s1">&#39;http://xxx.com/bookmissing.jpg&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s2">&quot;:class/:attachment/:id/:basename.:extension&quot;</span>
</span><span class='line'><span class="n">validates_attachment_content_type</span> <span class="ss">:photo</span><span class="p">,</span> <span class="ss">:content_type</span> <span class="o">=&gt;</span> <span class="sr">/\Aimage\/.*\Z/</span>
</span></code></pre></td></tr></table></div></figure>


<p>其中default_url是默认图片, 可以事先上传至七牛。</p>

<p>path是图片储存和调用的地址, 可以根据需要来更改。例如:</p>

<p><code>http://yourhost-qiniudn.com/books/photos/1/name.jpg</code></p>

<p>接下来需要在view中调用:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= qiniu_image_tag @movie.photo.url, :thumbnail =</span><span class="o">&gt;</span> <span class="s1">&#39;212x316!&#39;</span><span class="p">,</span> <span class="ss">:quality</span> <span class="o">=&gt;</span> <span class="mi">80</span> <span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>这里可以自定义一些选项, 比如thumbnail, gravity, crop, quality等, 具体可以参考七牛云的<a href="http://docs.qiniutek.com/v3/api/foimg/#imageView">高级图像处理接口</a>文档。</p>

<p>至此，实现了paperclip上传图片的存储和调用。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: Make Dropdown Work on Heroku]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/10/26/rails-notes-make-dropdown-work-on-heroku/"/>
    <updated>2014-10-26T12:07:57+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/10/26/rails-notes-make-dropdown-work-on-heroku</id>
    <content type="html"><![CDATA[<p>After I deployed a app on Heroku, I found that the Bootstap dropdown menu didn&rsquo;t work on Heroku. It was working in my local development environment.</p>

<p>So I searched the answers from stackoverflow. It seemed that it was a common problem.</p>

<p>I had tried to reorder the //=jquery and //=bootstrap and reorder back again and again. I also ran asset precompile method. However, it still didn&rsquo;t work in my situation.</p>

<p>Then I compared an app I wrote before, and I found that there might be the conflict between &lsquo;bootstrap&rsquo; and &lsquo;bootstrap-spockets&rsquo;. The dropdown menu worked if either of them were removed. So I removed &lsquo;bootstrap&rsquo; finally. I am not sure if it will cause any further problems but so far it&rsquo;s fine.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: Heroku environment configuration problem]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/10/26/rails-notes-heroku-environment-configuration-problem/"/>
    <updated>2014-10-26T12:06:49+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/10/26/rails-notes-heroku-environment-configuration-problem</id>
    <content type="html"><![CDATA[<p>When I tried to deploy one of my rails app on Heroku, the following problem occured.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>can't convert nil into String 
</span><span class='line'>/app/config/initializers/devise.rb:13:in `+'</span></code></pre></td></tr></table></div></figure>


<p>The reason was that I set DOMAIN_NAME etc. inside secret.yml and this file was git ignored since I wanted to keep credentials private. So Heroku couldn&rsquo;t find these configuration values.</p>

<!-- more -->


<p>Using figaro gem seems a good way to fix this. But I didn&rsquo;t want to add another gem and create a new yml file.</p>

<p>What I did was set Heroku environment variables directly and it worked:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ heroku config:add GMAIL_USERNAME='myname@gmail.com' GMAIL_PASSWORD='mypassword'
</span><span class='line'>$ heroku config:add DOMAIN_NAME='example.com'</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: Upload Avatar Using Paperclip]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/09/21/rails-notes-upload-avatar-using-paperclip/"/>
    <updated>2014-09-21T17:28:49+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/09/21/rails-notes-upload-avatar-using-paperclip</id>
    <content type="html"><![CDATA[<p>In my previous rails apps, I used gravatar_for method to link the gravatar to users. In a recent app, I wanted to add cover photos to the books and allow users to upload the images.</p>

<p>So I decided to use paperclip after seeing one of the <a href="http://railscasts.com/episodes/134-paperclip">episode</a> of railscast. Instead of applying the plugin, I installed paperclip gem.</p>

<p>Add <code>gem "paperclip", "~&gt; 4.2"</code> to Gemfile and run <code>bundle install</code>.</p>

<p>Then add photo columns to the existing books table.</p>

<!-- more -->


<p><code>rails g migration AddPhotosToBooks</code></p>

<p>Migration:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">AddAvatarColumnsToUsers</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">up</span>
</span><span class='line'>    <span class="n">add_attachment</span> <span class="ss">:books</span><span class="p">,</span> <span class="ss">:photo</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">down</span>
</span><span class='line'>    <span class="n">remove_attachment</span> <span class="ss">:books</span><span class="p">,</span> <span class="ss">:photo</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will insert four columns into books table: photo_file_name, photo_file_size, photo_content_type, photo_updated_at.</p>

<p>Add the following lines to Book Model:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">has_attached_file</span> <span class="ss">:photo</span><span class="p">,</span> <span class="ss">:styles</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:medium</span> <span class="o">=&gt;</span> <span class="s2">&quot;300x300&gt;&quot;</span><span class="p">,</span> <span class="ss">:thumb</span> <span class="o">=&gt;</span> <span class="s2">&quot;100x100&gt;&quot;</span> <span class="p">},</span> <span class="ss">:default_url</span> <span class="o">=&gt;</span> <span class="s2">&quot;missing.png&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:url</span> <span class="o">=&gt;</span> <span class="s2">&quot;/assets/books/:id/:style/:basename.:extension&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s2">&quot;:rails_root/public/assets/books/:id/:style/:basename.:extension&quot;</span>
</span><span class='line'>  <span class="n">validates_attachment</span> <span class="ss">:photo</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:content_type</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:content_type</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s2">&quot;image/jpeg&quot;</span><span class="p">,</span> <span class="s2">&quot;image/jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;image/gif&quot;</span><span class="p">,</span> <span class="s2">&quot;image/png&quot;</span><span class="o">]</span> <span class="p">},</span>
</span><span class='line'>  <span class="ss">:size</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:less_than</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="o">.</span><span class="n">megabytes</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Forms to be updated:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-group&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="sx">%= f.label &quot;cover&quot; %&gt;</span>
</span><span class='line'><span class="sx"> &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">file_field</span> <span class="ss">:photo</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And the updated book&rsquo;s show view with the uploaded photo.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;%=</span> <span class="n">image_tag</span> <span class="vi">@book</span><span class="o">.</span><span class="n">photo</span><span class="o">.</span><span class="n">url</span><span class="p">(</span><span class="ss">:medium</span><span class="p">)</span> <span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Besides, in order to run paperclip, ImageMagick is required. We can simply install it by homebrew.</p>

<p><code>brew install imagemagick</code></p>

<p>However, when I installed homebrew, several issues came out.</p>

<p>It was a long story, briefly speeking, I ran <code>brew doctor</code> and tried to solve the warning issues by searching the net. Basiclly, I updated Git and Command Line Tool and reinstall the homebrew.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to upgrade git]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/09/21/how-to-upgrade-git/"/>
    <updated>2014-09-21T17:25:08+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/09/21/how-to-upgrade-git</id>
    <content type="html"><![CDATA[<p>When I intended to install ImageMagick via homebrew, and found some issues by runing <code>brew doctor</code>. One was telling me that the git was out of date.</p>

<p>When installing Git for Mac OS via XCode, it points Git to usr/bin/git.
run <code>which git</code> to check out the directory.</p>

<p>If we want to keep git up to date, we could install/upgrade git using homebrew.</p>

<p>Add the line in ~/.bash_profile</p>

<p><code>export PATH="/usr/local/bin:$PATH"</code></p>

<p>Then run <code>brew install git</code> and <code>brew update git</code>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[疑似离婚前夕：我眼中的苏格兰]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/09/18/scotland-independent/"/>
    <updated>2014-09-18T18:48:17+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/09/18/scotland-independent</id>
    <content type="html"><![CDATA[<p>这几天，英国各方“律师”声情并茂甚至声泪俱下地对离婚案件进行了辩护。再过几个小时，随着“陪审团们”投票完毕，关于苏格兰和英格兰的离婚判决即将作出。</p>

<p>假如苏英分家，那么米字旗也许会失去那个叉，而哈利波特们下学期去霍格沃茨就要算出国留学了。作为一个<code>麻瓜</code>，我曾有幸分别于冬夏两季踏访过这片土地，流连忘返之际，简单谈谈我眼中的苏格兰，以及他们和英格兰的区别。</p>

<p>历史上两地人民经常小打小闹，最后打出了感情，四百年前的一纸婚约，使他们结合到了一起。然而包办婚姻并不完美，苏格兰人并没有接受这个现实。随着命运之石的回归，以及北海油田的发现，苏格兰人再次来到了<em>历史的十字路口</em>。</p>

<!-- more -->


<p>说到苏格兰，很多人都会想起《勇敢的心》。“FREEDOM~~”，站在辽阔的苏格兰高地，我也会情不自禁地喊出来，那是在大自然里驰骋的自由。似乎豪爽的苏格兰人骨子里就向往着自由，不知道是否是威士忌的作用。</p>

<ul>
<li><p>首先说说苏格兰人和英格兰人的区别。我的感觉是，英格兰人更加克制与内敛，即便是讲个无节操笑话也要一本正经。而苏格兰人则天真奔放，直来直往。我在旅行期间碰到的两个导游都是这种性格，一个是边开车边讲历史边唱歌的女汉子，一个是喝口酒拉着我就跳起舞的大胡子。苏格兰人对反抗英格兰的战争事迹、神话传说、奇闻异事津津乐道。当然，泡完酒吧之后，区别并不大，我也无法预测哪方的球迷更“流氓”。</p></li>
<li><p>语言方面，除了带浓重苏格兰口音的英语，大多数苏格兰人都会说另一种鸟语，也有自己的文字。</p></li>
<li><p>绘画方面，英格兰所收藏的画作包容并兼，风格各一，而苏格兰所收藏的大多是田园风光。</p></li>
<li><p>音乐方面，英格兰有英伦摇滚，苏格兰有自由风笛，配合传统格子裙的穿着。</p></li>
<li><p>神兽方面，英格兰可见草泥马，苏格兰常遇高地牛。</p></li>
<li><p>至于暗黑料理方面，英格兰的Fish&amp;Chips和苏格兰的Haggis难分高下。</p></li>
</ul>


<p>&hellip;&hellip;</p>

<p>所以，性格不合也许是这场婚姻悲剧的主要原因。</p>

<p>然而，老夫老妻一起生活了这么多年，早已血乳交融。真要分手，你让女王大人情何以堪。</p>

<p>明天，答案即将揭晓，也许是Keep calm and carry on，也许是北境长城一夜崛起，但苏格兰人心中的自由之火一时之间恐难以熄灭。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[曼游记终极篇之欧洲行 Day 8]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/09/13/travel-europe-day-8/"/>
    <updated>2014-09-13T17:01:19+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/09/13/travel-europe-day-8</id>
    <content type="html"><![CDATA[<p>昨晚，乘坐列车来到了夕阳下的米兰。米兰的火车站非常宏伟，圆拱大顶，是我在意大利看到的最豪华的车站。大城市的路标还算清楚，转过几个弯便找到了地铁口。</p>

<p>地铁的自动售票机旁有不少人，很热心地上来帮你选票。之前在网上看到过类似的事，所以我对那个凑过来帮我点屏幕选站的人心存戒备，对他说了句&#8217;I will check it later&#8217;就转身离开了。这时我看到另一个人帮一对情侣买了票，取票出来给他们，由于找钱不是马上就退出的，所以这些人就强制拿小费了。我等到边上没人的时候自己买了一张两天期的票，坐上地铁来到了米兰大教堂。</p>

<!-- more -->


<p><img src="https://lh6.googleusercontent.com/-PbppTbz5URw/Uv9sAc423vI/AAAAAAAAAeA/jzlMn3o9mDQ/w300/IMG_20130621_212859.jpg" alt="img" /></p>

<p><sub>* 夜幕下的米兰大教堂</sub></p>

<p>由于此时夜色已晚，无心欣赏夜色下的米兰街景，沿着via torino这条据说是深受年轻人喜爱的购物街前行，来到了青年旅社。</p>

<p>旅舍一楼是酒吧，很热闹，check in的时候还赠送一杯免费的饮料。我点了一杯啤酒，一饮而尽。然后吧台的两位美女服务员带着我熟悉了一下这个旅舍。地下一层是休闲区，可以玩吉他或者坐在沙发上聊天，四楼是厨房，有免费的意大利面提供。在三楼的露台还见到了老板，大约30岁不到，简单交谈了几句。</p>

<p>房间是8个人的上下铺，装修很新，和大多数青年旅社不同，公用厕所和淋浴都在房间里。这里坐电梯和进房间都是刷门卡，所以还算安全，整理好东西后倒头就睡。</p>

<p><img src="https://lh3.googleusercontent.com/-4F7v08B1Zgo/Uv9sCuNkBjI/AAAAAAAAAeI/Z42CclbpDog/w300/IMG_20130622_093448.jpg" alt="img" /></p>

<p><img src="https://lh6.googleusercontent.com/-IVzVO-AHVR8/Uv9sOWDaUdI/AAAAAAAAAvE/petCSNMzyyY/w300/IMG_20130622_100203.jpg" alt="img" /></p>

<p><sub>* 米兰的电车和街边的模特</sub></p>

<p>早上起来再次来到了世界最大的哥特式教堂——米兰大教堂，内部的彩窗可能是全世界最大的，全部以圣经故事为主题，历经百年，光彩依旧。参观完大教堂后沿着宏伟繁华的的埃马努埃莱二世长廊来到了世界上最优秀之一的斯卡拉大剧院。剧院的演出大厅很华丽，周围一圈都是包间，站在包间看全景听着工作人员的介绍，可以看见舞台上有剧组正在搭建背景。</p>

<p><img src="https://lh3.googleusercontent.com/-7KPlcAFz57A/Uv9sM8htL-I/AAAAAAAAAeY/G1Ua7-Y8OE0/w300/IMG_20130622_095244.jpg" alt="img" /></p>

<p><sub>* 埃马努埃莱二世长廊</sub></p>

<p>出来前往斯福尔扎城堡，这里虽然是四周城墙环绕，看起来森严庄重，里面确实艺术的天堂。里面的博物馆陈列着不少雕刻和绘画，包括米开朗基罗和达芬奇等大家的作品。</p>

<p><img src="https://lh3.googleusercontent.com/-H84ErnUyn1M/Uv9sPkWbPmI/AAAAAAAAAeo/r-xxAcMTKcs/w400/IMG_20130622_110929.jpg" alt="img" /></p>

<p><img src="https://lh3.googleusercontent.com/-5ZvjS8chFIA/Uv9sXmTuIII/AAAAAAAAAew/RGs7edwFr4I/w300/IMG_20130622_113435.jpg" alt="img" /></p>

<p><sub>* 斯福尔扎城堡和米开朗基罗未完成的雕塑</sub></p>

<p>博物馆后面是一个大公园，有点像伦敦的海德公园，很多家长带着小朋友在这里玩耍嬉戏。在公园悠闲地度过了一个下午，再次回到米兰的购物大街。街道两旁挂着米兰世博会的宣传和各国旗帜，无论是奢侈店还是平价店都是人潮涌动。</p>

<p><img src="https://lh5.googleusercontent.com/-GXP_PBDBduM/Uv9sZbzHo0I/AAAAAAAAAfA/-suXL55BZfQ/w300/IMG_20130622_144257.jpg" alt="img" /></p>

<p><sub>* 米兰世博会</sub></p>

<p>在米兰也会碰上些烦心事，就是有很多非洲人在街上强买强卖手链等饰品，即使你说不，他们也会跟着你一路纠缠。</p>

<p><img src="https://lh5.googleusercontent.com/-K0O8QKj7Mv4/Uv9sZwTVUCI/AAAAAAAAAe8/Xk2N32hr2GU/w300/IMG_20130622_200807.jpg" alt="img" /></p>

<p><sub>* Happy Hour</sub></p>

<p>回到旅舍，在一楼酒吧享受了Happy Hour提供的免费自助，意大利的最后一站米兰之旅就此画上了休止符。</p>

<p><sub>23/06/2013 初稿于米兰 10/2014 整理 </sub></p>

<p><sub>注: <a href="http://voice.lawrencesun.info/blog/categories/man-you-ji/">曼游记系列</a>: 本系列游记照片由谷哥四儿子联手谷哥相册友情提供 </sub></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[曼游记终极篇之欧洲行 Day 7]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/09/13/travel-europe-day-7/"/>
    <updated>2014-09-13T16:31:17+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/09/13/travel-europe-day-7</id>
    <content type="html"><![CDATA[<p>没能按计划早起，睡了个懒觉。由于昨天到威尼斯之后预订了去米兰的车次，为了防止来回旅馆错过列车，所以先直奔火车站存包，然后乘水上巴士出发去玻璃岛。</p>

<p>要去这个岛的游客非常多，等了好久也没挤上直航的公交3号，只好在几分钟之后坐上公交4.2号，慢慢悠悠地晃了40多分钟，终于抵达了玻璃岛。</p>

<p>当地人民多以制作玻璃为生，街道两旁几乎都是精美的玻璃制品店。</p>

<p>由于时间紧，转了一圈之后就直接去岛上另一个车站乘坐12路前往彩色岛，大约半个小时之后到达。彩色岛，顾名思义，这里的房子都是彩漆，一幢房子一个颜色，门帘也是彩色的，看起来非常温馨。</p>

<!-- more -->


<p><img src="https://lh4.googleusercontent.com/-1hdSzW-AgW4/Uv9r0vihrlI/AAAAAAAAAdw/yXAkNWVNM6o/w400" alt="img" /></p>

<p><sub>* 彩色岛</sub></p>

<p>在彩色岛点了盘海鲜饭，确实是夹生的，当初在曼城的某意大利餐馆第一次吃的时候还以为是没煮熟呢。</p>

<p><img src="https://lh4.googleusercontent.com/-rbN2rKEzM0w/Uv9rwLTNf6I/AAAAAAAAAdg/egg9xdMEJxA/w400" alt="img" /></p>

<p><sub>* 海鲜饭</sub></p>

<p>岛屿并不大，逛了一个小时以后就沿着来路返回主岛了。找了家酒吧，在下午关门之前吃了碗沙拉。吃完取来包裹，在车站稍等片刻，便乘坐火车前往下一站，米兰。</p>

<p><sub>21/06/2013 初稿于威尼斯 09/2014 整理 </sub></p>

<p><sub>注: <a href="http://voice.lawrencesun.info/blog/categories/man-you-ji/">曼游记系列</a>: 本系列游记照片由谷哥四儿子联手谷哥相册友情提供 </sub></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[曼游记终极篇之欧洲行 Day 6]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/08/22/travel-europe-day-6/"/>
    <updated>2014-08-22T15:04:49+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/08/22/travel-europe-day-6</id>
    <content type="html"><![CDATA[<p>早饭过后，我再次问房东确认“谢谢”怎么说，然后和他道别，对他说&#8221;Grazie!&ldquo;并付了小费。我对这个暂时的落脚处有了些许家的感觉。在颠簸的旅途中能有人每早向你问好并端来咖啡和牛角包，是一件非常幸福的事。离开佛罗伦萨后，我将继续北上。</p>

<p>在前往火车站的途中，我买了邮票，再次感叹意大利香烟店的无所不售。离火车发车时间还有一个小时，因为站内基本没有座位，我只好席地而坐，补完昨天的游记。不同于前几天的慢车，我在上车前发现之前reserse的高铁车票上是有座位号的。</p>

<p>列车以大约150公里/小时的速度一路向意大利的西北角奔去。两个小时后，我终于抵达了梦寐以求的威尼斯。这座水上之城举世闻名，游客络绎不绝。</p>

<p>因为贡多拉的价格昂贵，我选择了48小时的公交卡。但是我还是决定先走着去住处，先睹为快。事实证明，我这个决定，非常的&hellip; 失败。这里的小巷比之罗马，佛罗伦萨显得更加狭小，而且蜿蜒曲折，走几步就要过桥，有时还会走进死胡同。</p>

<!-- more -->


<p><img src="https://lh6.googleusercontent.com/-Az2GKwUcerI/Uv9q8hk7OdI/AAAAAAAAAb8/WpLLzQJ_Nks/w300/IMG_20130620_114319.jpg" alt="img" /></p>

<p><sub>* 小巷</sub></p>

<p>因为穿梭在游客罕至的区域，加上GPS在这个地方几乎失效，我在这个迷宫般的地方穿梭了一个多小时，几经周折后才走到了著名的Rialto桥，这座拱桥的中间和两侧都是商铺。随后由此找到了酒店。这家三星级的住所装修高档，交通便利(大多青年旅舍都在偏远处，甚至主岛之外)，我也为此下了不少血本，好在只住一宿。</p>

<p><img src="https://lh5.googleusercontent.com/-jM_DR56sfrM/Uv9q8khOL_I/AAAAAAAAAtU/1_IRBHvsQ5A/w300/IMG_20130620_111819.jpg" alt="img" /></p>

<p><img src="https://lh3.googleusercontent.com/-xiz6DH_VetI/Uv9rIzvCgJI/AAAAAAAAAcQ/jVKDVwqgJb4/w400/IMG_20130620_142248.jpg" alt="img" /></p>

<p><sub>* 贡多拉</sub></p>

<p>放下东西，乘坐公交&hellip;船，沿着主干河流，一路游览。先是参观了学院博物馆，里面陈列着各个时期文人墨客在此留下的佳作。接着继续坐船来到了圣马可广场，这里是威尼斯最为热闹的地方。广场三面都是宫殿般的建筑，东面则是圣马可大教堂和总督府。</p>

<p><img src="https://lh4.googleusercontent.com/-NVN0ZCR9dQ8/Uv9rQOc2FoI/AAAAAAAAAcg/o_inVUko9bM/w400/IMG_20130620_142305.jpg" alt="img" /></p>

<p><sub>* 总督府</sub></p>

<p>在这里拍照时，还碰到一对来自印度的夫妇，我们互相帮忙拍了照片，他们还执意要和我合影。然后参观了保存完好的总督府，里面有罗马式的高墙，还有会议大厅。从总督府的一侧沿着叹息桥就可以通向威尼斯的黑暗监狱。一侧的圣马可大教堂则是威尼斯的标志，它结合了不少建筑形式，这也符合威尼斯这个水上贸易城市的风格。</p>

<p><img src="https://lh5.googleusercontent.com/-GbRAUkajcXU/Uv9rexq11sI/AAAAAAAAAdA/SiGsNzC2B_M/w300/IMG_20130620_175917.jpg" alt="img" /></p>

<p><sub>* 叹息桥</sub></p>

<p>之后，我又乘坐另一趟水上公交线路，吹着海风来到了丽都岛。和主岛不同，这里的建筑更加现代，还有一个海滨沙滩，比较适合度假。匆匆走了一个来回，便乘船返回圣马可广场。</p>

<p><img src="https://lh3.googleusercontent.com/-JTICn6nIUsc/Uv9rRCWIC4I/AAAAAAAAAco/rZVZgDcSWUk/w300/IMG_20130620_161106.jpg" alt="img" /></p>

<p><sub>* 青口意面</sub></p>

<p>在附近吃了晚饭后，登上了广场上近百米的高塔，一览全城。此时已是傍晚时分，夕阳西下，余晖熠熠，海鸟飞翔。潮水已经将广场浸没，人们在水中嬉戏，还有一位红衣女子翩翩起舞，赢得众人驻足观赏。</p>

<p><img src="https://lh4.googleusercontent.com/-BIbetcX-EuA/Uv9rd_Yms0I/AAAAAAAAAc4/BvwG31WlqUs/w300/IMG_20130620_190957.jpg" alt="img" /></p>

<p><img src="https://lh4.googleusercontent.com/--Q-eZDcUzss/Uv9rnHtFUFI/AAAAAAAAAdQ/LzRxdzqbkg8/w300/IMG_20130620_191649.jpg" alt="img" /></p>

<p><sub>* 夕阳下的圣马可广场和教堂</sub></p>

<p>离开广场，在附近寻觅凤凰歌剧院，却只在夜幕下撇得一眼。周围的橱窗里展示着化妆舞会的饰品，它们将在来年的狂欢节上大放异彩。回到住处休息片刻后，又乘船北上。此时的潮水已将不少建筑的底层淹没，而夜色下的城市显得宁静安详，只有威尼斯赌场依然灯光闪烁。</p>

<p><img src="https://lh5.googleusercontent.com/-nbZ7CiLLDbY/Uv9rnk2frCI/AAAAAAAAAdY/RFg4eWd_K38/w400/IMG_20130620_200134.jpg" alt="img" /></p>

<p><img src="https://lh4.googleusercontent.com/-2jtIPlGzCIg/Uv9rnhrbrYI/AAAAAAAAAdU/UOwqAkpJu-k/w300/IMG_20130620_204050.jpg" alt="img" /></p>

<p><sub>* 夜色下的威尼斯</sub></p>

<p><sub>21/06/2013 初稿于威尼斯 08/2014 这天开始的记录，简单而零碎，整理难度系数飙升 </sub></p>

<p><sub>注: <a href="http://voice.lawrencesun.info/blog/categories/man-you-ji/">曼游记系列</a>: 本系列游记照片由谷哥四儿子联手谷哥相册友情提供，高清无码图视情况在完成后补充. </sub></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[如何免费搭建WordPress博客并连接微信公众账号]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/08/19/how-to-build-wp-blog-and-connect-weixin/"/>
    <updated>2014-08-19T23:31:08+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/08/19/how-to-build-wp-blog-and-connect-weixin</id>
    <content type="html"><![CDATA[<p>WordPress由于便捷的安装，丰富的插件，一直受到广大站长的喜爱。我的第一个独立博客也是用WordPress搭建，尽管后来改用Octopress平台了。</p>

<p>微信公众平台的影响力日益扩大，作为尝试，我也申请了一个账号(插播广告：欢迎扫描屏幕下方二维码关注本账号&hellip;只要998&hellip;)。</p>

<p>同时作为一个爱折腾的人，自然要开启微信的开发者模式。作为没有验证的订阅号，开发者暂时只能做一些信息接收和回复操作。</p>

<p>即使开发的权限不多，但是结合WordPress博客后也可以实现不少功能，比如发送&#8221;最新&#8221;，返回博客的最新文章等等。当然首先，你得有个博客。</p>

<!--more-->


<p><a href="http://sae.sina.com.cn/">SAE</a>是新浪提供的云计算服务，支持PHP和JAVA，而且资费相比阿里云什么的要便宜很多，用来搭建WordPress非常合适。</p>

<p>现在注册并且实名认证还送2500左右的云豆，对于数据库小、流量低的站点来说，可以免费用上个大半年。</p>

<p>下面讲讲大致流程。</p>

<p><strong>SAE WordPress 安装</strong></p>

<p>注册SAE之后，如果有建立WordPress站点的经验可以手动安装。或者和我一样选择easy模式，选择“导入应用”，将最新的<a href="wp4cloud.sinaapp.com">安装包</a>链接填到基于URL安装，然后填写应用名称等进行安装。</p>

<p>接下来就是进入你设定的地址xxx.sinaapp.com进行管理员注册等。</p>

<p>嗯，有默认的markdown插件真幸福。</p>

<p><strong>安装主题或插件</strong></p>

<p>SAE不支持直接搜索安装主题和插件，只能通过SVN(我靠，这又是啥&hellip;)来进行上传。SVN的使用方法请看SAE<a href="http://sae.sina.com.cn/doc/tutorial/helloworld.html">官方文档</a>&hellip;</p>

<p>从WP官网或其他途径下载主题或插件，放在本地的wp-content/themes or plugins的文件夹里，然后svn add &amp; commit提交到服务器。接着就可以进入WP后台安装了。</p>

<p><strong>博客优化</strong></p>

<p>主要是速度方面的。我暂时对以下两个方面进行了优化。</p>

<ul>
<li>gzip</li>
</ul>


<p>对页面进行压缩。进入SAE应用管理，在AppConfig里选择页面压缩，把所有的文件类型都添加进去。使用站长工具进行检测，运用后大约压缩了50%.</p>

<ul>
<li>fonts</li>
</ul>


<p>由于众所周知的原因，国内访问不了谷歌，然后包括WP在内的绝大多数平台或框架都采用了谷歌的公共库和字库，这会导致严重延时。好在360提供了<a href="libs.useso.com">镜像</a>以方便国内开发者使用。</p>

<p>需要更新的文件有：</p>

<ol>
<li>wp-includes/script-loader.php</li>
<li>wp-includes/js/tinymce/themes/advanced/skins/wp_theme/dialog.css</li>
<li>wp-content/themes/你的主题名/functions.php</li>
</ol>


<p>使用编辑器将上述文件中的‘googleapis.com’全部替换成‘useso.com’。</p>

<p><strong>连接微信接口</strong></p>

<p>我最初采用的方式是创立一个新的应用，用来接收和返回微信信息，同时通过链接的方式引导到博客。但是因为我是只能勉强写&#8221;Hello World&#8221;的小白，PHP这货基本不懂，只能套用简单的SDK进行修改。</p>

<p>后来我选择放弃建造轮子，倚靠前人的肩膀，怒装<a href="http://www.houqun.me/bbs/forum.php?gid=1">weixinpress</a>插件&hellip; 安装之后在WP后台可以轻松添加修改自定义回复。</p>

<p>然后微信的URL填写&#8217;xxx.sinaapp.com/?weixin&#8217;，设置token一致，就OK了。</p>

<p>接下来如有时间，我会考虑小打小闹，在此基础上添加些其他的功能。小黄鸡，神经猫什么的就算了吧&hellip;</p>

<p>欢迎关注下方微信公众账号进行测试或交流：</p>

<p><img src="http://cyztalk-wordpress.stor.sinaapp.com/uploads/2014/08/qrcode-150x150.jpg" alt="img" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: Remember Me and Reset Password]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/08/12/rails-notes-remember-me-and-reset-password/"/>
    <updated>2014-08-12T16:14:58+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/08/12/rails-notes-remember-me-and-reset-password</id>
    <content type="html"><![CDATA[<p><strong>1. Remember Me</strong></p>

<p>We used sessions to store user&rsquo;s id in order to let them sign in just once. However, when users close browser, the session cookie is deleted. So we would like to replace it with a permanent one. Besides, if we store and expose user&rsquo;s id, it could be dangerous.</p>

<p>Therefore, we will generate and store a unique token for each user. First, create a new column to store the token.</p>

<!-- more -->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rails g migration add_remember_token_to_users remember_token:string
</span><span class='line'>$ rake db:migrate</span></code></pre></td></tr></table></div></figure>


<p>Then write a method to generate remember_token before creating a new user in models/user.rb</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="n">before_create</span> <span class="p">{</span> <span class="n">generate_token</span><span class="p">(</span><span class="ss">:remember_token</span><span class="p">)}</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="k">def</span> <span class="nf">generate_token</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
</span><span class='line'>  <span class="k">begin</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">[</span><span class="n">column</span><span class="o">]</span> <span class="o">=</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">urlsafe_base64</span>
</span><span class='line'>  <span class="k">end</span> <span class="k">while</span> <span class="no">User</span><span class="o">.</span><span class="n">exists?</span><span class="p">(</span><span class="n">column</span> <span class="o">=&gt;</span> <span class="nb">self</span><span class="o">[</span><span class="n">column</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Add a checkbox in views/sessions/new.html.erb for user to let them choose if they want us to remember.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;checkbox&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;label&gt;</span>
</span><span class='line'>      <span class="err">&lt;</span>%= check_box_tag :remember_me, 1, params[:remember_me] %&gt;
</span><span class='line'>      <span class="err">&lt;</span>%= t(&#39;remember me&#39;) %&gt;
</span><span class='line'>  <span class="nt">&lt;/label&gt;&lt;br&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Modify the SessionsController so that we store remember_token in cookies when user signed in.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">create</span>
</span><span class='line'>  <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by_username</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:username</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">user</span> <span class="o">&amp;&amp;</span> <span class="n">user</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:password</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:remember_me</span><span class="o">]</span>
</span><span class='line'>          <span class="n">cookies</span><span class="o">.</span><span class="n">permanent</span><span class="o">[</span><span class="ss">:remember_token</span><span class="o">]</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">remember_token</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>          <span class="n">cookies</span><span class="o">[</span><span class="ss">:remember_token</span><span class="o">]</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">remember_token</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>      <span class="n">flash</span><span class="o">[</span><span class="ss">:success</span><span class="o">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">(</span><span class="s1">&#39;flash.session.create.success&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, </span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:username</span><span class="o">]</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span class='line'>      <span class="n">redirect_to</span> <span class="n">root_path</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>      <span class="n">flash</span><span class="o">.</span><span class="n">now</span><span class="o">[</span><span class="ss">:error</span><span class="o">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">(</span><span class="s1">&#39;flash.session.create.error&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">render</span> <span class="s1">&#39;new&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Modify the current_user method in application.rb so it reads the remember_token from cookies rather than the user.id from the session.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">current_user</span>
</span><span class='line'>  <span class="vi">@current_user</span> <span class="o">||=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by_remember_token</span><span class="p">(</span><span class="n">cookies</span><span class="o">[</span><span class="ss">:remember_token</span><span class="o">]</span><span class="p">)</span> <span class="k">if</span> <span class="n">cookies</span><span class="o">[</span><span class="ss">:remember_token</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally, we want to fill the remember_token column for existing users. Write a file called rebuild_remember_token.rake in lib/tasks and run <code>rake user:rebuild_remember_token</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">namespace</span> <span class="ss">:user</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">desc</span> <span class="s2">&quot;Rebuild Remember-Tokens&quot;</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:rebuild_remember_token</span> <span class="o">=&gt;</span> <span class="ss">:environment</span> <span class="k">do</span>
</span><span class='line'>    <span class="no">User</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span>
</span><span class='line'>      <span class="no">User</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">u</span><span class="o">|</span>
</span><span class='line'>        <span class="n">u</span><span class="o">.</span><span class="n">update_attribute</span> <span class="ss">:remember_token</span><span class="p">,</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">urlsafe_base64</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>2. Password Reset</strong></p>

<p>We would like to allow users to reset their password when they forget. First, we will generate the route: <code>resources :password_resets</code>.</p>

<p>Then add a link in the signin page(views/sessions/new.html.erb).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;checkbox&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">label</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="sx">%= check_box_tag :remember_me, 1, params[:remember_me] %&gt;</span>
</span><span class='line'><span class="sx">     &lt;%=</span> <span class="n">t</span><span class="p">(</span><span class="s1">&#39;.remember_me&#39;</span><span class="p">)</span> <span class="sx">%&gt; | &lt;%= link_to t(&#39;.forgotten_password&#39;), new_password_reset_path %&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="sr">/label&gt;&lt;br/</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Create a password_resets_controller.rb file and a new.html.erb file in views/password_resets.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">PasswordResetsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">def</span> <span class="nf">new</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">create</span>
</span><span class='line'>      <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by_email</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:email</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>      <span class="k">if</span> <span class="vi">@user</span>
</span><span class='line'>          <span class="vi">@user</span><span class="o">.</span><span class="n">send_password_reset</span>
</span><span class='line'>          <span class="n">flash</span><span class="o">[</span><span class="ss">:success</span><span class="o">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">(</span><span class="s1">&#39;flash.reset.email.success&#39;</span><span class="p">)</span>
</span><span class='line'>          <span class="n">redirect_to</span> <span class="n">root_path</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>          <span class="n">flash</span><span class="o">.</span><span class="n">now</span><span class="o">[</span><span class="ss">:error</span><span class="o">]</span> <span class="o">=</span>  <span class="n">t</span><span class="p">(</span><span class="s1">&#39;flash.reset.email.error&#39;</span><span class="p">)</span>
</span><span class='line'>          <span class="n">render</span> <span class="s1">&#39;new&#39;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-6 col-md-offset-3&quot;</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;well&quot;</span><span class="o">&gt;</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;&lt;</span><span class="sx">%= t(&#39;.password_reset&#39;) %&gt;&lt;/h4&gt;</span>
</span><span class='line'><span class="sx">         &lt;hr/&gt;</span>
</span><span class='line'><span class="sx">         &lt;%=</span> <span class="n">form_tag</span> <span class="n">password_resets_path</span><span class="p">,</span> <span class="nb">method</span><span class="p">:</span> <span class="s1">&#39;post&#39;</span> <span class="k">do</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">         &lt;div class=&quot;form-group&quot;&gt;</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="sx">%= label_tag :email %&gt;&lt;br/&gt;</span>
</span><span class='line'><span class="sx">         &lt;%=</span> <span class="n">text_field_tag</span> <span class="ss">:email</span><span class="p">,</span> <span class="n">params</span><span class="o">[</span><span class="ss">:email</span><span class="o">]</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;form-control&quot;</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">         &lt;/div&gt;</span>
</span><span class='line'>          <span class="o">&lt;%=</span> <span class="n">submit_tag</span> <span class="n">t</span><span class="p">(</span><span class="s1">&#39;.password_reset&#39;</span><span class="p">),</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;btn btn-primary&quot;</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">         &lt;% end %&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="sr">/div&gt;</span>
</span><span class='line'><span class="sr"> &lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then we will add columns to store the a token for the reset request and the expire time of it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">rails</span> <span class="n">g</span> <span class="n">migration</span> <span class="n">add_password_reset_to_users</span> <span class="n">password_reset_token</span><span class="ss">:string</span> <span class="n">password_reset_sent_at</span><span class="ss">:datetime</span>
</span></code></pre></td></tr></table></div></figure>


<p>When the user is found by the email, we will generate a token and send a reset email using send_password_reset method in /models/user.rb</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">send_password_reset</span>
</span><span class='line'>  <span class="nb">self</span><span class="o">.</span><span class="n">update_column</span><span class="p">(</span><span class="ss">:password_reset_token</span><span class="p">,</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">urlsafe_base64</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">self</span><span class="o">.</span><span class="n">update_column</span><span class="p">(</span><span class="ss">:password_reset_sent_at</span><span class="p">,</span> <span class="no">Time</span><span class="o">.</span><span class="n">zone</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
</span><span class='line'>  <span class="no">UserMailer</span><span class="o">.</span><span class="n">password_reset</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">.</span><span class="n">deliver</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Create the UserMailer and email template in /views/user_mailer/password_reset_text.erb</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">rails</span> <span class="n">g</span> <span class="n">mailer</span> <span class="n">user_mailer</span> <span class="n">password_reset</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">UserMailer</span> <span class="o">&lt;</span> <span class="ss">ActionMailer</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">default</span> <span class="ss">from</span><span class="p">:</span> <span class="s2">&quot;from@example.com&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">password_reset</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@user</span> <span class="o">=</span> <span class="n">user</span>
</span><span class='line'>    <span class="n">mail</span> <span class="ss">to</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="ss">subject</span><span class="p">:</span> <span class="s2">&quot;Password Reset&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">To</span> <span class="n">reset</span> <span class="n">your</span> <span class="n">password</span> <span class="n">click</span> <span class="n">the</span> <span class="no">URL</span> <span class="n">below</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;%=</span> <span class="n">edit_password_reset_url</span><span class="p">(</span><span class="vi">@user</span><span class="o">.</span><span class="n">password_reset_token</span><span class="p">)</span> <span class="o">%&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="no">If</span> <span class="n">you</span> <span class="n">did</span> <span class="ow">not</span> <span class="n">request</span> <span class="n">your</span> <span class="n">password</span> <span class="n">to</span> <span class="n">be</span> <span class="n">reset</span> <span class="n">please</span> <span class="n">ignore</span> <span class="n">this</span> <span class="n">email</span> <span class="ow">and</span> <span class="n">your</span> <span class="n">password</span> <span class="n">will</span> <span class="n">stay</span> <span class="n">as</span> <span class="n">it</span> <span class="n">is</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>We will need to alter enviroment configuration in /config/environment/development.rb to get URLs working. Similar line in production.rb with the live domain name.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Auth</span><span class="p">:</span><span class="ss">:Application</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">action_mailer</span><span class="o">.</span><span class="n">default_url_options</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:host</span> <span class="o">=&gt;</span> <span class="s2">&quot;localhost:3000&quot;</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The URL includes the token as the id parameter, which we will use it in edit action. Create a form for users to reset password in edit.html.erb</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">edit</span>
</span><span class='line'>  <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by_password_reset_token!</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;&lt;</span><span class="sx">%= t(&#39;.password_reset&#39;) %&gt;&lt;/h4&gt;&lt;hr/&gt;</span>
</span><span class='line'><span class="sx">&lt;%=</span> <span class="n">render</span> <span class="s1">&#39;shared/error&#39;</span><span class="p">,</span> <span class="ss">object</span><span class="p">:</span> <span class="vi">@user</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">&lt;%= form_for @user, url: password_reset_path(params[:id]) do |f| %&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-group&quot;</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="sx">%= f.label :password, t(&#39;password&#39;) %&gt;</span>
</span><span class='line'><span class="sx">     &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">password_field</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span><span class="s2">&quot;form-control&quot;</span><span class="p">,</span> <span class="ss">placeholder</span><span class="p">:</span> <span class="s2">&quot;At least 6 digits&quot;</span><span class="sx">%&gt;</span>
</span><span class='line'><span class="sx"> &lt;/div&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-group&quot;</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="sx">%= f.label :password_confirmation, t(&#39;password_confirmation&#39;) %&gt;</span>
</span><span class='line'><span class="sx">     &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">password_field</span> <span class="ss">:password_confirmation</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span><span class="s2">&quot;form-control&quot;</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx"> &lt;/div&gt;</span>
</span><span class='line'>  <span class="o">&lt;%=</span> <span class="n">submit_tag</span> <span class="n">t</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">),</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">&quot;btn btn-primary&quot;</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">&lt;% end %&gt;</span>   
</span></code></pre></td></tr></table></div></figure>


<p>Here we use form_for in this form as we’re modifying a resource. Because of this we have to explicitly set the :url parameter so that the form isn’t POSTed to the UsersController. Instead it is sent to the PasswordResetsController’s update action, passing in the reset token as the id.</p>

<p>Finally, we will write the update action.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">update</span>
</span><span class='line'>  <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by_password_reset_token!</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">if</span> <span class="vi">@user</span><span class="o">.</span><span class="n">password_reset_sent_at</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">.</span><span class="n">hours</span><span class="o">.</span><span class="n">ago</span>
</span><span class='line'>      <span class="n">flash</span><span class="o">[</span><span class="ss">:error</span><span class="o">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">(</span><span class="s1">&#39;flash.reset.error&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">redirect_to</span> <span class="n">new_password_reset_path</span>
</span><span class='line'>  <span class="k">elsif</span> <span class="vi">@user</span><span class="o">.</span><span class="n">update_attributes</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">permit!</span><span class="o">[</span><span class="ss">:user</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>      <span class="vi">@user</span><span class="o">.</span><span class="n">update_attribute</span><span class="p">(</span><span class="ss">:password_reset_token</span><span class="p">,</span> <span class="kp">nil</span><span class="p">)</span>
</span><span class='line'>      <span class="n">flash</span><span class="o">[</span><span class="ss">:success</span><span class="o">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">(</span><span class="s1">&#39;flash.reset.success&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">redirect_to</span> <span class="n">signin_path</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="n">render</span> <span class="s1">&#39;edit&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><sub>Reference: <a href="http://railscasts.com/episodes/274-remember-me-reset-password?view=asciicast">Railscasts</a></sub></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: How to 'Like' once and 'Unlike' in Rails]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/08/03/rails-notes-unlike-function/"/>
    <updated>2014-08-03T21:35:00+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/08/03/rails-notes-unlike-function</id>
    <content type="html"><![CDATA[<p>Few months ago, I added a <a href="http://voice.lawrencesun.info/posts/2014/02/11/rails-notes-adding-a-like-function/">&lsquo;Like&rsquo; function</a> to my rails project. It&rsquo;s a lovely function, but has some problems left. One is that users could like a single post/comment as much as they can, the other one is that users are not able to unlike.</p>

<p>Thus, I tried to improve the likeable function this weekend. First thing I came up with my head was to add a uniqueness validation.</p>

<!-- more -->


<p>Here is the code I added in <code>like.rb</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">validates_uniqueness_of</span> <span class="ss">:user_id</span><span class="p">,</span> <span class="ss">scope</span><span class="p">:</span> <span class="o">[</span><span class="ss">:likeable_id</span><span class="p">,</span> <span class="ss">:likeable_type</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>It worked. &lsquo;User&rsquo; could not cheat any more, well, up to a point. But if users want to their mind later on, they are not allowed to do so.</p>

<p>Regarding the second issue, I decided to handle it this way.</p>

<p>Let&rsquo;s assume there is a user called Mr.R. R liked a post, the params[:like] set to true. We would like to provide a link so that R could send another POST with the params[:like] = false. If R haven&rsquo;t make the choice or unliked it before, then a link to POST with the params[:like] = true is available.</p>

<p>First of all, I changed the like method in <code>posts_controller</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">like</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">post_liked</span>
</span><span class='line'>      <span class="vi">@like</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="ss">like</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:like</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>      <span class="no">Like</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">likeable</span><span class="p">:</span> <span class="vi">@post</span><span class="p">,</span> <span class="ss">user</span><span class="p">:</span> <span class="n">current_user</span><span class="p">,</span> <span class="ss">like</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:like</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">format</span><span class="o">.</span><span class="n">html</span> <span class="k">do</span>
</span><span class='line'>          <span class="n">flash</span><span class="o">[</span><span class="ss">:success</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;Like Updated!&quot;</span>
</span><span class='line'>          <span class="n">redirect_to</span> <span class="ss">:back</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>      <span class="nb">format</span><span class="o">.</span><span class="n">js</span>
</span><span class='line'>  <span class="k">end</span>  
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="kp">private</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">post_liked</span>
</span><span class='line'>  <span class="n">liked?</span><span class="p">(</span><span class="vi">@post</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here, if R has already liked/unliked the post, and then changed his mind, we would update the <code>like</code> attribute rather than creating another data.</p>

<p>There are two methods in <code>application_controller</code>, which are available to views and posts/comments controllers.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">liked?</span><span class="p">(</span><span class="n">type</span><span class="p">)</span>
</span><span class='line'>  <span class="vi">@like</span> <span class="o">=</span> <span class="no">Like</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">likeable</span><span class="p">:</span> <span class="n">type</span><span class="p">,</span> <span class="ss">user</span><span class="p">:</span> <span class="n">current_user</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">liked</span><span class="p">(</span><span class="n">type</span><span class="p">)</span>
</span><span class='line'>  <span class="vi">@like</span> <span class="o">=</span> <span class="no">Like</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">likeable</span><span class="p">:</span> <span class="n">type</span><span class="p">,</span> <span class="ss">user</span><span class="p">:</span> <span class="n">current_user</span><span class="p">)</span>
</span><span class='line'>  <span class="k">if</span> <span class="vi">@like</span>
</span><span class='line'>    <span class="k">return</span> <span class="vi">@like</span><span class="o">.</span><span class="n">like</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="k">return</span> <span class="kp">false</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then I adjusted <code>show.html.erb</code>in the view. As discussed before, I provided the oppsite like/unlike button to users&#8217; former dicision.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">span</span> <span class="nb">id</span><span class="o">=</span> <span class="s2">&quot;post_like&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;pull-right&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="sx">% if </span><span class="n">signed_in?</span> <span class="o">&amp;&amp;</span> <span class="n">liked</span><span class="p">(</span><span class="vi">@post</span><span class="p">)</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">         &lt;%= link_to like_post_path(@post, like: false), method: &#39;post&#39;, remote: true do %&gt;</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="n">span</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;user_like_&lt;%= @post.id %&gt;&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;like&quot;</span><span class="o">&gt;&lt;</span><span class="n">i</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;fa fa-thumbs-o-up&quot;</span><span class="o">&gt;&lt;</span><span class="sr">/i&gt;&lt;/s</span><span class="n">pan</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="sx">% end %&gt; </span>
</span><span class='line'><span class="sx">     &lt;% else %&gt;</span>             
</span><span class='line'>      <span class="o">&lt;</span><span class="sx">%= link_to like_post_path(@post, like: true), method: &#39;post&#39;, remote: true do %&gt;</span>
</span><span class='line'><span class="sx">         &lt;span id=</span><span class="s2">&quot;user_like_&lt;%= @post.id %&gt;&quot;</span><span class="o">&gt;&lt;</span><span class="n">i</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;fa fa-thumbs-o-up&quot;</span><span class="o">&gt;&lt;</span><span class="sr">/i&gt;&lt;/s</span><span class="n">pan</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="sx">% end %&gt;</span>
</span><span class='line'><span class="sx">     &lt;% end %&gt;</span>
</span><span class='line'> <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'> <span class="o">&lt;</span><span class="sr">/span&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Finally, I changed the <code>like.js.erb</code> file in order to present the difference between like and unlike, as well as the user&rsquo;s new dicision.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">% if </span><span class="n">liked</span><span class="p">(</span><span class="vi">@post</span><span class="p">)</span><span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">     $(&quot;#user_like_&lt;%= @post.id %&gt;</span><span class="s2">&quot;).addClass(&quot;</span><span class="n">like</span><span class="s2">&quot;);</span>
</span><span class='line'><span class="s2">&lt;% else %&gt;</span>
</span><span class='line'><span class="s2">     $(&quot;</span><span class="c1">#user_like_&lt;%= @post.id %&gt;&quot;).removeClass(&quot;like&quot;);</span>
</span><span class='line'><span class="o">&lt;</span><span class="sx">% end %&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sx">$(&quot;#post_like&quot;).load(&quot;&lt;%= @post.id %&gt;</span> <span class="c1">#post_like&quot;)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The comments like/unlike function is similar.</p>

<p>This improvement killed me a lot time this weekend, but thankfully, it worked at last. However, there must be a much easier &amp; clean way to do it.</p>

<p>By the way, I had updated my app to bootstrap 3.2, a more resposive-friendly version. It was an nightmare to change the style, like css class/id name etc. I also used fontawesome icons instead of the old ones. The app looks just fine.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ruby程序:自动抓取股票财务数据]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/07/18/stock-data-crawler/"/>
    <updated>2014-07-18T21:03:55+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/07/18/stock-data-crawler</id>
    <content type="html"><![CDATA[<p>无论是投资还是投机股市，股票的财务状况仍然是不可或缺的参考指标。传统金融网站上的数据往往以个股为单位呈现，导致数据的查询、对比和分析比较困难。如果要进行全局扫描和分析，可能就需要把这些数据一个一个下载后进行处理，这方面的时间成本略高。</p>

<p>前段时间在雪球偶然看到有人用Python做了一个自动获取数据的程序，觉得挺有趣，对大量数据的计算和分析可能有用，所以用了一天左右的时间用Ruby写了一个类似的代码。</p>

<!-- more -->


<p>数据来源于网易财经，理论上可以实现所有股票的任意财务数据的抓取，并导入csv文件。例如所有股票的”速动比率“（尽管不懂&hellip;），如下图所示。</p>

<p><img src="https://lh6.googleusercontent.com/-kE3w3S0vS_0/U8pK6OB_l0I/AAAAAAAAAsw/cAY1SvsE8mg/w400-h360-no/data.png" alt="img" /></p>

<p>核心代码如下:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># 检测网页是否存在</span>
</span><span class='line'><span class="k">def</span> <span class="nf">valid_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span class='line'>  <span class="n">url</span> <span class="o">=</span> <span class="no">URI</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span class='line'>  <span class="n">req</span> <span class="o">=</span> <span class="ss">Net</span><span class="p">:</span><span class="ss">:HTTP</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">url</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
</span><span class='line'>  <span class="n">res</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">request_head</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="kp">true</span> <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="s1">&#39;200&#39;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 抓取数据extract_data</span>
</span><span class='line'><span class="k">def</span> <span class="nf">extract_data</span><span class="p">(</span><span class="n">stock_num</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span><span class='line'>  <span class="c1"># 数据来源为网易股票频道，按报告期的主要财务指标，默认显示为6个季度</span>
</span><span class='line'>  <span class="n">source</span> <span class="o">=</span> <span class="ss">Nokogiri</span><span class="p">:</span><span class="ss">:HTML</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
</span><span class='line'>  <span class="c1"># 获取股票名称</span>
</span><span class='line'>  <span class="n">name_table</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;//h1[@class=&#39;name&#39;]//a&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">name</span> <span class="o">=</span> <span class="n">name_table</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="n">text</span>
</span><span class='line'>  <span class="c1"># 搜寻所有属于指定css class的值，返回的是一个Array</span>
</span><span class='line'>  <span class="n">data_table</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;//table[@class=&#39;table_bg001 border_box fund_analys&#39;]//td&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="c1"># 查找Array中含有指定文字描述的元素，并返回元素的地址</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># 上一步查找到的元素地址后面的六个元素含有所需数据，将其中的数字部分提取出来</span>
</span><span class='line'>  <span class="c1"># 并加入到一个新建的Array中去</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># 返回数据</span>
</span><span class='line'>  <span class="n">s</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>目前的主要问题是运行速度较慢，以后有时间看看能否改进。不管如何，在此数据的基础上做一些计算、对比和分析应该容易不少。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[如何合并多个Git commit]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/07/15/squash-git-commits/"/>
    <updated>2014-07-15T22:06:07+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/07/15/squash-git-commits</id>
    <content type="html"><![CDATA[<p>今天把之前做的一个rails项目升级到Twitter Bootstrap 3.2，结果问题一大堆。主要是class和id名称的改动，以及响应式布局的调整。最后在Heroku部署完成之后，发现原来的“点赞”图标无法正确显示，在stackoverflow翻阅了很多相关问答，和我有同样问题的人不少。但是按照这些方法去尝试，没有一个能有效解决。最终我改用了fonts awesome。</p>

<p>在这个期间，遇到了不少git方面的问题，看来之前还是没有把基础打好。</p>

<p>一个问题是由于不断尝试不同的方法，导致commit过多，非常混乱。于是想把多个commit合并到一起。具体方法如下：</p>

<!-- more -->


<p>首先<code>git log</code>查看目前的commit, 假设按照时间先后顺序有 a, b, c, d 三个commit.</p>

<p>现在要把四个合并到一起，使用<code>rebase</code>这个命令。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">git</span> <span class="n">rebase</span> <span class="o">-</span><span class="n">i</span> <span class="no">HEAD</span><span class="o">~</span><span class="mi">4</span>
</span><span class='line'>
</span><span class='line'><span class="n">pick</span> <span class="mo">01</span><span class="n">d1124</span> <span class="n">a</span>
</span><span class='line'><span class="n">pick</span> <span class="mi">6340</span><span class="n">aaa</span> <span class="n">b</span>
</span><span class='line'><span class="n">pick</span> <span class="n">ebfd367</span> <span class="n">c</span>
</span><span class='line'><span class="n">pick</span> <span class="mi">30</span><span class="n">e0ccb</span> <span class="n">d</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Rebase 60709da..30e0ccb onto 60709da</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># Commands:</span>
</span><span class='line'><span class="c1">#  p, pick = use commit</span>
</span><span class='line'><span class="c1">#  e, edit = use commit, but stop for amending</span>
</span><span class='line'><span class="c1">#  s, squash = use commit, but meld into previous commit</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># If you remove a line here THAT COMMIT WILL BE LOST.</span>
</span><span class='line'><span class="c1"># However, if you remove everything, the rebase will be aborted.</span>
</span><span class='line'><span class="c1">#</span>
</span></code></pre></td></tr></table></div></figure>


<p>接着，把前四行进行如下替换：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">pick</span> <span class="mo">01</span><span class="n">d1124</span> <span class="n">a</span>
</span><span class='line'><span class="n">squash</span> <span class="mi">6340</span><span class="n">aaa</span> <span class="n">b</span>
</span><span class='line'><span class="n">squash</span> <span class="n">ebfd367</span> <span class="n">c</span>
</span><span class='line'><span class="n">squash</span> <span class="mi">30</span><span class="n">e0ccb</span> <span class="n">d</span>
</span></code></pre></td></tr></table></div></figure>


<p>Git将会把所有四个commit合并到第一个里面去。保存退出后，会出现：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># This is a combination of 4 commits.</span>
</span><span class='line'><span class="c1"># The first commit&#39;s message is:</span>
</span><span class='line'><span class="n">a</span>
</span><span class='line'><span class="c1"># This is the 2nd commit message:</span>
</span><span class='line'><span class="n">b</span>
</span><span class='line'><span class="c1"># This is the 3rd commit message:</span>
</span><span class='line'><span class="n">c</span>
</span><span class='line'><span class="c1"># This is the 4th commit message:</span>
</span><span class='line'><span class="n">d</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>修改新的commit message后再次保存退出，合并完成。</p>

<p>如果在过程中出现冲突，可以使用<code>git rebase --abort</code>命令。</p>

<p>第二个问题是我在git push时候出现 &lsquo;Everything is up to date&#8217;。通过<code>git branch</code>查询发现当前的branch是* (no branch).</p>

<p>出现这种情况，首先<code>git reflog</code>， 找到最新的一个commit，然后创建一个临时branch.</p>

<p><code>git checkout -b temp-branch &lt;commit-id&gt;</code> 之后合并到master。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[曼游记终极篇之欧洲行 Day 5]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/07/11/travel-europe-day-5/"/>
    <updated>2014-07-11T21:00:46+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/07/11/travel-europe-day-5</id>
    <content type="html"><![CDATA[<p>昨晚查看了荷包，严重大出血，才玩了四天就把3/4的现金花完了，这是要流浪街头的节奏啊。接下来的旅程只有勒紧裤腰带了。</p>

<p>吃完早饭就先奔向位于佛罗伦萨东面的学院美术馆，又要参与一天一度的排队活动了。预定和不预定在这家馆差别不大，除非参加当地旅行社的skip the line. 好像英国很少有这种免排队的，可能是英国人都习惯并享受排队吧。</p>

<p>在排队途中看到美术馆外墙的各种涂鸦。有一句话很有意思: Stop planning. Get lost. Miss the train. And start the adventure. 的确如此，多年后回想以前的旅行，印象深刻的往往不是看过的风景，而是遇见的人和碰到的事，比如睡绿皮车，露宿广场，和陌生人一起吃饭看电影&hellip; 此次旅程至今短短几天，情况百出，注定会让人难忘。</p>

<!-- more -->


<p>队伍中有很多外国旅行者，美国人居多，而且美女不少，这几天排队下来，口音都被拐到美音上去了。日本人也很多，当然自然也少不了中国大妈团。</p>

<p>又跑题了，其实这次排队持续时间并不长，半小时不到。馆内主要陈列了各种油画和雕塑，还有不少古老的乐器。最著名的自然是米开朗基罗的大卫。这件可以真货，市政广场放的是假冒品。不得不说，这种珍品理应放在博物馆里，这样人们才能静静地欣赏。这尊雕塑真的是美轮美奂，比例匀称，线条流畅，每一个细节都是那么的完美。这是我继观赏苏格兰国立画廊的油画之后再次被艺术感动地要落泪。另外还看了制作等比例放大雕塑和木板刻画的视频。原来那些木板画的原料是颜料加蛋清，再贴上金箔。</p>

<p>出来后参观了据说是欧洲第四大天主教堂的圣百花大教堂。完全对称的设计，黑白大理石的外表，教堂内部倒是比较一般。教堂的穹顶和边上的钟楼都可以登顶，但是这种费时费力费钱的活，在这种热天气里可吃不消。</p>

<p>出了教堂，准备去中央广场，走了半天又回到学院美术馆门口，再次证明我强悍的GPS系统到了意大利就失效了。在中央广场买了牛肚堡，味道是不错，就是热天吃着有点腻。</p>

<p><img src="https://lh5.googleusercontent.com/-pJfKauNdgDY/Uv9qkvJNBOI/AAAAAAAAAbE/RnzPE2GLQXU/w400/h300" alt="img" /></p>

<p><sub>* 牛肚堡 </sub></p>

<p>来到火车站，结果去锡耶纳的火车取消了，就顺便去reserve明天前往威尼斯的火车票。坐慢车的话会损失不少时间，所以还是决定坐快速的。慢车的好处就是通票直接上车免费坐，但是会遇到延误或取消。快车则需要去购票处reserve，给售票员看通票，然后说要make a reservation.意大利高速铁路二等座需要补10欧元。从佛罗伦萨到威尼斯原价大约是46欧，所以还是便宜了一点。</p>

<p>原以为可以顺利去锡耶纳了，结果坐上车不久，所有人都下车了，似乎又要延误。我也跟着下车了，这时候不少人去了边上去比萨的车，结果我没弄明白就开走了，还有一部分去了边上前往利沃诺的车，我就听到边上乘务员说change, 时不我待，来不及详细询问，就在开车前几秒上了车。比较有把握的是，昨天去比萨途中路过恩波利，看到有去锡耶纳的车次。上车后看到了路线图就更坚信了这点，不过貌似这是趟快车，好在还没人查票。我甚至后悔昨天没去，搞不好这次意大利之行就要错过这个小镇了。到了恩波利，看到去锡耶纳的车，以为就此圆满。结果过了点还没开车，乘务员又跑出来说了一大堆鸟语，大家又纷纷下车。刚好我前面有人问去锡耶纳，回答说去2站台。一看，擦，就是刚才那趟从佛罗伦萨出来的车，整整晚点40多分钟。</p>

<p>在车上小憩，一个小时后终于抵达锡耶纳。一出车站就茫然了，空旷的一个广场，没什么人，也没有游客中心。走到对面，是一个大商场，有一家超市。这可是我最近几天第一次看到大超市，可乐只要99p，比佛罗伦萨便宜了1/3，果断入手一瓶。接着根据bus station的标志走，走了一段看到指向反方向的标志&hellip;回到超市门口，有一个自动扶梯，难道这就是传说中通往锡耶纳城的光明阶梯？这个扶梯连绵不绝，大约5分钟后看到出口。走出来是一条马路，什么标志也没有，周围几个也都是迷茫的游客。手机上下载的穷游和triposo地图太简略基本没用，想在自动货卖机买张地图，但是没有零钱。只好跟着其他几个游客瞎走了。走出百余米终于看到了指向市中心的指示牌，再走了一段看到了古老的城墙和城门。接着就是蜿蜒上坡的石板路。第一眼就喜欢上了这个相对远离喧嚣小镇。房屋没有佛罗伦萨的豪华，墙面多是裸露的红砖或是简单的涂层。继续向上来到田野广场，是欧洲现存最大的中世纪广场之一，这里是小镇的开阔地，也聚集了大量的游客，市政厅在此显得特别宏伟。尽管路标是鸟语而且指向不清，但还是找到了离此不远的教堂。这座教堂很有特点，结合了一些哥特风格。</p>

<p><img src="https://lh4.googleusercontent.com/-8AC1EuxchQY/Uv9qxYToWmI/AAAAAAAAAbg/QzU_mwCKO_M/w300/h400" alt="img" /></p>

<p><sub>* 锡耶纳的街道 </sub></p>

<p>从教堂出来想去地图上标志的另一个广场，结果我的自带导航系统再次出错，沿着一条小街走向了不归路，一直走出了城墙。有公交车站，看到路线图上有火车站的标志，然后觉得应该是下山方向，刚好车来就上了贼船。几分钟后发现不对，理应没这么远，似乎还看到了高速公路，又坐了几站，在一家超市前下了车。打开gps和triposo离线地图，我已经远离火车站，而且是在锡耶纳城外了。过马路看反向的车站，这是我才明白di 是从哪， al是去哪，只是站牌还是没显示这个车站是叫啥。焦急地等来了公车，重新回到原点。我沿着另一条路自动扶梯上山，才发现要去的广场来时已经路过了。下山途中，我又脑子短路，选择了一条和来时不同的路，由于有路标显示是去火车站，所以大胆往前走，结果这条路是汽车上山的大路，也就是说是盘山的远路，而且走着走着就没了标志。打开gps确信方向没错，继续走了20分钟，终于看到了火车站。刚好有要去佛罗伦萨的车，就上车了。</p>

<p>车上碰上一个在芬兰念书的阿叉，因为发现互相会说英文，所以就坐在一起聊天了。我曾经是多么讨厌阿叉英语啊，此时却觉得如此亲切。我们都在锡耶纳迷路，他说这个小镇像一个迷宫，还有各种迷惑的路标，他有地图也找不到方向。他和我反方向，从米兰来的，然后要去napoli和罗马。我们一起抱怨了意大利的热天气，我说我甚至怀念英国的雨了。说到佛罗伦萨的高物价，我说有的地方披萨卖20多磅，这个价钱都可以在英国吃three courses了。然后我们交流了一下旅行的经历。他问我喜欢独自自由行吗，我说喜欢，独行太有趣了。</p>

<p>回到佛罗伦萨已经8点多了，他说现在回这里感觉像是回家，第一天来时很困惑，第二天尽管还会迷路但是已经熟悉了。我说同感，而且刚才差点以为回不到这里了。互相问名字居然留到了分别前，只是我一秒钟后就忘了。</p>

<p>走出车站，找了一家餐馆吃了顿大餐来轻松一下，回到旅店倒头便睡。</p>

<p><img src="https://lh4.googleusercontent.com/-1eaimEt11Ww/Uv9qvldjQ-I/AAAAAAAAAbY/5IuKcyXppX0/w300/h400" alt="img" /></p>

<p><sub>* 边上坐着一对来自英国的老夫妻，看我拿着相机消毒，哈哈大笑 </sub></p>

<p><sub>20/06/2013 初稿于佛罗伦萨 06/2014 整理 </sub></p>

<p><sub>注: <a href="http://voice.lawrencesun.info/blog/categories/man-you-ji/">曼游记系列</a>: 本系列游记照片由谷哥四儿子联手谷哥相册友情提供，缺失部分关键照片，另外必要时需科学上网. </sub></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[I, Robot]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/07/10/i/"/>
    <updated>2014-07-10T21:01:30+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/07/10/i</id>
    <content type="html"><![CDATA[<p>由于众所周知的原因，网站常用的前端和字体库在国内的访问速度令人堪忧。今起这两部分改为国内CDN服务，同时关闭了某推的分享，经检测，页面载入暂时不再间歇性便秘了。至于图片，难产情况还是时有发生，暂时不处理了。</p>

<p>今天去柳阴蝉吟的西湖边，匆匆一瞥夏日的荷花。手机扫描照片后提示本人正身处曲院风荷，同时Google Now提醒高温，离家N公里。午后小憩，买一杯冰拿铁，手机随后推送来消费地点和账单。回家同步Fitbit，总共走了10,076步，勉强达到了目标。要是家里装有Philps hue bulbs的话，此时一定通过IFTTT设定，让灯光绚丽一番以示庆祝。</p>

<!-- more -->


<p>十年前可能无法想象科幻片般的情景。随着人工智能和可穿戴设备进一步发展，我们也许在不久的将来实现人的数字化和机器的拟人化。现在何处，将去哪里，晚上是否有约… 自动驾驶汽车将你安全送达酒吧，眼镜开始记录美好时光，手表提醒你此时的心跳有点加快… 所有的生理、心理状况都被数字化呈现并记录，同时经过分析后传回参考建议。</p>

<p>忽然发现，我们似乎离奇点越来越近。若干年后，随着原始技能的逐渐丧失，我们也许都将变成机器人。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[像马刺队一样打球]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/06/18/play-like-san-antonio-spurs/"/>
    <updated>2014-06-18T16:42:34+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/06/18/play-like-san-antonio-spurs</id>
    <content type="html"><![CDATA[<p>在刚刚结束的NBA总决赛中，圣安东尼奥马刺队4：1战胜了迈阿密热火，最后三场几乎是场场吊打，而拥有三巨头的热火毫无反抗之力。</p>

<p>难能可贵的是，他们在上赛季饮恨，当所有人都以为这支球队将就此没落之际，以前所未有的勇气和决心，王者归来。虽然谈不上是马刺队的球迷，但是当看到GDP组合抱在一起庆祝冠军的时刻，还是不禁为之动容。</p>

<p>这支有打发最华丽美誉的球队究竟有怎样的魔力，使得人们在一夜之间就为之倾倒？</p>

<!-- more -->


<p><em>团队篮球</em>：NBA球队大多数是球星战术，而马刺队则是全名皆兵，不管你是主力、替补，还是管饮水机、挥舞毛巾，只要在场上，就必须不断传球。老教练谆谆教导，老队员以身作则，球员之间互帮互助，团结信任。</p>

<p><em>稳定的核心</em>：石佛邓肯，这位表情帝仿佛幽灵一般，在这个联盟中屹立不倒。他与帕克、吉诺比利组成的三叉戟，成为了历史上胜场最多的组合。每个赛季结束都有人说，他们又老了一岁，结果他们又杀回来了。</p>

<p><em>伟大的教练</em>：波波维奇最伟大之处在于，把一只内线防守的球队，逐渐转化成高效进攻的球队，同时保持着阵容和战绩的稳定。很难想象的到，一位以严厉和固执著称的老头，居然是最会变通的教练。</p>

<p>尽管不是所有人都爱NBA，但是我想，每个人都希望能身处在如马刺队一样的团队里。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[曼游记终极篇之欧洲行 Day 4]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/04/19/travel-europe-day-4/"/>
    <updated>2014-04-19T19:21:38+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/04/19/travel-europe-day-4</id>
    <content type="html"><![CDATA[<p>起床后在旅舍吃了房东准备的简易早餐，便前往乌菲齐美术馆。途中路过市政广场，这里有不少雕像，包括著名的大卫(复制品)。尽管早就听闻乌菲奇很火爆，特地提早一点来，但还是来晚了，买票的队伍早已神龙见首不见尾了。如果有网上预定或者加入旅行团，就会省去排队的烦恼，当然这需要多花一点银子。</p>

<p>也许因为在最擅长排队的英国呆了多年，这种情况我也能从容面对，反正今天也不赶时间。在门口等了将近两个小时后，终于进入了这个古老的艺术殿堂。佛罗伦萨很多建筑都和美蒂奇家族有关，这个富有的家族简直就是土皇帝，赞助了大量的艺术家，可以说对文艺复兴的进程有着巨大的影响力。这家艺术馆就是美蒂奇家族曾经的办公室。</p>

<!-- more -->


<p><img src="https://lh4.googleusercontent.com/-07zymtmRnME/Uv9qcDX1eSI/AAAAAAAAAoo/NhTHFNJjQZE/w300/h400" alt="img" /></p>

<p><img src="https://lh3.googleusercontent.com/tdjLPpARFfKWXyqyhUsH8UXM-Q1om5_KXS6wGY6hn6M=w400-h300-no" alt="img" /></p>

<p><sub>* 市政广场 </sub></p>

<p>馆内以文艺复兴时期著名的画作和雕塑为主，包括很多大师如米开朗基罗、达芬奇等人的精品名作。中小学课本上出现的‘维纳斯出世’和‘春’的原画都在这里展出。这个时期的作品大多是宗教和神话题材，风格写实，构图和光线把人物刻画得栩栩如生，堪比如今电影院的3D。</p>

<p>佛罗伦萨不愧是文艺复兴的发祥地，随便进入一个馆就有大师作品。在英国时也去过不少美术馆，包括位于伦敦和爱丁堡的国家画廊，还有现代风格的泰特艺术馆。尽管收藏的名作很多，但是本土作者却很少，而且大多数艺术家都是在法国或者意大利接受熏陶的。如今各个艺术馆里也常看到一些外国艺术学生在老师的带领下参观和讨论。</p>

<p><img src="https://lh4.googleusercontent.com/-hRw5mmxPM-4/Uv9qakleS3I/AAAAAAAAAao/k9IDkW01Uz0/w400/h300" alt="img" /></p>

<p><sub>* 从乌菲齐美术馆看老桥 </sub></p>

<p>走出依河而立的美术馆，顶着午后的烈日，来到了旅店老板推荐的位于山腰的米开朗基罗广场。在这里可以一览佛罗伦萨全城美景。</p>

<p><img src="https://lh6.googleusercontent.com/-kugeUWGHNtU/U1Jwq-9YqkI/AAAAAAAAAo8/uAaNzdkIx_U/w400/h300" alt="img" /></p>

<p><img src="https://lh4.googleusercontent.com/-bf28pnIGNO0/U1JwsD9NTkI/AAAAAAAAApE/wehX6evIRy0/w300/h400" alt="img" /></p>

<p><sub>* 米开朗基罗广场看全城 </sub></p>

<p>下山时迷路了，好在方向正确，边走边找来到了皮蒂宫和花园。这个宫殿也属于美蒂奇家族，里面的展品也不少，但名作不多。宫殿本身十分宏伟，内部装饰极度奢华，粗略看来并不比白金汉宫差多少。至于后花园则平常无奇，英国随便一个庄园的就可以轻松完爆了。</p>

<p><img src="https://lh4.googleusercontent.com/-7LCWmtUrl-U/Uv9qQbAbP-I/AAAAAAAAAaY/EjYJSW7IUsY/w400/h300" alt="img" /></p>

<p><sub>* 皮蒂宫 </sub></p>

<p><img src="https://lh4.googleusercontent.com/-yLMQKq55ChU/U1JwpjCPpPI/AAAAAAAAAo0/XW2SYEpd_H0/w400/h300" alt="img" /></p>

<p><sub>* 老桥之上 </sub></p>

<p>之后沿着老桥回到市中心，这座桥历经多次洪水的洗礼，如今仍延续着繁华。接着走到同样被洪水侵袭多次的圣十字大教堂，这里葬着伽利略、米开朗基罗等多位大师，墙上的壁画和彩窗颇为精美。</p>

<p><img src="https://lh6.googleusercontent.com/-2V9EL6ywZds/U1JwyCajEcI/AAAAAAAAApU/mDVXDzE3CGc/w300/h400" alt="img" /></p>

<p><img src="https://lh4.googleusercontent.com/-cwG-pVJ6XtE/U1JwyEb9FKI/AAAAAAAAApQ/Qy5MfNX1ifc/w300/h400" alt="img" /></p>

<p><sub>* 圣十字大教堂 </sub></p>

<p>晚上吃了当地的特色牛排，味道也说不上出色，但是量特别大。还是配以啤酒，没办法，天太热。意大利的啤酒价格着实不便宜，差不多是英村的两倍。</p>

<p><img src="https://lh3.googleusercontent.com/-bLEzQ4i-7Q8/Uv9qf6Ms7aI/AAAAAAAAAa4/wsuIKBJPDFw/w300/h400" alt="img" /></p>

<p><img src="https://lh4.googleusercontent.com/-e4wK4VkjYrw/Uv9qkOVMHeI/AAAAAAAAAbI/gExZxBeNq7k/w300/h400" alt="img" /></p>

<p><sub>* 鹅肝酱和牛排 </sub></p>

<p>回旅店途中买了点牛奶，似乎意大利人不怎么爱牛奶，鲜奶的种类很少，价格也贵。另外奇怪的是，这里连锁超市几乎没有，取而代之的是各种坑爹的小店，还有不只是卖药的药店。佛罗伦萨路边的小铺特别多，主要经营皮包和纪念品，种类比较单一，有点像几个小铺在全城的复制黏贴。</p>

<p>另外这里的银行感觉特别少，难道他们都是靠黑帮洗钱的么。邮局的工作时间短得惊人，几个小时就关门了，典型的欧洲慵懒风。</p>

<p><sub>20/06/2013 初稿于佛罗伦萨 04/2014 整理 </sub></p>

<p><sub>注: <a href="http://voice.lawrencesun.info/blog/categories/man-you-ji/">曼游记系列</a>: 本系列游记照片由谷哥四儿子联手谷哥相册友情提供，缺失部分关键照片，另外必要时需科学上网，有高清无马需求的请联系我. </sub></p>
]]></content>
  </entry>
  
</feed>
