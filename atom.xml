<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Lawrence Sun]]></title>
  <link href="http://voice.lawrencesun.info/atom.xml" rel="self"/>
  <link href="http://voice.lawrencesun.info/"/>
  <updated>2015-06-14T17:46:08+08:00</updated>
  <id>http://voice.lawrencesun.info/</id>
  <author>
    <name><![CDATA[Lawrence Sun]]></name>
    <email><![CDATA[yuliang1987@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[从Wordress迁移文章到Octopress]]></title>
    <link href="http://voice.lawrencesun.info/posts/2015/06/14/migrate-posts-from-wordpress-to-octopress/"/>
    <updated>2015-06-14T17:17:43+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2015/06/14/migrate-posts-from-wordpress-to-octopress</id>
    <content type="html"><![CDATA[<p>奸商<em>Godaddy</em>发邮件说不再提供免费主机(当年买域名时所赠)并要求尽早迁移，使得我不得不打开沉睡已久的老博客，将之前的博客也搬家到Octopress。</p>

<p>搬家自古以来就是件头疼的事情，当年把人人网上近百篇日志，以纯手工的方式，复制黏贴到WordPress上的悲惨经历仍历历在目。</p>

<p>好在从WordPress迁移到Octopress的工作已经有无数前辈进行了摸索，并制造了自动化工具。</p>

<!-- more -->


<p>首先进入WP后台对内容进行导出，下载生成的xml文件，命名为&#8221;wordpress.xml&#8221;并放在Octopress的根目录下面。</p>

<p>接下来下载<a href="https://gist.github.com/1394128">这个程式</a>并放到新建的utils目录下。</p>

<p>先运行<code>gem install hpricot</code>，然后运行 <code>ruby -r "./utils/wordpressdotcom.rb" -e "Jekyll::WordpressDotCom.process"</code>。</p>

<p>命令窗口提示import了169篇文章，这些文章可以在source/_posts目录里看到。</p>

<p>如果你在WordPress里用的是和我一样的?P一类的路径，或者说别名和标题一样也是中文，那么很不幸，需要将别名改成英文。当然也有现成的转化工具可以用来实现，但我最终还是手动翻译了。</p>

<p>后续还有不少格式、图片链接的问题(懒得处理了&hellip;)，但是基本内容已经搬运成功了。</p>

<p><sub>参考: <a href="http://blog.yorkxin.org/posts/2011/11/26/import-from-wpcom-to-octopress/">Octopress搬家记</a>，<a href="http://blog.dayanjia.com/2012/04/migration-to-octopress-from-wordpress/">从Wordpress迁移到Octopress</a></sub></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[当我再谈跑步时]]></title>
    <link href="http://voice.lawrencesun.info/posts/2015/05/24/when-i-talk-about-running/"/>
    <updated>2015-05-24T10:49:37+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2015/05/24/when-i-talk-about-running</id>
    <content type="html"><![CDATA[<p>去年，<a href="https://knewone.com/things/wei-le-weloop-fei-zhi-neng-ruan-jian-yun-dong-yao-bao/reviews/5455b11331302d04e1540200">当我谈跑步时</a>，我只是谈谈而已。</p>

<p>我并没有因坐拥<a href="https://knewone.com/things/picooc-s1-zhi-neng-ti-zhi-jian-kang-cheng/reviews/5459dbc131302d64756d0000">四大名器</a>而弃键盘从戎，而是仰望天空，思考了诸如为什么要跑步，什么时候跑步，如何优雅地跑步等哲学问题…</p>

<p>当楼下的野猫再次发情的时候，我想，It&rsquo;s now or never… 放进背景音乐也许不错…</p>

<p>为了不让所有的slim裤子撑成regular，我决定再次迈出第一步 &mdash;&mdash;</p>

<!-- more -->


<p>买装备。于是，蓝牙心率带/小米手环/某宝爆款蓝牙耳机和原有的四大名器合体成为我的跑步七魂器。</p>

<p>经过一段时间的测试，小米手环成功让<a href="http://voice.lawrencesun.info/posts/2013/12/31/fitbit-flex-review/">Fitbit Flex</a>安心退休。</p>

<p>作为百元档次的手环，小米的续航、活动/睡眠自动识别都略有惊喜，同步略一般，可以连接微信运动参与好友PK。</p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/IMG_20150509_180459.jpg?imageView2/2/w/300/h/400/q/75|watermark/2/text/TGF3cmVuY2VTdW4=/font/YXJpYWw=/fontsize/300/fill/I0VGRUZFRg==/dissolve/56/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p>这里顺便要说一句，Fitbit作为一个老同志，服役一年半仍能胜任工作，质量、同步、续航和社区都做得不错。</p>

<p>光走路是不够的，而唯一让我能燃起跑步欲望的大概就是数据了吧。当然这其中不包括体脂数据，因为各项评分都达标&hellip;</p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/Screenshot_2015-05-07-21-33-33.jpeg?imageView2/2/w/300/h/400/q/75|watermark/2/text/TGF3cmVuY2VTdW4=/font/YXJpYWw=/fontsize/300/fill/I0VGRUZFRg==/dissolve/56/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p>跑步时，心率是反映强度的重要指标，可以指导速度控制在(60%~80%) *（220-年龄）的有氧区间内。最初考虑的是GPS心率多功能表，但是价格小贵，作为初学者我还是选择了迪卡侬蓝牙心率带，通过手机来接收和同步数据。</p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/IMG_20150524_120626.jpg?imageView2/2/w/400/h/300/q/75|watermark/2/text/TGF3cmVuY2VTdW4=/font/YXJpYWw=/fontsize/300/fill/I0VGRUZFRg==/dissolve/56/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p>试用了几款运动APP，咕咚运动的社区做得不错，可惜不支持第三方的心率带。Runtastic界面做得不错，但是同步有点问题，训练方案另需付费。最终选择了miCoach来记录心率和轨迹，同时miCoach还提供了很棒的训练方案，可以根据实时心率数据来语音指导速度和时间。</p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/IMG_20150524_120444.jpg?imageView2/2/w/300/h/400/q/75|watermark/2/text/TGF3cmVuY2VTdW4=/font/YXJpYWw=/fontsize/300/fill/I0VGRUZFRg==/dissolve/56/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p><img src="http://7xj95q.com1.z0.glb.clouddn.com/Screenshot_2015-05-20-20-29-40.jpeg?imageView2/2/w/300/h/400/q/75|watermark/2/text/TGF3cmVuY2VTdW4=/font/YXJpYWw=/fontsize/300/fill/I0VGRUZFRg==/dissolve/56/gravity/SouthEast/dx/10/dy/10" alt="img" /></p>

<p>由于严格控制心率，刚开始时速度很慢，不断被包括大妈大伯在内的其他人超过&hellip; 当然大多数跑不了几圈。</p>

<p>跑了几次，觉得体力渐渐恢复了，接下来的一段时间，还要配合力量训练才行，争取今年能跑一个半马。</p>

<p>文章写到最后一段，通常要表明主旨，升华主题: 我在跑步，约吗&hellip;</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[WordPress迁移至Windows主机]]></title>
    <link href="http://voice.lawrencesun.info/posts/2015/05/03/wordpress-migration-to-windows-server/"/>
    <updated>2015-05-03T10:56:59+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2015/05/03/wordpress-migration-to-windows-server</id>
    <content type="html"><![CDATA[<p>去年底接了一个建立网站的小项目，考虑到该网站偏向于新闻发布，对其他功能要求不高，所以使用WordPress搭建是一个比较便捷的方式。</p>

<p>本机测试是在<em>Ubuntu</em>的虚拟机环境下，但是网站最终需要搭建在<em>Windows Server 2012 R2</em>的虚拟主机上。</p>

<blockquote><p>Windows Server 环境配置</p></blockquote>

<!-- more -->


<h1>未完成</h1>

<blockquote><p>WordPress 数据迁移</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: Authorization using Pundit]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/12/13/rails-notes-authorization-using-pundit/"/>
    <updated>2014-12-13T09:39:39+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/12/13/rails-notes-authorization-using-pundit</id>
    <content type="html"><![CDATA[<p>Authentitcation identifies a user, and authorization controls what a user can do. The most famous gem used for authorization in rails is <a href="railscasts.com/episodes/192-authorization-with-cancan">CanCan</a>, which is developed by Ryan Bates. However, this gem was no longer maintained. <a href="https://github.com/CanCanCommunity/cancancan">CanCanCan</a> and <a href="https://github.com/elabs/pundit">Pundit</a> are alternative gems we could use. Here I choosed Pundit.</p>

<p>First, implement user roles. Define roles in User Model by using enum and add a new column to user table.</p>

<!-- more -->


<p><code>enum role: [:guest, :vip, :admin]</code></p>

<p><code>rails g migration AddRoleToUsers role:integer</code></p>

<p>Set the default user as guest. We could assign roles like user1.admin! and question the roles like user1.admin?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">AddRoleToUsers</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">up</span>
</span><span class='line'>      <span class="n">add_column</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:role</span><span class="p">,</span> <span class="ss">:integer</span><span class="p">,</span> <span class="ss">default</span><span class="p">:</span> <span class="mi">0</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">down</span>
</span><span class='line'>      <span class="n">remove_column</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:role</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, <code>gem "pundit"</code> into Gemfile and run bundle install.</p>

<p>Run <code>rails g pundit:install</code> to generate a default policy in app/policies/application_policy.rb</p>

<p>Then create own policy, for example, a Post Policy.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">PostPolicy</span> <span class="o">&lt;</span> <span class="no">ApplicationPolicy</span>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:current_user</span><span class="p">,</span> <span class="ss">:post</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">current_user</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@current_user</span> <span class="o">=</span> <span class="n">current_user</span>
</span><span class='line'>    <span class="vi">@post</span> <span class="o">=</span> <span class="n">post</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">update?</span>
</span><span class='line'>    <span class="vi">@current_user</span><span class="o">.</span><span class="n">admin?</span> <span class="ow">or</span> <span class="vi">@post</span><span class="o">.</span><span class="n">user</span> <span class="o">==</span> <span class="vi">@current_user</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">destroy?</span>
</span><span class='line'>      <span class="vi">@current_user</span><span class="o">.</span><span class="n">admin?</span> <span class="ow">or</span> <span class="vi">@post</span><span class="o">.</span><span class="n">user</span> <span class="o">==</span> <span class="vi">@current_user</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>So if current user is not the author of this post or admin, then he is not allowed to update or destroy the post.</p>

<p>After that, add <code>autorize @post</code> to update and destroy action in Post Controller.</p>

<p>In Post show page, if current user do not have the permission, he will not see the edit and delete button.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">% if </span><span class="n">policy</span><span class="p">(</span><span class="vi">@post</span><span class="p">)</span><span class="o">.</span><span class="n">update?</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx"> ...</span>
</span><span class='line'><span class="sx">&lt;% end %&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally, add following code to Application Controller, so that we include Pundit and show the customized alert.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="kp">include</span> <span class="no">Pundit</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="n">rescue_from</span> <span class="ss">Pundit</span><span class="p">:</span><span class="ss">:NotAuthorizedError</span><span class="p">,</span> <span class="ss">with</span><span class="p">:</span> <span class="ss">:user_not_authorized</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">user_not_authorized</span>
</span><span class='line'>    <span class="n">redirect_to</span> <span class="ss">:back</span><span class="p">,</span> <span class="ss">:alert</span> <span class="o">=&gt;</span> <span class="s2">&quot;You don&#39;t have permission to those resources.&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>UPDATE:</p>

<p>Sometimes current_user are not defined, for example a guest user who is not signed in. Then the above authorization may raise a <code>undefined method 'admin?' for nil:NilClass</code> problem, which I met. The solution would be changing <code>current_user.admin?</code> to <code>current_user.try(:admin?)</code>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: Deeply Nested Resources]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/11/29/rails-notes-deeply-nested-resources/"/>
    <updated>2014-11-29T21:29:26+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/11/29/rails-notes-deeply-nested-resources</id>
    <content type="html"><![CDATA[<p>Nested resources are commonly used in rails app. For example,</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>resources :books do
</span><span class='line'>  resources :posts do
</span><span class='line'>      resources :comments
</span><span class='line'>  end
</span><span class='line'>  resources :comments
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>However, when it&rsquo;s deeply-nested, the URL will looks like this as a monster, <code>/books/:id/posts/:id/comments</code>. And it will cause some difficulties when trying to create/edit comments.</p>

<!-- more -->


<p>For example, <code>book_post_comment_path(@book, @post, @comment)</code> looks complicated and non reusable.</p>

<p>It&rsquo;s also hard to handle different params in comments controller.</p>

<p>So I tried to refactor the code today.</p>

<p>First I changed the routes.rb:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">resources</span> <span class="ss">:books</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">resources</span> <span class="ss">:posts</span>
</span><span class='line'>  <span class="n">resources</span> <span class="ss">:comments</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">resources</span> <span class="ss">:posts</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">resources</span> <span class="ss">:comments</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will generate the routes like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">books</span><span class="o">/</span><span class="ss">:id</span><span class="o">/</span><span class="n">posts</span>
</span><span class='line'><span class="n">books</span><span class="o">/</span><span class="ss">:id</span><span class="o">/</span><span class="n">comments</span>
</span><span class='line'><span class="n">posts</span><span class="o">/</span><span class="ss">:id</span>
</span><span class='line'><span class="n">posts</span><span class="o">/</span><span class="ss">:id</span><span class="o">/</span><span class="n">comments</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this way, the comments action can be used in the same way whatever the @commentable is.</p>

<p>The posts controller will not need @postable id except new/create action. If you want to create a new post on books show page like me, you still have to pass books_id to @postable.</p>

<p>And for me, after creating the new post, it will redirect_to @post rather than [@postable, @post]. So when creating new comment for post, it happens on posts/:id page. I also added a link back to this post&rsquo;s parent using @post.postable .</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: Polymorphic Path]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/11/29/rails-notes-polymorphic-path/"/>
    <updated>2014-11-29T21:26:30+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/11/29/rails-notes-polymorphic-path</id>
    <content type="html"><![CDATA[<p>In my rails app, movie/book and post are in the <em>polymorphic</em> relationship. In <code>posts/show.html.erb</code>, I tried to add &lsquo;Edit&rsquo; and &lsquo;Delete&rsquo; function. The problem was how to write related path.</p>

<p>At first, I used <em>if&hellip;else</em> condition to judge @postable_type. When it equals to &lsquo;Book&rsquo;, then showed <code>edit_book_post_path(@post.postable_id, @post)</code> and <code>book_path(@post.postable_id)</code>, and if it equals to &lsquo;Movie&rsquo;, then showed the related movie path.</p>

<p>It worked fine, but a little bit complicated. The same problem when I render the comments partial, I had to use two different files to handle edit/delete comment path.</p>

<p>Then I found polymorphic_path method on RailsGuides and some articles on the Web.</p>

<!-- more -->


<p>Briefly speaking, the final code I use like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">link_to</span> <span class="s1">&#39;Edit&#39;</span><span class="p">,</span> <span class="n">edit_polymorphic_path</span><span class="p">(</span><span class="o">[</span><span class="vi">@postable</span><span class="p">,</span> <span class="vi">@post</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'><span class="n">link_to</span> <span class="s1">&#39;Delete&#39;</span><span class="p">,</span> <span class="n">polymorphic_path</span><span class="p">(</span><span class="o">[</span><span class="vi">@postable</span><span class="p">,</span> <span class="vi">@post</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'><span class="n">link_to</span> <span class="s1">&#39;New Post&#39;</span><span class="p">,</span> <span class="n">new_polymorphic_path</span><span class="p">(</span><span class="o">[</span><span class="vi">@postable</span><span class="p">,</span> <span class="vi">@post</span><span class="o">]</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, I can abandon the if&hellip;else condition and use the same template whatever the @postable is.</p>

<p>I also refactor the controller like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">create</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>  <span class="k">if</span> <span class="vi">@post</span><span class="o">.</span><span class="n">save</span>
</span><span class='line'>      <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>  <span class="n">redirect_to</span> <span class="o">[</span><span class="vi">@postable</span><span class="p">,</span> <span class="vi">@post</span><span class="o">]</span>
</span><span class='line'>      <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Doing this way, it&rsquo;s simple and clear.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[华为路由器开启Web登陆]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/11/29/huawei-router-init/"/>
    <updated>2014-11-29T20:04:14+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/11/29/huawei-router-init</id>
    <content type="html"><![CDATA[<p>对于一台新的路由器来说，默认ip地址一般式是（192.168.1.1)。可以用一台PC连接路由器的任意lan口，并将PC的本地ip地址设为(192.168.1.x)(x一般取0~15，不为1)，掩码(255.255.255.0)，网关(192.168.1.1)。</p>

<p>但是昨天试图通过Web端来配置华为AR1220-S路由器的时候，一直无法连接。</p>

<p>在华为技术支持和网络资源的帮助下，发现原因可能是原厂默认下无法实现Web登陆。</p>

<p>最终是通过Console接口初始了路由器的ip并打开了Web登陆的功能。</p>

<p>具体步骤如下:</p>

<!-- more -->


<p>1.Console线连接后，使用xp下的超级终端新建一个连接，进入console端界面。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;Huawei&gt;system-view  //进入系统视图
</span><span class='line'>[Huawei]interface gigabitethernet 0/0/0  //进入接口视图
</span><span class='line'>[Huawei-GigabitEthernet0/0/0]ip address 192.168.1.1 24 //在该接口配置管理ip地址
</span><span class='line'>[Huawei-GigabitEthernet0/0/0]display ip interface brief  //查看配置情况
</span><span class='line'>[Huawei-GigabitEthernet0/0/0]aaa  //进入AAA视图
</span><span class='line'>[Huawei-aaa]local-user _user-name_ password cipher _password_
</span><span class='line'>                      local-user _user-name_ privilege level _level_
</span><span class='line'>                      local-user _user-name_ service-type http
</span><span class='line'>                      // 配置用户名、密码、权限以及访问类型</span></code></pre></td></tr></table></div></figure>


<p>2.执行quit, 返回系统视图。</p>

<p>3.此时PC端连接gigabitethernet0/0/0接口，确认可以ping通路由ip。</p>

<p>4.会发现还是不能登陆Web端，因此需要在Console端输入http server enable</p>

<p>通过以上步骤，就可以进入Web端界面并根据需求对路由器进行配置了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: At or Reply to Someone]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/11/09/rails-notes-at-someone/"/>
    <updated>2014-11-09T08:52:19+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/11/09/rails-notes-at-someone</id>
    <content type="html"><![CDATA[<p><strong>1. At</strong></p>

<p>The &lsquo;@&rsquo; function is used widely on web apps.</p>

<p>Here I use a jquery plugin called <a href="https://github.com/ichord/At.js">atwho</a>. First download jquery.atwho.js, jquery.caret.js, jquery.atwho.css. Then add these files to app/assets.</p>

<p>Add <code>//= require jquery.atwho</code> to app/assets/javascripts/application.js and add <code>*= require jquery.atwho</code> to app/assets/stylesheets/application.css.scss.</p>

<!-- more -->


<p>Then use it to at users when replying a comment. Following <a href="http://happycasts.net/episodes/76">happycasts</a>, bind the textarea like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$(function(){
</span><span class='line'>  var commenter = [];
</span><span class='line'>  var commenter_exist= [];
</span><span class='line'>  $('.comment-user').each(function() {
</span><span class='line'>      if($.inArray($(this).text(), commenter_exist) &lt; 0){
</span><span class='line'>      commenter.push($(this).text());
</span><span class='line'>      commenter_exist.push($(this).text());
</span><span class='line'>    }
</span><span class='line'>  });
</span><span class='line'>  $('textarea').atwho({at:"@", 'data':commenter});
</span><span class='line'>});</span></code></pre></td></tr></table></div></figure>


<p>One problem I found was this atwho funciont didn&rsquo;t work until refreshed this page. When I deleted turoblink, it worked fine. So Finally I solved it by using a gem called <a href="https://github.com/kossnocorp/jquery.turbolinks">jquery.turbolinks</a>.</p>

<p><strong>2. Reply</strong></p>

<p>Sometimes we would like to reply to other&rsquo;s comment. When we click reply button, we want to &lsquo;@&rsquo; this comment&rsquo;s author.</p>

<p>Thanks to <a href="https://github.com/chloerei/campo">Campo</a> app, I added reply function to my own rails app.</p>

<p>Add following parts to comments view.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;a class="btn", data-reply-to="@&lt;%= comment.user.name %&gt; " &gt;
</span><span class='line'>  &lt;i class="fa fa-reply"&gt;&lt;/i&gt;
</span><span class='line'>&lt;/a&gt;</span></code></pre></td></tr></table></div></figure>


<p>Then include a coffee javascript file. Remember to set corrosponding class/id in the html file.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$(document).on 'click', '.comments [data-reply-to]', -&gt;
</span><span class='line'>  textarea = $('#new_comment textarea')
</span><span class='line'>  textarea.focus()
</span><span class='line'>  textarea.val(textarea.val() + $(this).data('reply-to'))</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: Link to Commentable]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/11/08/rails-notes-link-to-commentable/"/>
    <updated>2014-11-08T17:19:09+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/11/08/rails-notes-link-to-commentable</id>
    <content type="html"><![CDATA[<p>Few days ago I created a polymorphic comment model based on <a href="http://railscasts.com/episodes/154-polymorphic-association">Railscasts</a>.</p>

<p>Today I wanted to show the lastest comments on homepage and link each comment body to their &lsquo;parents&rsquo; like a book or a movie.</p>

<p>The link path was a bit tricky and finally I figured it out.</p>

<p>What you need here is this particular comment&rsquo;s commentable type like &lsquo;book&rsquo; or &lsquo;movie&rsquo;, as well as the commentable id, so it will leads you to the show page and the url should like &lsquo;book/id&rsquo;.</p>

<!-- more -->


<p>The view page could look like this.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;%=</span> <span class="n">link_to</span> <span class="n">markdown</span><span class="p">(</span><span class="vi">@comment</span><span class="o">.</span><span class="n">body</span><span class="p">),</span> <span class="o">[</span><span class="vi">@comment</span><span class="o">.</span><span class="n">commentable</span><span class="p">,</span> <span class="vi">@comment</span><span class="o">]</span> <span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Then it will pass commentable type and id, looking for comment/show action.</p>

<p>So add show action in comments_controller like this</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">show</span>
</span><span class='line'>  <span class="n">redirect_to</span> <span class="vi">@commentable</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will direct to the page that I want.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Use Android Toggle Button]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/11/08/how-to-use-android-toggle-button/"/>
    <updated>2014-11-08T14:57:11+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/11/08/how-to-use-android-toggle-button</id>
    <content type="html"><![CDATA[<p>I am taking an online android course on Coursera. The first assignment is to build a app which could properly present text and image.</p>

<p>Apart from what I learned from the first three lectures, I also tried to add something interesting. I wanted to show two photos in the same place and allowed users to switching between them. So I chosed Toggle Button.</p>

<p>However, I was not quite followed the instructions on Android Developer Online <a href="http://developer.android.com/guide/topics/ui/controls/togglebutton.html)">Doc</a>. Besides, some problems like &lsquo;variables are not resolved&rsquo; occurred.</p>

<p>After searching for the solution on <a href="http://stackoverflow.com/questions/18335239/android-toggle-button-custom-look">Stackoverflow</a> and finding <a href="http://liangruijun.blog.51cto.com/3061169/655014">example</a> apps, I finally managed to achieve what I want.</p>

<!-- more -->


<p>First a toggle button in layout.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;</span><span class="n">ToggleButton</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">id</span><span class="o">=</span><span class="s">&quot;@+id/toggleButton1&quot;</span>
</span><span class='line'>  <span class="o">...</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">textOn</span><span class="o">=</span><span class="s">&quot;&quot;</span>
</span><span class='line'>  <span class="nl">android:</span><span class="n">textOff</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="o">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Add ToggleButton function in MainActivity.java.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">android.widget.CompoundButton</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.widget.CompoundButton.OnCheckedChangeListener</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.widget.LinearLayout</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.widget.ImageView</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.widget.ToggleButton</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">ActionBarActivity</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">ImageView</span> <span class="n">imageView</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">ToggleButton</span> <span class="n">toggleButton</span><span class="o">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>      <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
</span><span class='line'>      <span class="n">imageView</span> <span class="o">=</span> <span class="o">(</span><span class="n">ImageView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">imageView1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">toggleButton</span> <span class="o">=</span> <span class="o">(</span><span class="n">ToggleButton</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">toggleButton1</span><span class="o">);</span>
</span><span class='line'>        <span class="n">toggleButton</span><span class="o">.</span><span class="na">setOnCheckedChangeListener</span><span class="o">(</span><span class="k">new</span> <span class="n">OnCheckedChangeListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCheckedChanged</span><span class="o">(</span><span class="n">CompoundButton</span> <span class="n">buttonView</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">isChecked</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">toggleButton</span><span class="o">.</span><span class="na">setChecked</span><span class="o">(</span><span class="n">isChecked</span><span class="o">);</span>
</span><span class='line'>                <span class="n">imageView</span><span class="o">.</span><span class="na">setImageResource</span><span class="o">(</span><span class="n">isChecked</span><span class="o">?</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">hznight</span><span class="o">:</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">hzday</span><span class="o">);</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>        <span class="o">});</span>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Generate a new file called &lsquo;ic_toggle&rsquo; in drawable folder and customize toggle button in layout.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;selector</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;item</span> <span class="na">android:drawable=</span><span class="s">&quot;@drawable/night&quot;</span> <span class="na">android:state_checked=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;item</span> <span class="na">android:drawable=</span><span class="s">&quot;@drawable/day&quot;</span> <span class="na">android:state_checked=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/selector&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;ToggleButton</span>
</span><span class='line'>  <span class="err">...</span>
</span><span class='line'>  <span class="na">android:background=</span><span class="s">&quot;@drawable/ic_toggle&quot;</span>
</span><span class='line'>  <span class="na">android:textOn=</span><span class="s">&quot;&quot;</span>
</span><span class='line'>  <span class="na">android:textOff=</span><span class="s">&quot;&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: 利用七牛云储存Paperclip图片]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/11/02/railsnotes-storage-paperclip-images/"/>
    <updated>2014-11-02T20:37:35+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/11/02/railsnotes-storage-paperclip-images</id>
    <content type="html"><![CDATA[<p>之前使用<a href="http://voice.lawrencesun.info/posts/2014/09/21/rails-notes-upload-avatar-using-paperclip/">Paperclip来实现Rails应用上传图片的功能</a>, 但是在部署到Heroku时会有无法储存的问题, 每次push都会删除之前上传的图片。</p>

<p>这是因为Heroku不支持动态上传文件, 很多人碰到这种情况, Stackoverflow上推荐的解决方案是使用Amazon S3, 但是这个服务需要信用卡注册, 另外只能免费使用一年。</p>

<p>这无疑会提高试错和测试阶段的成本。经过另一番搜索, 发现<a href="https://portal.qiniu.com/signup?code=3lnzd178edmqa">七牛云</a>储存可以用来实现图片的储存和调用。</p>

<!-- more -->


<p>首先需要调用<a href="https://github.com/lidaobing/paperclip-qiniu">paperclip-qiniu</a>的gem, 并对之前使用paperclip的相关文件进行修改。</p>

<p>修改paperclip的初始化内容, <code>config/initializers/paperclip.rb</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Paperclip</span><span class="p">:</span><span class="ss">:Attachment</span><span class="o">.</span><span class="n">default_options</span><span class="o">[</span><span class="ss">:storage</span><span class="o">]</span> <span class="o">=</span> <span class="ss">:qiniu</span>
</span><span class='line'><span class="ss">Paperclip</span><span class="p">:</span><span class="ss">:Attachment</span><span class="o">.</span><span class="n">default_options</span><span class="o">[</span><span class="ss">:qiniu_credentials</span><span class="o">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="ss">:access_key</span> <span class="o">=&gt;</span> <span class="s1">&#39;youraccesskey&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:secret_key</span> <span class="o">=&gt;</span> <span class="s1">&#39;yoursecretkey&#39;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="ss">Paperclip</span><span class="p">:</span><span class="ss">:Attachment</span><span class="o">.</span><span class="n">default_options</span><span class="o">[</span><span class="ss">:bucket</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;topics-1024&#39;</span>
</span><span class='line'><span class="ss">Paperclip</span><span class="p">:</span><span class="ss">:Attachment</span><span class="o">.</span><span class="n">default_options</span><span class="o">[</span><span class="ss">:use_timestamp</span><span class="o">]</span> <span class="o">=</span> <span class="kp">false</span>
</span><span class='line'><span class="ss">Paperclip</span><span class="p">:</span><span class="ss">:Attachment</span><span class="o">.</span><span class="n">default_options</span><span class="o">[</span><span class="ss">:qiniu_host</span><span class="o">]</span> <span class="o">=</span>
</span><span class='line'>  <span class="s1">&#39;http://yourhostname.qiniudn.com&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>这里access_key, secret_key, qiniu_host分别是七牛云储存的相关信息。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">has_attached_file</span> <span class="ss">:photo</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:default_url</span> <span class="o">=&gt;</span> <span class="s1">&#39;http://xxx.com/bookmissing.jpg&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s2">&quot;:class/:attachment/:id/:basename.:extension&quot;</span>
</span><span class='line'><span class="n">validates_attachment_content_type</span> <span class="ss">:photo</span><span class="p">,</span> <span class="ss">:content_type</span> <span class="o">=&gt;</span> <span class="sr">/\Aimage\/.*\Z/</span>
</span></code></pre></td></tr></table></div></figure>


<p>其中default_url是默认图片, 可以事先上传至七牛。</p>

<p>path是图片储存和调用的地址, 可以根据需要来更改。例如:</p>

<p><code>http://yourhost-qiniudn.com/books/photos/1/name.jpg</code></p>

<p>接下来需要在view中调用:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= qiniu_image_tag @movie.photo.url, :thumbnail =</span><span class="o">&gt;</span> <span class="s1">&#39;212x316!&#39;</span><span class="p">,</span> <span class="ss">:quality</span> <span class="o">=&gt;</span> <span class="mi">80</span> <span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>这里可以自定义一些选项, 比如thumbnail, gravity, crop, quality等, 具体可以参考七牛云的<a href="http://docs.qiniutek.com/v3/api/foimg/#imageView">高级图像处理接口</a>文档。</p>

<p>至此，实现了paperclip上传图片的存储和调用。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: Make Dropdown Work on Heroku]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/10/26/rails-notes-make-dropdown-work-on-heroku/"/>
    <updated>2014-10-26T12:07:57+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/10/26/rails-notes-make-dropdown-work-on-heroku</id>
    <content type="html"><![CDATA[<p>After I deployed a app on Heroku, I found that the Bootstap dropdown menu didn&rsquo;t work on Heroku. It was working in my local development environment.</p>

<p>So I searched the answers from stackoverflow. It seemed that it was a common problem.</p>

<p>I had tried to reorder the //=jquery and //=bootstrap and reorder back again and again. I also ran asset precompile method. However, it still didn&rsquo;t work in my situation.</p>

<p>Then I compared an app I wrote before, and I found that there might be the conflict between &lsquo;bootstrap&rsquo; and &lsquo;bootstrap-spockets&rsquo;. The dropdown menu worked if either of them were removed. So I removed &lsquo;bootstrap&rsquo; finally. I am not sure if it will cause any further problems but so far it&rsquo;s fine.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: Heroku environment configuration problem]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/10/26/rails-notes-heroku-environment-configuration-problem/"/>
    <updated>2014-10-26T12:06:49+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/10/26/rails-notes-heroku-environment-configuration-problem</id>
    <content type="html"><![CDATA[<p>When I tried to deploy one of my rails app on Heroku, the following problem occured.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>can't convert nil into String 
</span><span class='line'>/app/config/initializers/devise.rb:13:in `+'</span></code></pre></td></tr></table></div></figure>


<p>The reason was that I set DOMAIN_NAME etc. inside secret.yml and this file was git ignored since I wanted to keep credentials private. So Heroku couldn&rsquo;t find these configuration values.</p>

<!-- more -->


<p>Using figaro gem seems a good way to fix this. But I didn&rsquo;t want to add another gem and create a new yml file.</p>

<p>What I did was set Heroku environment variables directly and it worked:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ heroku config:add GMAIL_USERNAME='myname@gmail.com' GMAIL_PASSWORD='mypassword'
</span><span class='line'>$ heroku config:add DOMAIN_NAME='example.com'</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Notes: Upload Avatar Using Paperclip]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/09/21/rails-notes-upload-avatar-using-paperclip/"/>
    <updated>2014-09-21T17:28:49+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/09/21/rails-notes-upload-avatar-using-paperclip</id>
    <content type="html"><![CDATA[<p>In my previous rails apps, I used gravatar_for method to link the gravatar to users. In a recent app, I wanted to add cover photos to the books and allow users to upload the images.</p>

<p>So I decided to use paperclip after seeing one of the <a href="http://railscasts.com/episodes/134-paperclip">episode</a> of railscast. Instead of applying the plugin, I installed paperclip gem.</p>

<p>Add <code>gem "paperclip", "~&gt; 4.2"</code> to Gemfile and run <code>bundle install</code>.</p>

<p>Then add photo columns to the existing books table.</p>

<!-- more -->


<p><code>rails g migration AddPhotosToBooks</code></p>

<p>Migration:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">AddAvatarColumnsToUsers</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">up</span>
</span><span class='line'>    <span class="n">add_attachment</span> <span class="ss">:books</span><span class="p">,</span> <span class="ss">:photo</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">down</span>
</span><span class='line'>    <span class="n">remove_attachment</span> <span class="ss">:books</span><span class="p">,</span> <span class="ss">:photo</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will insert four columns into books table: photo_file_name, photo_file_size, photo_content_type, photo_updated_at.</p>

<p>Add the following lines to Book Model:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">has_attached_file</span> <span class="ss">:photo</span><span class="p">,</span> <span class="ss">:styles</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:medium</span> <span class="o">=&gt;</span> <span class="s2">&quot;300x300&gt;&quot;</span><span class="p">,</span> <span class="ss">:thumb</span> <span class="o">=&gt;</span> <span class="s2">&quot;100x100&gt;&quot;</span> <span class="p">},</span> <span class="ss">:default_url</span> <span class="o">=&gt;</span> <span class="s2">&quot;missing.png&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:url</span> <span class="o">=&gt;</span> <span class="s2">&quot;/assets/books/:id/:style/:basename.:extension&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s2">&quot;:rails_root/public/assets/books/:id/:style/:basename.:extension&quot;</span>
</span><span class='line'>  <span class="n">validates_attachment</span> <span class="ss">:photo</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:content_type</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:content_type</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s2">&quot;image/jpeg&quot;</span><span class="p">,</span> <span class="s2">&quot;image/jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;image/gif&quot;</span><span class="p">,</span> <span class="s2">&quot;image/png&quot;</span><span class="o">]</span> <span class="p">},</span>
</span><span class='line'>  <span class="ss">:size</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:less_than</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="o">.</span><span class="n">megabytes</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Forms to be updated:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-group&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="sx">%= f.label &quot;cover&quot; %&gt;</span>
</span><span class='line'><span class="sx"> &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">file_field</span> <span class="ss">:photo</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And the updated book&rsquo;s show view with the uploaded photo.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;%=</span> <span class="n">image_tag</span> <span class="vi">@book</span><span class="o">.</span><span class="n">photo</span><span class="o">.</span><span class="n">url</span><span class="p">(</span><span class="ss">:medium</span><span class="p">)</span> <span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Besides, in order to run paperclip, ImageMagick is required. We can simply install it by homebrew.</p>

<p><code>brew install imagemagick</code></p>

<p>However, when I installed homebrew, several issues came out.</p>

<p>It was a long story, briefly speeking, I ran <code>brew doctor</code> and tried to solve the warning issues by searching the net. Basiclly, I updated Git and Command Line Tool and reinstall the homebrew.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to upgrade git]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/09/21/how-to-upgrade-git/"/>
    <updated>2014-09-21T17:25:08+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/09/21/how-to-upgrade-git</id>
    <content type="html"><![CDATA[<p>When I intended to install ImageMagick via homebrew, and found some issues by runing <code>brew doctor</code>. One was telling me that the git was out of date.</p>

<p>When installing Git for Mac OS via XCode, it points Git to usr/bin/git.
run <code>which git</code> to check out the directory.</p>

<p>If we want to keep git up to date, we could install/upgrade git using homebrew.</p>

<p>Add the line in ~/.bash_profile</p>

<p><code>export PATH="/usr/local/bin:$PATH"</code></p>

<p>Then run <code>brew install git</code> and <code>brew update git</code>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[疑似离婚前夕：我眼中的苏格兰]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/09/18/scotland-independent/"/>
    <updated>2014-09-18T18:48:17+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/09/18/scotland-independent</id>
    <content type="html"><![CDATA[<p>这几天，英国各方“律师”声情并茂甚至声泪俱下地对离婚案件进行了辩护。再过几个小时，随着“陪审团们”投票完毕，关于苏格兰和英格兰的离婚判决即将作出。</p>

<p>假如苏英分家，那么米字旗也许会失去那个叉，而哈利波特们下学期去霍格沃茨就要算出国留学了。作为一个<code>麻瓜</code>，我曾有幸分别于冬夏两季踏访过这片土地，流连忘返之际，简单谈谈我眼中的苏格兰，以及他们和英格兰的区别。</p>

<p>历史上两地人民经常小打小闹，最后打出了感情，四百年前的一纸婚约，使他们结合到了一起。然而包办婚姻并不完美，苏格兰人并没有接受这个现实。随着命运之石的回归，以及北海油田的发现，苏格兰人再次来到了<em>历史的十字路口</em>。</p>

<!-- more -->


<p>说到苏格兰，很多人都会想起《勇敢的心》。“FREEDOM~~”，站在辽阔的苏格兰高地，我也会情不自禁地喊出来，那是在大自然里驰骋的自由。似乎豪爽的苏格兰人骨子里就向往着自由，不知道是否是威士忌的作用。</p>

<ul>
<li><p>首先说说苏格兰人和英格兰人的区别。我的感觉是，英格兰人更加克制与内敛，即便是讲个无节操笑话也要一本正经。而苏格兰人则天真奔放，直来直往。我在旅行期间碰到的两个导游都是这种性格，一个是边开车边讲历史边唱歌的女汉子，一个是喝口酒拉着我就跳起舞的大胡子。苏格兰人对反抗英格兰的战争事迹、神话传说、奇闻异事津津乐道。当然，泡完酒吧之后，区别并不大，我也无法预测哪方的球迷更“流氓”。</p></li>
<li><p>语言方面，除了带浓重苏格兰口音的英语，大多数苏格兰人都会说另一种鸟语，也有自己的文字。</p></li>
<li><p>绘画方面，英格兰所收藏的画作包容并兼，风格各一，而苏格兰所收藏的大多是田园风光。</p></li>
<li><p>音乐方面，英格兰有英伦摇滚，苏格兰有自由风笛，配合传统格子裙的穿着。</p></li>
<li><p>神兽方面，英格兰可见草泥马，苏格兰常遇高地牛。</p></li>
<li><p>至于暗黑料理方面，英格兰的Fish&amp;Chips和苏格兰的Haggis难分高下。</p></li>
</ul>


<p>&hellip;&hellip;</p>

<p>所以，性格不合也许是这场婚姻悲剧的主要原因。</p>

<p>然而，老夫老妻一起生活了这么多年，早已血乳交融。真要分手，你让女王大人情何以堪。</p>

<p>明天，答案即将揭晓，也许是Keep calm and carry on，也许是北境长城一夜崛起，但苏格兰人心中的自由之火一时之间恐难以熄灭。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[曼游记终极篇之欧洲行 Day 8]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/09/13/travel-europe-day-8/"/>
    <updated>2014-09-13T17:01:19+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/09/13/travel-europe-day-8</id>
    <content type="html"><![CDATA[<p>昨晚，乘坐列车来到了夕阳下的米兰。米兰的火车站非常宏伟，圆拱大顶，是我在意大利看到的最豪华的车站。大城市的路标还算清楚，转过几个弯便找到了地铁口。</p>

<p>地铁的自动售票机旁有不少人，很热心地上来帮你选票。之前在网上看到过类似的事，所以我对那个凑过来帮我点屏幕选站的人心存戒备，对他说了句&#8217;I will check it later&#8217;就转身离开了。这时我看到另一个人帮一对情侣买了票，取票出来给他们，由于找钱不是马上就退出的，所以这些人就强制拿小费了。我等到边上没人的时候自己买了一张两天期的票，坐上地铁来到了米兰大教堂。</p>

<!-- more -->


<p><img src="https://lh6.googleusercontent.com/-PbppTbz5URw/Uv9sAc423vI/AAAAAAAAAeA/jzlMn3o9mDQ/w300/IMG_20130621_212859.jpg" alt="img" /></p>

<p><sub>* 夜幕下的米兰大教堂</sub></p>

<p>由于此时夜色已晚，无心欣赏夜色下的米兰街景，沿着via torino这条据说是深受年轻人喜爱的购物街前行，来到了青年旅社。</p>

<p>旅舍一楼是酒吧，很热闹，check in的时候还赠送一杯免费的饮料。我点了一杯啤酒，一饮而尽。然后吧台的两位美女服务员带着我熟悉了一下这个旅舍。地下一层是休闲区，可以玩吉他或者坐在沙发上聊天，四楼是厨房，有免费的意大利面提供。在三楼的露台还见到了老板，大约30岁不到，简单交谈了几句。</p>

<p>房间是8个人的上下铺，装修很新，和大多数青年旅社不同，公用厕所和淋浴都在房间里。这里坐电梯和进房间都是刷门卡，所以还算安全，整理好东西后倒头就睡。</p>

<p><img src="https://lh3.googleusercontent.com/-4F7v08B1Zgo/Uv9sCuNkBjI/AAAAAAAAAeI/Z42CclbpDog/w300/IMG_20130622_093448.jpg" alt="img" /></p>

<p><img src="https://lh6.googleusercontent.com/-IVzVO-AHVR8/Uv9sOWDaUdI/AAAAAAAAAvE/petCSNMzyyY/w300/IMG_20130622_100203.jpg" alt="img" /></p>

<p><sub>* 米兰的电车和街边的模特</sub></p>

<p>早上起来再次来到了世界最大的哥特式教堂——米兰大教堂，内部的彩窗可能是全世界最大的，全部以圣经故事为主题，历经百年，光彩依旧。参观完大教堂后沿着宏伟繁华的的埃马努埃莱二世长廊来到了世界上最优秀之一的斯卡拉大剧院。剧院的演出大厅很华丽，周围一圈都是包间，站在包间看全景听着工作人员的介绍，可以看见舞台上有剧组正在搭建背景。</p>

<p><img src="https://lh3.googleusercontent.com/-7KPlcAFz57A/Uv9sM8htL-I/AAAAAAAAAeY/G1Ua7-Y8OE0/w300/IMG_20130622_095244.jpg" alt="img" /></p>

<p><sub>* 埃马努埃莱二世长廊</sub></p>

<p>出来前往斯福尔扎城堡，这里虽然是四周城墙环绕，看起来森严庄重，里面确实艺术的天堂。里面的博物馆陈列着不少雕刻和绘画，包括米开朗基罗和达芬奇等大家的作品。</p>

<p><img src="https://lh3.googleusercontent.com/-H84ErnUyn1M/Uv9sPkWbPmI/AAAAAAAAAeo/r-xxAcMTKcs/w400/IMG_20130622_110929.jpg" alt="img" /></p>

<p><img src="https://lh3.googleusercontent.com/-5ZvjS8chFIA/Uv9sXmTuIII/AAAAAAAAAew/RGs7edwFr4I/w300/IMG_20130622_113435.jpg" alt="img" /></p>

<p><sub>* 斯福尔扎城堡和米开朗基罗未完成的雕塑</sub></p>

<p>博物馆后面是一个大公园，有点像伦敦的海德公园，很多家长带着小朋友在这里玩耍嬉戏。在公园悠闲地度过了一个下午，再次回到米兰的购物大街。街道两旁挂着米兰世博会的宣传和各国旗帜，无论是奢侈店还是平价店都是人潮涌动。</p>

<p><img src="https://lh5.googleusercontent.com/-GXP_PBDBduM/Uv9sZbzHo0I/AAAAAAAAAfA/-suXL55BZfQ/w300/IMG_20130622_144257.jpg" alt="img" /></p>

<p><sub>* 米兰世博会</sub></p>

<p>在米兰也会碰上些烦心事，就是有很多非洲人在街上强买强卖手链等饰品，即使你说不，他们也会跟着你一路纠缠。</p>

<p><img src="https://lh5.googleusercontent.com/-K0O8QKj7Mv4/Uv9sZwTVUCI/AAAAAAAAAe8/Xk2N32hr2GU/w300/IMG_20130622_200807.jpg" alt="img" /></p>

<p><sub>* Happy Hour</sub></p>

<p>回到旅舍，在一楼酒吧享受了Happy Hour提供的免费自助，意大利的最后一站米兰之旅就此画上了休止符。</p>

<p><sub>23/06/2013 初稿于米兰 10/2014 整理 </sub></p>

<p><sub>注: <a href="http://voice.lawrencesun.info/blog/categories/man-you-ji/">曼游记系列</a>: 本系列游记照片由谷哥四儿子联手谷哥相册友情提供 </sub></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[曼游记终极篇之欧洲行 Day 7]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/09/13/travel-europe-day-7/"/>
    <updated>2014-09-13T16:31:17+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/09/13/travel-europe-day-7</id>
    <content type="html"><![CDATA[<p>没能按计划早起，睡了个懒觉。由于昨天到威尼斯之后预订了去米兰的车次，为了防止来回旅馆错过列车，所以先直奔火车站存包，然后乘水上巴士出发去玻璃岛。</p>

<p>要去这个岛的游客非常多，等了好久也没挤上直航的公交3号，只好在几分钟之后坐上公交4.2号，慢慢悠悠地晃了40多分钟，终于抵达了玻璃岛。</p>

<p>当地人民多以制作玻璃为生，街道两旁几乎都是精美的玻璃制品店。</p>

<p>由于时间紧，转了一圈之后就直接去岛上另一个车站乘坐12路前往彩色岛，大约半个小时之后到达。彩色岛，顾名思义，这里的房子都是彩漆，一幢房子一个颜色，门帘也是彩色的，看起来非常温馨。</p>

<!-- more -->


<p><img src="https://lh4.googleusercontent.com/-1hdSzW-AgW4/Uv9r0vihrlI/AAAAAAAAAdw/yXAkNWVNM6o/w400" alt="img" /></p>

<p><sub>* 彩色岛</sub></p>

<p>在彩色岛点了盘海鲜饭，确实是夹生的，当初在曼城的某意大利餐馆第一次吃的时候还以为是没煮熟呢。</p>

<p><img src="https://lh4.googleusercontent.com/-rbN2rKEzM0w/Uv9rwLTNf6I/AAAAAAAAAdg/egg9xdMEJxA/w400" alt="img" /></p>

<p><sub>* 海鲜饭</sub></p>

<p>岛屿并不大，逛了一个小时以后就沿着来路返回主岛了。找了家酒吧，在下午关门之前吃了碗沙拉。吃完取来包裹，在车站稍等片刻，便乘坐火车前往下一站，米兰。</p>

<p><sub>21/06/2013 初稿于威尼斯 09/2014 整理 </sub></p>

<p><sub>注: <a href="http://voice.lawrencesun.info/blog/categories/man-you-ji/">曼游记系列</a>: 本系列游记照片由谷哥四儿子联手谷哥相册友情提供 </sub></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[曼游记终极篇之欧洲行 Day 6]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/08/22/travel-europe-day-6/"/>
    <updated>2014-08-22T15:04:49+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/08/22/travel-europe-day-6</id>
    <content type="html"><![CDATA[<p>早饭过后，我再次问房东确认“谢谢”怎么说，然后和他道别，对他说&#8221;Grazie!&ldquo;并付了小费。我对这个暂时的落脚处有了些许家的感觉。在颠簸的旅途中能有人每早向你问好并端来咖啡和牛角包，是一件非常幸福的事。离开佛罗伦萨后，我将继续北上。</p>

<p>在前往火车站的途中，我买了邮票，再次感叹意大利香烟店的无所不售。离火车发车时间还有一个小时，因为站内基本没有座位，我只好席地而坐，补完昨天的游记。不同于前几天的慢车，我在上车前发现之前reserse的高铁车票上是有座位号的。</p>

<p>列车以大约150公里/小时的速度一路向意大利的西北角奔去。两个小时后，我终于抵达了梦寐以求的威尼斯。这座水上之城举世闻名，游客络绎不绝。</p>

<p>因为贡多拉的价格昂贵，我选择了48小时的公交卡。但是我还是决定先走着去住处，先睹为快。事实证明，我这个决定，非常的&hellip; 失败。这里的小巷比之罗马，佛罗伦萨显得更加狭小，而且蜿蜒曲折，走几步就要过桥，有时还会走进死胡同。</p>

<!-- more -->


<p><img src="https://lh6.googleusercontent.com/-Az2GKwUcerI/Uv9q8hk7OdI/AAAAAAAAAb8/WpLLzQJ_Nks/w300/IMG_20130620_114319.jpg" alt="img" /></p>

<p><sub>* 小巷</sub></p>

<p>因为穿梭在游客罕至的区域，加上GPS在这个地方几乎失效，我在这个迷宫般的地方穿梭了一个多小时，几经周折后才走到了著名的Rialto桥，这座拱桥的中间和两侧都是商铺。随后由此找到了酒店。这家三星级的住所装修高档，交通便利(大多青年旅舍都在偏远处，甚至主岛之外)，我也为此下了不少血本，好在只住一宿。</p>

<p><img src="https://lh5.googleusercontent.com/-jM_DR56sfrM/Uv9q8khOL_I/AAAAAAAAAtU/1_IRBHvsQ5A/w300/IMG_20130620_111819.jpg" alt="img" /></p>

<p><img src="https://lh3.googleusercontent.com/-xiz6DH_VetI/Uv9rIzvCgJI/AAAAAAAAAcQ/jVKDVwqgJb4/w400/IMG_20130620_142248.jpg" alt="img" /></p>

<p><sub>* 贡多拉</sub></p>

<p>放下东西，乘坐公交&hellip;船，沿着主干河流，一路游览。先是参观了学院博物馆，里面陈列着各个时期文人墨客在此留下的佳作。接着继续坐船来到了圣马可广场，这里是威尼斯最为热闹的地方。广场三面都是宫殿般的建筑，东面则是圣马可大教堂和总督府。</p>

<p><img src="https://lh4.googleusercontent.com/-NVN0ZCR9dQ8/Uv9rQOc2FoI/AAAAAAAAAcg/o_inVUko9bM/w400/IMG_20130620_142305.jpg" alt="img" /></p>

<p><sub>* 总督府</sub></p>

<p>在这里拍照时，还碰到一对来自印度的夫妇，我们互相帮忙拍了照片，他们还执意要和我合影。然后参观了保存完好的总督府，里面有罗马式的高墙，还有会议大厅。从总督府的一侧沿着叹息桥就可以通向威尼斯的黑暗监狱。一侧的圣马可大教堂则是威尼斯的标志，它结合了不少建筑形式，这也符合威尼斯这个水上贸易城市的风格。</p>

<p><img src="https://lh5.googleusercontent.com/-GbRAUkajcXU/Uv9rexq11sI/AAAAAAAAAdA/SiGsNzC2B_M/w300/IMG_20130620_175917.jpg" alt="img" /></p>

<p><sub>* 叹息桥</sub></p>

<p>之后，我又乘坐另一趟水上公交线路，吹着海风来到了丽都岛。和主岛不同，这里的建筑更加现代，还有一个海滨沙滩，比较适合度假。匆匆走了一个来回，便乘船返回圣马可广场。</p>

<p><img src="https://lh3.googleusercontent.com/-JTICn6nIUsc/Uv9rRCWIC4I/AAAAAAAAAco/rZVZgDcSWUk/w300/IMG_20130620_161106.jpg" alt="img" /></p>

<p><sub>* 青口意面</sub></p>

<p>在附近吃了晚饭后，登上了广场上近百米的高塔，一览全城。此时已是傍晚时分，夕阳西下，余晖熠熠，海鸟飞翔。潮水已经将广场浸没，人们在水中嬉戏，还有一位红衣女子翩翩起舞，赢得众人驻足观赏。</p>

<p><img src="https://lh4.googleusercontent.com/-BIbetcX-EuA/Uv9rd_Yms0I/AAAAAAAAAc4/BvwG31WlqUs/w300/IMG_20130620_190957.jpg" alt="img" /></p>

<p><img src="https://lh4.googleusercontent.com/--Q-eZDcUzss/Uv9rnHtFUFI/AAAAAAAAAdQ/LzRxdzqbkg8/w300/IMG_20130620_191649.jpg" alt="img" /></p>

<p><sub>* 夕阳下的圣马可广场和教堂</sub></p>

<p>离开广场，在附近寻觅凤凰歌剧院，却只在夜幕下撇得一眼。周围的橱窗里展示着化妆舞会的饰品，它们将在来年的狂欢节上大放异彩。回到住处休息片刻后，又乘船北上。此时的潮水已将不少建筑的底层淹没，而夜色下的城市显得宁静安详，只有威尼斯赌场依然灯光闪烁。</p>

<p><img src="https://lh5.googleusercontent.com/-nbZ7CiLLDbY/Uv9rnk2frCI/AAAAAAAAAdY/RFg4eWd_K38/w400/IMG_20130620_200134.jpg" alt="img" /></p>

<p><img src="https://lh4.googleusercontent.com/-2jtIPlGzCIg/Uv9rnhrbrYI/AAAAAAAAAdU/UOwqAkpJu-k/w300/IMG_20130620_204050.jpg" alt="img" /></p>

<p><sub>* 夜色下的威尼斯</sub></p>

<p><sub>21/06/2013 初稿于威尼斯 08/2014 这天开始的记录，简单而零碎，整理难度系数飙升 </sub></p>

<p><sub>注: <a href="http://voice.lawrencesun.info/blog/categories/man-you-ji/">曼游记系列</a>: 本系列游记照片由谷哥四儿子联手谷哥相册友情提供，高清无码图视情况在完成后补充. </sub></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[如何免费搭建WordPress博客并连接微信公众账号]]></title>
    <link href="http://voice.lawrencesun.info/posts/2014/08/19/how-to-build-wp-blog-and-connect-weixin/"/>
    <updated>2014-08-19T23:31:08+08:00</updated>
    <id>http://voice.lawrencesun.info/posts/2014/08/19/how-to-build-wp-blog-and-connect-weixin</id>
    <content type="html"><![CDATA[<p>WordPress由于便捷的安装，丰富的插件，一直受到广大站长的喜爱。我的第一个独立博客也是用WordPress搭建，尽管后来改用Octopress平台了。</p>

<p>微信公众平台的影响力日益扩大，作为尝试，我也申请了一个账号(插播广告：欢迎扫描屏幕下方二维码关注本账号&hellip;只要998&hellip;)。</p>

<p>同时作为一个爱折腾的人，自然要开启微信的开发者模式。作为没有验证的订阅号，开发者暂时只能做一些信息接收和回复操作。</p>

<p>即使开发的权限不多，但是结合WordPress博客后也可以实现不少功能，比如发送&#8221;最新&#8221;，返回博客的最新文章等等。当然首先，你得有个博客。</p>

<!--more-->


<p><a href="http://sae.sina.com.cn/">SAE</a>是新浪提供的云计算服务，支持PHP和JAVA，而且资费相比阿里云什么的要便宜很多，用来搭建WordPress非常合适。</p>

<p>现在注册并且实名认证还送2500左右的云豆，对于数据库小、流量低的站点来说，可以免费用上个大半年。</p>

<p>下面讲讲大致流程。</p>

<p><strong>SAE WordPress 安装</strong></p>

<p>注册SAE之后，如果有建立WordPress站点的经验可以手动安装。或者和我一样选择easy模式，选择“导入应用”，将最新的<a href="wp4cloud.sinaapp.com">安装包</a>链接填到基于URL安装，然后填写应用名称等进行安装。</p>

<p>接下来就是进入你设定的地址xxx.sinaapp.com进行管理员注册等。</p>

<p>嗯，有默认的markdown插件真幸福。</p>

<p><strong>安装主题或插件</strong></p>

<p>SAE不支持直接搜索安装主题和插件，只能通过SVN(我靠，这又是啥&hellip;)来进行上传。SVN的使用方法请看SAE<a href="http://sae.sina.com.cn/doc/tutorial/helloworld.html">官方文档</a>&hellip;</p>

<p>从WP官网或其他途径下载主题或插件，放在本地的wp-content/themes or plugins的文件夹里，然后svn add &amp; commit提交到服务器。接着就可以进入WP后台安装了。</p>

<p><strong>博客优化</strong></p>

<p>主要是速度方面的。我暂时对以下两个方面进行了优化。</p>

<ul>
<li>gzip</li>
</ul>


<p>对页面进行压缩。进入SAE应用管理，在AppConfig里选择页面压缩，把所有的文件类型都添加进去。使用站长工具进行检测，运用后大约压缩了50%.</p>

<ul>
<li>fonts</li>
</ul>


<p>由于众所周知的原因，国内访问不了谷歌，然后包括WP在内的绝大多数平台或框架都采用了谷歌的公共库和字库，这会导致严重延时。好在360提供了<a href="libs.useso.com">镜像</a>以方便国内开发者使用。</p>

<p>需要更新的文件有：</p>

<ol>
<li>wp-includes/script-loader.php</li>
<li>wp-includes/js/tinymce/themes/advanced/skins/wp_theme/dialog.css</li>
<li>wp-content/themes/你的主题名/functions.php</li>
</ol>


<p>使用编辑器将上述文件中的‘googleapis.com’全部替换成‘useso.com’。</p>

<p><strong>连接微信接口</strong></p>

<p>我最初采用的方式是创立一个新的应用，用来接收和返回微信信息，同时通过链接的方式引导到博客。但是因为我是只能勉强写&#8221;Hello World&#8221;的小白，PHP这货基本不懂，只能套用简单的SDK进行修改。</p>

<p>后来我选择放弃建造轮子，倚靠前人的肩膀，怒装<a href="http://www.houqun.me/bbs/forum.php?gid=1">weixinpress</a>插件&hellip; 安装之后在WP后台可以轻松添加修改自定义回复。</p>

<p>然后微信的URL填写&#8217;xxx.sinaapp.com/?weixin&#8217;，设置token一致，就OK了。</p>

<p>接下来如有时间，我会考虑小打小闹，在此基础上添加些其他的功能。小黄鸡，神经猫什么的就算了吧&hellip;</p>

<p>欢迎关注下方微信公众账号进行测试或交流：</p>

<p><img src="http://cyztalk-wordpress.stor.sinaapp.com/uploads/2014/08/qrcode-150x150.jpg" alt="img" /></p>
]]></content>
  </entry>
  
</feed>
